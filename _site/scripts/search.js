var q,jsonFeedUrl="/feeds/feed.json",$searchForm=$("[data-search-form]"),$searchInput=$("[data-search-input]"),$resultTemplate=$("#search-result"),$resultsPlaceholder=$("[data-search-results]"),$foundContainer=$("[data-search-found]"),$foundTerm=$("[data-search-found-term]"),$foundCount=$("[data-search-found-count]"),allowEmpty=true,showLoader=true,loadingClass="is--loading";$(document).ready(function(){$foundContainer.hide();initSearch()});function initSearch(){if(getParameterByName("q")){q=decodeURIComponent(getParameterByName("q"));$searchInput.val(q);execSearch(q)}$(document).on("submit",$searchForm,function(e){e.preventDefault();q=$searchInput.val();execSearch(q)})}function execSearch(q){if(q!=""||allowEmpty){if(showLoader){toggleLoadingClass()}getSearchResults(processData())}}function toggleLoadingClass(){$resultsPlaceholder.toggleClass(loadingClass);$foundContainer.toggleClass(loadingClass)}function getSearchResults(callbackFunction){$.get(jsonFeedUrl,callbackFunction,"json")}function processData(){$results=[];return function(data){var resultsCount=0,results="";$.each(data,function(index,item){if(item.search_omit!="true"&&(item.content.toLowerCase().indexOf(q.toLowerCase())>-1||item.title.toLowerCase().indexOf(q.toLowerCase())>-1)){var result=populateResultContent($resultTemplate.html(),item);resultsCount++;results+=result}});if(showLoader){toggleLoadingClass()}populateResultsString(resultsCount);showSearchResults(results)}}function showSearchResults(results){$resultsPlaceholder.html(results)}function populateResultContent(html,item){html=injectContent(html,item.title,"##Title##");html=injectContent(html,item.link,"##Url##");html=injectContent(html,item.excerpt,"##Excerpt##");html=injectContent(html,item.date,"##Date##");return html}function populateResultsString(count){$foundTerm.text(q);$foundCount.text(count);$foundContainer.show()}function getParameterByName(name){var match=RegExp("[?&]"+name+"=([^&]*)").exec(window.location.search);return match&&decodeURIComponent(match[1].replace(/\+/g," "))}function injectContent(originalContent,injection,placeholder){var regex=new RegExp(placeholder,"g");return originalContent.replace(regex,injection)};