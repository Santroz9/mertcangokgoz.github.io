<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title>nasldoc: nasl</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content=""> <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style> <link href="css/bootstrap.min.css" rel="stylesheet"> <link href="css/shCore.css" rel="stylesheet" type="text/css"/> <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css"/> <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <link rel="shortcut icon" href="ico/favicon.ico"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png"> </head> <body> <div class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container-fluid"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="index.html">nasldoc</a> <div class="nav-collapse collapse"> <ul class="nav"> <li class="active"><a href="index.html">Home</a></li> </ul> </div> </div> </div> </div> <div class="container-fluid"> <div class="row-fluid"> <div class="span3"> <div class="well sidebar-nav"> <ul class="nav nav-list"> <li class="even"> <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a> </li> <li class="odd"> <a href="GSHB_read_file.html">GSHB_read_file.inc</a> </li> <li class="even"> <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a> </li> <li class="odd"> <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a> </li> <li class="even"> <a href="bin.html">bin.inc</a> </li> <li class="odd"> <a href="byte_func.html">byte_func.inc</a> </li> <li class="even"> <a href="cisco_ios.html">cisco_ios.inc</a> </li> <li class="odd"> <a href="cpe.html">cpe.inc</a> </li> <li class="even"> <a href="default_account.html">default_account.inc</a> </li> <li class="odd"> <a href="default_credentials.html">default_credentials.inc</a> </li> <li class="even"> <a href="dump.html">dump.inc</a> </li> <li class="odd"> <a href="ftp_func.html">ftp_func.inc</a> </li> <li class="even"> <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a> </li> <li class="odd"> <a href="global_settings.html">global_settings.inc</a> </li> <li class="even"> <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a> </li> <li class="odd"> <a href="host_details.html">host_details.inc</a> </li> <li class="even"> <a href="hp_printers.html">hp_printers.inc</a> </li> <li class="odd"> <a href="http_func.html">http_func.inc</a> </li> <li class="even"> <a href="http_keepalive.html">http_keepalive.inc</a> </li> <li class="odd"> <a href="imap_func.html">imap_func.inc</a> </li> <li class="even"> <a href="itg.html">itg.inc</a> </li> <li class="odd"> <a href="junos.html">junos.inc</a> </li> <li class="even"> <a href="kyocera_printers.html">kyocera_printers.inc</a> </li> <li class="odd"> <a href="ldap.html">ldap.inc</a> </li> <li class="even"> <a href="lexmark_printers.html">lexmark_printers.inc</a> </li> <li class="odd"> <a href="misc_func.html">misc_func.inc</a> </li> <li class="even"> <a href="netop.html">netop.inc</a> </li> <li class="odd"> <a href="network_func.html">network_func.inc</a> </li> <li class="even"> <a href="nfs_func.html">nfs_func.inc</a> </li> <li class="odd"> <a href="nmap.html">nmap.inc</a> </li> <li class="even"> <a href="nntp_func.html">nntp_func.inc</a> </li> <li class="odd"> <a href="os_eol.html">os_eol.inc</a> </li> <li class="even"> <a href="pingpong.html">pingpong.inc</a> </li> <li class="odd"> <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a> </li> <li class="even"> <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a> </li> <li class="odd"> <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a> </li> <li class="even"> <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a> </li> <li class="odd"> <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a> </li> <li class="even"> <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a> </li> <li class="odd"> <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a> </li> <li class="even"> <a href="pop3_func.html">pop3_func.inc</a> </li> <li class="odd"> <a href="revisions-lib.html">revisions-lib.inc</a> </li> <li class="even"> <a href="rsync_func.html">rsync_func.inc</a> </li> <li class="odd"> <a href="secpod_activex.html">secpod_activex.inc</a> </li> <li class="even"> <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a> </li> <li class="odd"> <a href="secpod_reg.html">secpod_reg.inc</a> </li> <li class="even"> <a href="secpod_smb_func.html">secpod_smb_func.inc</a> </li> <li class="odd"> <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a> </li> <li class="even"> <a href="sharp_printers.html">sharp_printers.inc</a> </li> <li class="odd"> <a href="sip.html">sip.inc</a> </li> <li class="even"> <a href="smb_default_credentials.html">smb_default_credentials.inc</a> </li> <li class="odd"> <a href="smb_nt.html">smb_nt.inc</a> </li> <li class="even"> <a href="smbcl_func.html">smbcl_func.inc</a> </li> <li class="odd"> <a href="smtp_func.html">smtp_func.inc</a> </li> <li class="even"> <a href="snmp_func.html">snmp_func.inc</a> </li> <li class="odd"> <a href="solaris.html">solaris.inc</a> </li> <li class="even"> <a href="ssh_func.html">ssh_func.inc</a> </li> <li class="odd"> <a href="ssl_funcs.html">ssl_funcs.inc</a> </li> <li class="even"> <a href="telnet_func.html">telnet_func.inc</a> </li> <li class="odd"> <a href="tftp.html">tftp.inc</a> </li> <li class="even"> <a href="uddi.html">uddi.inc</a> </li> <li class="odd"> <a href="url_func.html">url_func.inc</a> </li> <li class="even"> <a href="version_func.html">version_func.inc</a> </li> <li class="odd"> <a href="vmware_esx.html">vmware_esx.inc</a> </li> <li class="even"> <a href="wmi_file.html">wmi_file.inc</a> </li> <li class="odd"> <a href="wmi_hardware.html">wmi_hardware.inc</a> </li> <li class="even"> <a href="wmi_misc.html">wmi_misc.inc</a> </li> <li class="odd"> <a href="wmi_os.html">wmi_os.inc</a> </li> <li class="even"> <a href="wmi_proc.html">wmi_proc.inc</a> </li> <li class="odd"> <a href="wmi_rsop.html">wmi_rsop.inc</a> </li> <li class="even"> <a href="wmi_svc.html">wmi_svc.inc</a> </li> <li class="odd"> <a href="wmi_user.html">wmi_user.inc</a> </li> <li class="even"> <a href="wordlist.html">wordlist.inc</a> </li> <li class="odd"> <a href="xerox_printers.html">xerox_printers.inc</a> </li> <li class="even"> <a href="xml.html">xml.inc</a> </li> </ul> </div> </div> <div class="span9"> <a name="top"></a> <h1>Overview of ldap.inc</h1> <h1>Public Function Summary</h1> <p>Public functions are intended to be called by the code that imports this library.</p> <table class="nopad"> <tr class="TableHeadingColor"> <th>Name</th> <th>Summary</th> </tr> <tr> <td><a href="#get_ber_size">get_ber_size</a></td> <td></td> </tr> <tr> <td><a href="#is_ldapv3">is_ldapv3</a></td> <td></td> </tr> <tr> <td><a href="#ldap_alive">ldap_alive</a></td> <td></td> </tr> <tr> <td><a href="#ldap_tls_supported">ldap_tls_supported</a></td> <td></td> </tr> </table> <h1>Public Function Details</h1> <h2 id="get_ber_size">get_ber_size</h2> <h3>Named Parameters</h3> <dl> <dt>buf</dt> <dt>offset</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_ber_size(buf, offset) {
    local_var lm_length, length_length, i;
    lm_length = ord(buf[offset]);
    offset++;
    if(lm_length &gt; 128) {
        # undetermined length message
        length_length = lm_length - 128;
        lm_length = 0;
        for(i=0; i&lt;length_length; i++) {
            lm_length = (lm_length &lt;&lt; 8) | ord(buf[offset++]);
        }
    }
    return lm_length;
}

function is_ldapv3(port) {

		</pre> <a href="#top">top</a> <hr> <h2 id="is_ldapv3">is_ldapv3</h2> <h3>Named Parameters</h3> <dl> <dt>port</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function is_ldapv3(port) {
    local_var offset, lm_length, messageId_length, bindResponse_length, resultCode_length, resultCode, i, soc, buf;

    if( ! port )
    {
      set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#port#-#is_ldapv3&quot; );
      return;
    }

    soc = open_sock_tcp(port);
    if(!soc) return FALSE;

    req =  raw_string(0x30,0x0c,0x02,0x01,0x01,0x60,0x07,0x02,0x01,0x03,0x04,0x00,0x80,0x00); # v3 bind
    send(socket:soc, data:req);

    buf = recv(socket:soc, length:128);
    close(soc);

    if(!buf) return FALSE;

    # decode ldapMessage length (encoded as BER)
    offset = 0;
    if(ord(buf[offset++]) != 48) return FALSE; # (0x30)
    lm_length = get_ber_size(buf, offset);
    if (strlen(buf) &lt; lm_length + offset) return FALSE; # whoops, we have not enough data (should never happen since bindResponse is a short message)

    # we are not at offset = message id, we skip it
    if (ord(buf[offset++]) != 2) return FALSE; # messageId is an INT
    messageId_length = get_ber_size(buf, offset);
    offset += messageId_length;

    # now enter the bindResponse
    if (ord(buf[offset++]) != 97) return FALSE; # (0x61)
    bindResponse_length = get_ber_size(buf, offset);

    # now dig into response code
    if (ord(buf[offset++]) != 10) return FALSE; # (0x0A)
    resultCode_length = get_ber_size(buf, offset);
    resultCode = 0;
    for (i=0; i&lt;resultCode_length; i++) {
        resultCode = (resultCode &lt;&lt; 8) | ord(buf[offset++]);
    }
    if (resultCode == 0) return TRUE; # server has accepted the v3 bind

    return FALSE;
}  


		</pre> <a href="#top">top</a> <hr> <h2 id="ldap_alive">ldap_alive</h2> <h3>Named Parameters</h3> <dl> <dt>port</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function ldap_alive(port)
{

   local_var  req, buf, response;

   if( ! port )
   {
     set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#port#-#ldap_alive&quot; );
     return;
   }

   req = raw_string(0x30,0x84,0x00,0x00,0x00,0x59,0x02,0x01,0x05,0x63,0x84,0x00,
                    0x00,0x00,0x50,0x04,0x13,0x64,0x63,0x3d,0x6f,0x70,0x65,0x6e,
                    0x76,0x61,0x73,0x64,0x63,0x2c,0x64,0x63,0x3d,0x6e,0x65,0x74,
                    0x0a,0x01,0x02,0x0a,0x01,0x00,0x02,0x01,0x00,0x02,0x01,0x00,
                    0x01,0x01,0x00,0xa3,0x84,0x00,0x00,0x00,0x13,0x04,0x0b,0x6f,
                    0x62,0x6a,0x65,0x63,0x74,0x43,0x6c,0x61,0x73,0x73,0x04,0x04,
                    0x75,0x73,0x65,0x72,0x30,0x84,0x00,0x00,0x00,0x0d,0x04,0x0b,
                    0x64,0x69,0x73,0x70,0x6c,0x61,0x79,0x4e,0x61,0x6d,0x65);  

   soc = open_sock_tcp(port);
   if(!soc)return NULL;

   send(socket:soc, data:req);
   buf = recv(socket:soc, length:1);
   if( buf == NULL )return NULL;
   close(soc);

   if(strlen(buf) == 1) {
     response = hexstr(buf);
     if(response =~ &quot;^30$&quot; )return TRUE;
   }
 return NULL;
}

function ldap_tls_supported( port ) 

		</pre> <a href="#top">top</a> <hr> <h2 id="ldap_tls_supported">ldap_tls_supported</h2> <h3>Named Parameters</h3> <dl> <dt>port</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function ldap_tls_supported( port ) 
{

  if( ! port )
  {
    set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#port#-#ldap_tls_supported&quot; );
    return;
  }
  soc = open_sock_tcp( port );
  if( ! soc ) return FALSE;

  req = raw_string(0x30,0x1d,0x02,0x01,0x01,0x77,0x18,0x84,
                   0x16,0x31,0x2e,0x33,0x2e,0x36,0x2e,0x31,
                   0x2e,0x34,0x2e,0x31,0x2e,0x31,0x34,0x36,
                   0x36,0x2e,0x32,0x30,0x30,0x33,0x37);

  send( socket:soc, data:req );
  recv = recv( socket:soc, length:1024 );

  close( soc );

  if( ord( recv[0] ) == 48 )
  {
   er_length = get_ber_size( buf:recv, offset:6 );
   extended_response = substr( recv, strlen( recv ) - er_length, er_length );
   if( extended_response &amp;&amp; strlen( extended_response ) &gt; 1 &amp;&amp; ord( extended_response[2] ) == 0 )
   {
     return TRUE;
   }
  } 
}  

# extract the message length

		</pre> <a href="#top">top</a> <hr> </div> </div> <hr> <footer> <p>&copy; Tenable Network Security 2014</p> </footer> </div> <script type="text/javascript" src="js/jquery-1.8.2.js"></script> <script type="text/javascript" src="js/bootstrap.min.js"></script> <script type="text/javascript" src="js/shCore.js"></script> <script type="text/javascript" src="js/shBrushNasl.js"></script> <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script> </body> </html>