<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title>nasldoc: nasl</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content=""> <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style> <link href="css/bootstrap.min.css" rel="stylesheet"> <link href="css/shCore.css" rel="stylesheet" type="text/css"/> <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css"/> <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <link rel="shortcut icon" href="ico/favicon.ico"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png"> </head> <body> <div class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container-fluid"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="index.html">nasldoc</a> <div class="nav-collapse collapse"> <ul class="nav"> <li class="active"><a href="index.html">Home</a></li> </ul> </div> </div> </div> </div> <div class="container-fluid"> <div class="row-fluid"> <div class="span3"> <div class="well sidebar-nav"> <ul class="nav nav-list"> <li class="even"> <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a> </li> <li class="odd"> <a href="GSHB_read_file.html">GSHB_read_file.inc</a> </li> <li class="even"> <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a> </li> <li class="odd"> <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a> </li> <li class="even"> <a href="bin.html">bin.inc</a> </li> <li class="odd"> <a href="byte_func.html">byte_func.inc</a> </li> <li class="even"> <a href="cisco_ios.html">cisco_ios.inc</a> </li> <li class="odd"> <a href="cpe.html">cpe.inc</a> </li> <li class="even"> <a href="default_account.html">default_account.inc</a> </li> <li class="odd"> <a href="default_credentials.html">default_credentials.inc</a> </li> <li class="even"> <a href="dump.html">dump.inc</a> </li> <li class="odd"> <a href="ftp_func.html">ftp_func.inc</a> </li> <li class="even"> <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a> </li> <li class="odd"> <a href="global_settings.html">global_settings.inc</a> </li> <li class="even"> <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a> </li> <li class="odd"> <a href="host_details.html">host_details.inc</a> </li> <li class="even"> <a href="hp_printers.html">hp_printers.inc</a> </li> <li class="odd"> <a href="http_func.html">http_func.inc</a> </li> <li class="even"> <a href="http_keepalive.html">http_keepalive.inc</a> </li> <li class="odd"> <a href="imap_func.html">imap_func.inc</a> </li> <li class="even"> <a href="itg.html">itg.inc</a> </li> <li class="odd"> <a href="junos.html">junos.inc</a> </li> <li class="even"> <a href="kyocera_printers.html">kyocera_printers.inc</a> </li> <li class="odd"> <a href="ldap.html">ldap.inc</a> </li> <li class="even"> <a href="lexmark_printers.html">lexmark_printers.inc</a> </li> <li class="odd"> <a href="misc_func.html">misc_func.inc</a> </li> <li class="even"> <a href="netop.html">netop.inc</a> </li> <li class="odd"> <a href="network_func.html">network_func.inc</a> </li> <li class="even"> <a href="nfs_func.html">nfs_func.inc</a> </li> <li class="odd"> <a href="nmap.html">nmap.inc</a> </li> <li class="even"> <a href="nntp_func.html">nntp_func.inc</a> </li> <li class="odd"> <a href="os_eol.html">os_eol.inc</a> </li> <li class="even"> <a href="pingpong.html">pingpong.inc</a> </li> <li class="odd"> <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a> </li> <li class="even"> <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a> </li> <li class="odd"> <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a> </li> <li class="even"> <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a> </li> <li class="odd"> <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a> </li> <li class="even"> <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a> </li> <li class="odd"> <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a> </li> <li class="even"> <a href="pop3_func.html">pop3_func.inc</a> </li> <li class="odd"> <a href="revisions-lib.html">revisions-lib.inc</a> </li> <li class="even"> <a href="rsync_func.html">rsync_func.inc</a> </li> <li class="odd"> <a href="secpod_activex.html">secpod_activex.inc</a> </li> <li class="even"> <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a> </li> <li class="odd"> <a href="secpod_reg.html">secpod_reg.inc</a> </li> <li class="even"> <a href="secpod_smb_func.html">secpod_smb_func.inc</a> </li> <li class="odd"> <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a> </li> <li class="even"> <a href="sharp_printers.html">sharp_printers.inc</a> </li> <li class="odd"> <a href="sip.html">sip.inc</a> </li> <li class="even"> <a href="smb_default_credentials.html">smb_default_credentials.inc</a> </li> <li class="odd"> <a href="smb_nt.html">smb_nt.inc</a> </li> <li class="even"> <a href="smbcl_func.html">smbcl_func.inc</a> </li> <li class="odd"> <a href="smtp_func.html">smtp_func.inc</a> </li> <li class="even"> <a href="snmp_func.html">snmp_func.inc</a> </li> <li class="odd"> <a href="solaris.html">solaris.inc</a> </li> <li class="even"> <a href="ssh_func.html">ssh_func.inc</a> </li> <li class="odd"> <a href="ssl_funcs.html">ssl_funcs.inc</a> </li> <li class="even"> <a href="telnet_func.html">telnet_func.inc</a> </li> <li class="odd"> <a href="tftp.html">tftp.inc</a> </li> <li class="even"> <a href="uddi.html">uddi.inc</a> </li> <li class="odd"> <a href="url_func.html">url_func.inc</a> </li> <li class="even"> <a href="version_func.html">version_func.inc</a> </li> <li class="odd"> <a href="vmware_esx.html">vmware_esx.inc</a> </li> <li class="even"> <a href="wmi_file.html">wmi_file.inc</a> </li> <li class="odd"> <a href="wmi_hardware.html">wmi_hardware.inc</a> </li> <li class="even"> <a href="wmi_misc.html">wmi_misc.inc</a> </li> <li class="odd"> <a href="wmi_os.html">wmi_os.inc</a> </li> <li class="even"> <a href="wmi_proc.html">wmi_proc.inc</a> </li> <li class="odd"> <a href="wmi_rsop.html">wmi_rsop.inc</a> </li> <li class="even"> <a href="wmi_svc.html">wmi_svc.inc</a> </li> <li class="odd"> <a href="wmi_user.html">wmi_user.inc</a> </li> <li class="even"> <a href="wordlist.html">wordlist.inc</a> </li> <li class="odd"> <a href="xerox_printers.html">xerox_printers.inc</a> </li> <li class="even"> <a href="xml.html">xml.inc</a> </li> </ul> </div> </div> <div class="span9"> <a name="top"></a> <h1>Overview of host_details.inc</h1> <h1>Automatic Includes</h1> <p>These files are automatically included by the library.</p> <ul> <li><a href="xml.html">xml.inc</a></li> </ul> <h1>Public Function Summary</h1> <p>Public functions are intended to be called by the code that imports this library.</p> <table class="nopad"> <tr class="TableHeadingColor"> <th>Name</th> <th>Summary</th> </tr> <tr> <td><a href="#best_os_cpe">best_os_cpe</a></td> <td></td> </tr> <tr> <td><a href="#best_os_txt">best_os_txt</a></td> <td></td> </tr> <tr> <td><a href="#build_detection_report">build_detection_report</a></td> <td></td> </tr> <tr> <td><a href="#get_app">get_app</a></td> <td></td> </tr> <tr> <td><a href="#get_app_details">get_app_details</a></td> <td></td> </tr> <tr> <td><a href="#get_app_full">get_app_full</a></td> <td></td> </tr> <tr> <td><a href="#get_app_location">get_app_location</a></td> <td></td> </tr> <tr> <td><a href="#get_app_port">get_app_port</a></td> <td></td> </tr> <tr> <td><a href="#get_app_version">get_app_version</a></td> <td></td> </tr> <tr> <td><a href="#get_app_version_and_location">get_app_version_and_location</a></td> <td></td> </tr> <tr> <td><a href="#get_base_cpe">get_base_cpe</a></td> <td></td> </tr> <tr> <td><a href="#get_version_from_cpe">get_version_from_cpe</a></td> <td></td> </tr> <tr> <td><a href="#host_details_cpes">host_details_cpes</a></td> <td></td> </tr> <tr> <td><a href="#host_details_list">host_details_list</a></td> <td></td> </tr> <tr> <td><a href="#host_runs">host_runs</a></td> <td></td> </tr> <tr> <td><a href="#os_conflict">os_conflict</a></td> <td></td> </tr> <tr> <td><a href="#register_host_detail">register_host_detail</a></td> <td></td> </tr> <tr> <td><a href="#register_product">register_product</a></td> <td></td> </tr> <tr> <td><a href="#report_best_os_cpe">report_best_os_cpe</a></td> <td></td> </tr> <tr> <td><a href="#report_best_os_txt">report_best_os_txt</a></td> <td></td> </tr> <tr> <td><a href="#report_host_detail_single">report_host_detail_single</a></td> <td></td> </tr> <tr> <td><a href="#report_host_details">report_host_details</a></td> <td></td> </tr> </table> <h1>Public Function Details</h1> <h2 id="best_os_cpe">best_os_cpe</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function best_os_cpe() {
  local_var oid, res, entry;

  foreach oid (OS_CPE_SRC) {
    res = get_kb_list(&quot;HostDetails/NVT/&quot; + oid + &quot;/OS&quot;);
    if (!isnull(res)) {
      res = make_list(res);
      foreach entry (res) {
        # both CPE and free-form entries can be registered under the &quot;OS&quot; banner
        if (&quot;cpe:/&quot; &gt;&lt; entry)
          return entry;
      }
    }
  }
  return NULL;
}

function best_os_txt() {

		</pre> <a href="#top">top</a> <hr> <h2 id="best_os_txt">best_os_txt</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function best_os_txt() {
  local_var oid, res, entry;

  foreach oid (OS_TXT_SRC) {
    res = get_kb_list(&quot;HostDetails/NVT/&quot; + oid + &quot;/OS&quot;);
    if (!isnull(res)) {
      res = make_list(res);
      foreach entry (res) {
        # both CPE and free-form entries can be registered under the &quot;OS&quot; banner
        if (&quot;cpe:/&quot; &gt;!&lt; entry)
          return entry;
      }
    }
  }
  return NULL;
}

function report_best_os_cpe() {

		</pre> <a href="#top">top</a> <hr> <h2 id="build_detection_report">build_detection_report</h2> <h3>Named Parameters</h3> <dl> <dt>app</dt> <dt>concluded</dt> <dt>concludedUrl</dt> <dt>cpe</dt> <dt>extra</dt> <dt>install</dt> <dt>regpath</dt> <dt>version</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function build_detection_report( app, version, install, regpath, cpe, concluded, concludedUrl, extra ) {

  local_var app, version, install, cpe, concluded, concludedUrl, extra, regpath;

  if( ! version ) version = &#39;unknown&#39;;

  report = &#39;Detected &#39; + app +
           &#39;\nVersion: &#39; + version +
           &#39;\nLocation: &#39; + install;

  if( strlen( regpath ) &gt; 0 ) {
    report += &#39;\nRegistry path: &#39;+ regpath;
  }  

  if( strlen( cpe ) &gt; 0 ) {
    report += &#39;\nCPE: &#39;+ cpe;
  }

  if( strlen( concluded ) &gt; 0 ) {
    report += &#39;\n\nConcluded from version identification result:\n&#39; + concluded + &#39;\n&#39;;
  }

  if( strlen( concludedUrl ) &gt; 0 ) {
    report += &#39;\nConcluded from version identification location:\n&#39; + concludedUrl + &#39;\n&#39;;
  }

  if( strlen( extra ) &gt; 0 ) {
    report += &#39;\n&#39; + extra + &#39;\n&#39;;
  }

  return report;
}


		</pre> <a href="#top">top</a> <hr> <h2 id="get_app">get_app</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> <dt>loc</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_app(cpe, loc) {
  local_var host_details, host_detail, res, port, loc;

   host_details = get_kb_list(&quot;HostDetails/NVT/*&quot;);

   if(!host_details) return NULL;

   foreach host_detail (keys(host_details)) {

     if(cpe &gt;&lt; host_detail) {

       host_values = split(host_detail, sep:&quot;/&quot;, keep:FALSE);

       if(isnull(host_values[2]) || isnull(host_values[4]) || &quot;cpe:&quot; &gt;!&lt; host_values[3]) return NULL;

       res = make_array();

       res[&quot;OID&quot;] = host_values[2];
       res[&quot;CPE&quot;] = &#39;cpe:/&#39; +  host_values[4];

       port = get_kb_item(&quot;HostDetails/NVT/&quot; + res[&quot;OID&quot;] + &quot;/port&quot;);  # this could fork

       if(port) {
         res[&quot;port&quot;] = port;
       }

       if(loc) {
         location = get_kb_item(&quot;HostDetails/NVT/&quot; + res[&quot;OID&quot;] + &quot;/&quot; + res[&quot;CPE&quot;]); # this could fork
         res[&quot;LOCATION&quot;] = location;
       } else {
         locations = get_kb_list(&quot;HostDetails/NVT/&quot; + res[&quot;OID&quot;] + &quot;/&quot; + res[&quot;CPE&quot;]);
         l = make_list(locations);
         if(max_index(l) == 1) location = l[0];
       }  

       # Store link between scripts.
       register_host_detail(name:&quot;detected_by&quot;, value:res[&quot;OID&quot;]);
       register_host_detail(name:&quot;detected_at&quot;, value:location);

       return res;

    }
  }

   return NULL;
}

# *NEVER* use get_app_version() and get_app_location() together in a single NVT.

		</pre> <a href="#top">top</a> <hr> <h2 id="get_app_details">get_app_details</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> <dt>exit_no_version</dt> <dt>port</dt> <dt>typ</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_app_details( cpe, typ, port, exit_no_version )
{
  local_var port, cpe, typ, bc, base_cpe, x, x_oid, x_cpe, x_loc, x_port, x_service, app_details, app_value, app_versions, ret_arr, exit_no_version;

  if( ! base_cpe = get_base_cpe( cpe:cpe ) ) {
    set_kb_item( name: &quot;nvt_debug_cpe_syntax/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cpe#-#get_app_details&quot; );
    return;
  }

  # &quot;1.3.6.1.4.1.25623.1.0.xxxxx#-#cpe:/a:foo:bar:1.1.0#-#/foo#-#80&quot; or
  # &quot;1.3.6.1.4.1.25623.1.0.xxxxx#-#cpe:/a:foo:bar:1.1.0#-#/foo#-#80#-#www&quot;
  app_details = get_kb_item(&quot;get_app/&quot; + base_cpe); # this could fork
  if( ! app_details ) return;

  x = split( app_details, sep:&#39;#-#&#39;, keep:FALSE );

  x_oid  = x[0];
  x_cpe  = x[1];
  x_loc  = x[2];
  x_port = x[3];
  if( x[4] ) x_service = x[4];

  if( port )
    if( int( x_port ) != int( port ) ) return;

  if( typ == &#39;version&#39; )
  {
    if( ! app_versions = get_version_from_cpe( cpe:x_cpe ) ) return;

    register_host_detail(name:&quot;detected_by&quot;, value:x_oid);
    if( x_loc ) register_host_detail(name:&quot;detected_at&quot;, value:x_loc);

    return app_versions;
  }

  if( typ == &#39;location&#39; )
  {
    if( x_loc )
    {
      register_host_detail(name:&quot;detected_by&quot;, value:x_oid);
      if( x_loc ) register_host_detail(name:&quot;detected_at&quot;, value:x_loc);

      return x_loc;
    }
    return;
  }

  if( typ == &#39;version_location&#39; )
  {
    app_versions = get_version_from_cpe( cpe:x_cpe );

    if( ! app_versions &amp;&amp; ! x_loc ) return;
    if( ! app_versions &amp;&amp; exit_no_version == TRUE ) exit( 0 );

    if( app_versions )
      ret_arr[&#39;version&#39;] = app_versions;
    else
      ret_arr[&#39;version&#39;] = &#39;&#39;;

    if( x_loc )
      ret_arr[&#39;location&#39;] = x_loc;
    else
       ret_arr[&#39;location&#39;] = &#39;&#39;;

    register_host_detail(name:&quot;detected_by&quot;, value:x_oid);
    if( x_loc ) register_host_detail(name:&quot;detected_at&quot;, value:x_loc);

    return ret_arr;
  }

  if( typ == &#39;full&#39; )
  {
    app_versions = get_version_from_cpe( cpe:x_cpe );

    ret_arr[&#39;version&#39;]     = app_versions;
    ret_arr[&#39;location&#39;]    = x_loc;
    ret_arr[&#39;full_cpe&#39;]    = x_cpe;
    ret_arr[&#39;port&#39;]        = x_port;
    if(x_service) ret_arr[&#39;service&#39;] = x_service;
    ret_arr[&#39;detected_by&#39;] = x_oid;

    register_host_detail(name:&quot;detected_by&quot;, value:x_oid);
    if( x_loc ) register_host_detail(name:&quot;detected_at&quot;, value:x_loc);

    return ret_arr;
  }

  return;

}

function get_version_from_cpe( cpe )

		</pre> <a href="#top">top</a> <hr> <h2 id="get_app_full">get_app_full</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> <dt>port</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_app_full( cpe, port )
{
  local_var cpe, port;
  if( ! cpe ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cpe#-#get_app_full&quot; );
  return  get_app_details( cpe:cpe, typ:&quot;full&quot;, port:port );
}

function get_app_details( cpe, typ, port, exit_no_version )

		</pre> <a href="#top">top</a> <hr> <h2 id="get_app_location">get_app_location</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> <dt>port</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_app_location(cpe, port) {
  local_var cpe, port;
  if( ! cpe ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cpe#-#get_app_location&quot; );
  if( ! port ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#port#-#get_app_location&quot; );
  return  get_app_details( cpe:cpe, typ:&quot;location&quot;, port:port );
}

function get_app_port(cpe, service) {

		</pre> <a href="#top">top</a> <hr> <h2 id="get_app_port">get_app_port</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> <dt>service</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_app_port(cpe, service) {

  local_var base_cpe, port, cpe, service, services;

  if( ! cpe ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cpe#-#get_app_port&quot; );

  if( ! base_cpe = get_base_cpe( cpe:cpe ) ) {
    set_kb_item( name: &quot;nvt_debug_cpe_syntax/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cpe#-#get_app_port&quot; );
    return;
  }

  port =  get_kb_item(&quot;get_app/ports/&quot;+ base_cpe); # this could fork

  if( service ) {
    services =  get_kb_item(&quot;get_app/services/&quot; + port + &quot;/&quot; + base_cpe); # this could fork
    if( port =~ &#39;^[0-9]{1,5}$&#39; &amp;&amp; services &gt;&lt; service ) return port;
  } else {
    if( port =~ &#39;^[0-9]{1,5}$&#39; ) return port;
  }
  return;
}

function get_app_version_and_location( cpe, port, exit_no_version )

		</pre> <a href="#top">top</a> <hr> <h2 id="get_app_version">get_app_version</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> <dt>port</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_app_version(cpe, port) {
  local_var cpe, port;
  if( ! cpe ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cpe#-#get_app_version&quot; );
  return  get_app_details( cpe:cpe, typ:&quot;version&quot;, port:port );
}

function get_app_location(cpe, port) {

		</pre> <a href="#top">top</a> <hr> <h2 id="get_app_version_and_location">get_app_version_and_location</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> <dt>exit_no_version</dt> <dt>port</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_app_version_and_location( cpe, port, exit_no_version )
{
  local_var cpe, port, exit_no_version;
  if( ! cpe ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cpe#-#get_app_version_and_location&quot; );
  return  get_app_details( cpe:cpe, typ:&quot;version_location&quot;, port:port, exit_no_version:exit_no_version );
}

function get_app_full( cpe, port )

		</pre> <a href="#top">top</a> <hr> <h2 id="get_base_cpe">get_base_cpe</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_base_cpe( cpe )
{
  local_var cpe, base_cpe, bc;

  if( ! cpe ) return;

  bc = split( cpe, sep:&#39;:&#39;, keep:FALSE );
  if( ! bc || max_index( bc ) &lt; 4 ) return;

  if( bc[0] != &#39;cpe&#39; || bc[1] !~ &#39;/(a|o|h)$&#39; ) return;

  base_cpe = bc[0] + &#39;:&#39; + bc[1] + &#39;:&#39; + bc[2] + &#39;:&#39; + bc[3];

  return base_cpe;

}

function build_detection_report( app, version, install, regpath, cpe, concluded, concludedUrl, extra ) {

		</pre> <a href="#top">top</a> <hr> <h2 id="get_version_from_cpe">get_version_from_cpe</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_version_from_cpe( cpe )
{
  local_var cpe, token_val, tokens, app_versions;

  if( &quot;x64&quot; &gt;&lt; cpe )
    token_val = 1;
  else
    token_val = 0;

  tokens = split( cpe, sep:&quot;:&quot;, keep:0 );

  if (!isnull(tokens[4 + token_val])) {
    if (!isnull(tokens[5 + token_val])) { # for example cpe:/a:extplorer:extplorer:2.1.0:RC5
      app_versions = tokens[4 + token_val] + tokens[5 + token_val];
    } else {
      app_versions = tokens[4 + token_val];
    }
  }

  if( ! app_versions ) return;

  return app_versions;

}

function get_base_cpe( cpe )

		</pre> <a href="#top">top</a> <hr> <h2 id="host_details_cpes">host_details_cpes</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function host_details_cpes() {
  local_var res, name, categories, details_list, item;

  res = make_list();

  # get all the registered entries for applications
  details_list = host_details_list(key:&quot;App&quot;);

  if (!isnull(details_list))
    foreach item (details_list)
      if (&quot;cpe:/&quot; &gt;&lt; item)
        res = make_list(res, item);

  # get the best CPE we have for operating system (if any)
  item = best_os_cpe();
  if (!isnull(item))
    res = make_list(res, item);

  return res;
}

function os_conflict() {

		</pre> <a href="#top">top</a> <hr> <h2 id="host_details_list">host_details_list</h2> <h3>Named Parameters</h3> <dl> <dt>key</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function host_details_list(key) {
  return get_kb_list(&quot;HostDetails/NVT/*/&quot; + key);
}

function report_host_detail_single(name, value, nvt, desc) {

		</pre> <a href="#top">top</a> <hr> <h2 id="host_runs">host_runs</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function host_runs() {
  local_var ospattern, infolist;

  ospattern = _FCT_ANON_ARGS[0];

  infolist = host_details_list(key:&quot;OS&quot;);
  if (isnull(infolist))
    return &quot;unknown&quot;;

  foreach item (infolist)
    if (eregmatch(pattern:ospattern, string:item, icase:TRUE))
      return &quot;yes&quot;;

  return &quot;no&quot;;
}

function best_os_cpe() {

		</pre> <a href="#top">top</a> <hr> <h2 id="os_conflict">os_conflict</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function os_conflict() {
  local_var oslist, bestos, is_cpe, item;

  oslist = _FCT_ANON_ARGS[0];
  bestos = _FCT_ANON_ARGS[1];

  is_cpe = FALSE;

  if (&quot;cpe:/&quot; &gt;&lt; bestos)
    is_cpe = TRUE;

  foreach item (oslist) {
    if (item == bestos)
      continue;

    # return true if the list contains at least one element of the same type (cpe or text)
    if ((&quot;cpe:/&quot; &gt;&lt; item) == is_cpe)
      return TRUE;
  }
  return FALSE;
}

function get_app(cpe, loc) {

		</pre> <a href="#top">top</a> <hr> <h2 id="register_host_detail">register_host_detail</h2> <h3>Named Parameters</h3> <dl> <dt>desc</dt> <dt>name</dt> <dt>value</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function register_host_detail(name, value, desc) {
  local_var tokens;

  nvt = get_script_oid();

  if(name != &quot;port&quot;) {
      set_kb_item(name:&quot;HostDetails&quot;, value:name);
      set_kb_item(name:&quot;HostDetails/NVT&quot;, value:nvt);
      if (!isnull(desc))
        replace_kb_item(name:&quot;HostDetails/NVT/&quot; + nvt, value:desc);
  }

  if(value)
    set_kb_item(name:&quot;HostDetails/NVT/&quot; + nvt + &quot;/&quot; + name, value:value);

  # gather-package-list.nasl sets precise OS CPE keys that we use to
  # efficiently schedule LSCs.
  if (name == &quot;OS&quot; &amp;&amp; &quot;cpe:/o:&quot; &gt;&lt; value &amp;&amp; nvt == &quot;1.3.6.1.4.1.25623.1.0.50282&quot;) {
    tokens = split(value, sep:&quot;:&quot;, keep:0);

    if (tokens &amp;&amp; tokens[0] &amp;&amp; tokens[1] &amp;&amp; tokens[2] &amp;&amp; tokens[3])
      set_kb_item(name:string(&quot;HostDetails/OS/&quot;, tokens[0], &quot;:&quot;, tokens[1], &quot;:&quot;,
                              tokens[2], &quot;:&quot;, tokens[3]),
                  value:TRUE);
  }
}

function register_product(cpe, location, port, service) {

		</pre> <a href="#top">top</a> <hr> <h2 id="register_product">register_product</h2> <h3>Named Parameters</h3> <dl> <dt>cpe</dt> <dt>location</dt> <dt>port</dt> <dt>service</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function register_product(cpe, location, port, service) {
  local_var port, service, kb_e, base_cpe;

  register_host_detail(name:&quot;App&quot;, value:cpe);
  register_host_detail(name:cpe, value:location);
  if(port) {
    register_host_detail(name:&quot;port&quot;, value:port);
  }

  # store an entry under the &quot;base&quot; cpe, so we could fork later for each entry under a cpe
  if( ! base_cpe = get_base_cpe( cpe:cpe ) ) {
    set_kb_item( name: &quot;nvt_debug_cpe_syntax/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cpe#-#register_product&quot; );
    base_cpe = cpe;
  }
  if( service )
    kb_e = get_script_oid() + &#39;#-#&#39; + cpe + &#39;#-#&#39; + location + &#39;#-#&#39; + port + &#39;#-#&#39; + service;
  else
    kb_e = get_script_oid() + &#39;#-#&#39; + cpe + &#39;#-#&#39; + location + &#39;#-#&#39; + port;

  set_kb_item( name:&#39;get_app/&#39; + base_cpe, value:kb_e );

  if( port ) {
    set_kb_item( name:&#39;get_app/ports/&#39; + base_cpe, value:port );

    if( service )
      set_kb_item( name:&#39;get_app/services/&#39; + port + &quot;/&quot; + base_cpe, value:service );
  }
}

# provided for conveniency: host_details_list(&quot;OS&quot;)

		</pre> <a href="#top">top</a> <hr> <h2 id="report_best_os_cpe">report_best_os_cpe</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function report_best_os_cpe() {
  local_var oid, res, best_os, desc;

  best_os = get_kb_item(&quot;HostDetails/OS/BestMatch&quot;);
  if (best_os) {
    desc = get_kb_item(&quot;HostDetails/OS/BestMatch/Details&quot;);
    desc = split(desc, sep:&quot;;&quot;);
    report_host_detail_single(name:&quot;best_os_cpe&quot;, value:best_os, nvt:desc[0], desc:desc[1]);
    return;
  }
}

function report_best_os_txt() {

		</pre> <a href="#top">top</a> <hr> <h2 id="report_best_os_txt">report_best_os_txt</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function report_best_os_txt() {
  local_var oid, res, best_os, desc;

  foreach oid (OS_TXT_SRC) {
    res = get_kb_list(&quot;HostDetails/NVT/&quot; + oid + &quot;/OS&quot;);

    if (!isnull(res)) {
      res = make_list(res);

      foreach best_os (res) {

        # discard CPE entries
        if (&quot;cpe:/&quot; &gt;&lt; best_os)
          continue;

        # in case we have several entries from this script...
        if (os_conflict(res, best_os))
          best_os = best_os + &#39; [possible conflict]&#39;;

        desc = get_kb_item(&quot;HostDetails/NVT/&quot; + oid);
        report_host_detail_single(name:&quot;best_os_txt&quot;, value:best_os, nvt:oid, desc:desc);
        return;
      }
    }
  }
}

function host_details_cpes() {

		</pre> <a href="#top">top</a> <hr> <h2 id="report_host_detail_single">report_host_detail_single</h2> <h3>Named Parameters</h3> <dl> <dt>desc</dt> <dt>name</dt> <dt>nvt</dt> <dt>value</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function report_host_detail_single(name, value, nvt, desc) {
  local_var report;

  report = &#39;&#39;;

  report += xml_open_tag(tag:&#39;host&#39;);
  report += xml_open_tag(tag:&#39;detail&#39;);
  report += xml_tagline(tag:&#39;name&#39;, value:name);
  report += xml_tagline(tag:&#39;value&#39;, value:value);
  report += xml_open_tag(tag:&#39;source&#39;);
  report += xml_tagline(tag:&#39;type&#39;, value:&quot;nvt&quot;);
  report += xml_tagline(tag:&#39;name&#39;, value:nvt);

  if (!isnull(desc))
    report += xml_tagline(tag:&#39;description&#39;, value:desc);
  else
    report += &#39;&lt;description/&gt;&#39;;

  report += xml_close_tag(tag:&#39;source&#39;);
  report += xml_close_tag(tag:&#39;detail&#39;);
  report += xml_close_tag(tag:&#39;host&#39;);

  log_message(proto:&quot;Host_Details&quot;, data:report);
}

# Iterate over the host details and report them individually. Additionally

		</pre> <a href="#top">top</a> <hr> <h2 id="report_host_details">report_host_details</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function report_host_details() {
  local_var names, name, nvts, nvt, desc, details, item;


  # get the names of the host details we gathered
  names = get_kb_list(&quot;HostDetails&quot;);

  # list of concerned NVTs
  nvts = get_kb_list(&quot;HostDetails/NVT&quot;);
  foreach nvt (nvts) {
    # description of the current NVT
    desc = get_kb_item(&quot;HostDetails/NVT/&quot; + nvt);

    # iterate over the registered entries...
    foreach name (names) {
      details = get_kb_list(&quot;HostDetails/NVT/&quot; + nvt + &quot;/&quot; + name);

      # add a section in case the current NVT has some value for this entry
      foreach item (details) {
        if (!isnull(item)) {
          report_host_detail_single(name:name, value:item, nvt:nvt, desc:desc);
        }
      }
    }
  }

  # Report best OS entries
  report_best_os_cpe();
  report_best_os_txt();
}

function host_runs() {

		</pre> <a href="#top">top</a> <hr> </div> </div> <hr> <footer> <p>&copy; Tenable Network Security 2014</p> </footer> </div> <script type="text/javascript" src="js/jquery-1.8.2.js"></script> <script type="text/javascript" src="js/bootstrap.min.js"></script> <script type="text/javascript" src="js/shCore.js"></script> <script type="text/javascript" src="js/shBrushNasl.js"></script> <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script> </body> </html>