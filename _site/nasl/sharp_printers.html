<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title>nasldoc: nasl</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content=""> <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style> <link href="css/bootstrap.min.css" rel="stylesheet"> <link href="css/shCore.css" rel="stylesheet" type="text/css"/> <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css"/> <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <link rel="shortcut icon" href="ico/favicon.ico"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png"> </head> <body> <div class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container-fluid"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="index.html">nasldoc</a> <div class="nav-collapse collapse"> <ul class="nav"> <li class="active"><a href="index.html">Home</a></li> </ul> </div> </div> </div> </div> <div class="container-fluid"> <div class="row-fluid"> <div class="span3"> <div class="well sidebar-nav"> <ul class="nav nav-list"> <li class="even"> <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a> </li> <li class="odd"> <a href="GSHB_read_file.html">GSHB_read_file.inc</a> </li> <li class="even"> <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a> </li> <li class="odd"> <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a> </li> <li class="even"> <a href="bin.html">bin.inc</a> </li> <li class="odd"> <a href="byte_func.html">byte_func.inc</a> </li> <li class="even"> <a href="cisco_ios.html">cisco_ios.inc</a> </li> <li class="odd"> <a href="cpe.html">cpe.inc</a> </li> <li class="even"> <a href="default_account.html">default_account.inc</a> </li> <li class="odd"> <a href="default_credentials.html">default_credentials.inc</a> </li> <li class="even"> <a href="dump.html">dump.inc</a> </li> <li class="odd"> <a href="ftp_func.html">ftp_func.inc</a> </li> <li class="even"> <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a> </li> <li class="odd"> <a href="global_settings.html">global_settings.inc</a> </li> <li class="even"> <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a> </li> <li class="odd"> <a href="host_details.html">host_details.inc</a> </li> <li class="even"> <a href="hp_printers.html">hp_printers.inc</a> </li> <li class="odd"> <a href="http_func.html">http_func.inc</a> </li> <li class="even"> <a href="http_keepalive.html">http_keepalive.inc</a> </li> <li class="odd"> <a href="imap_func.html">imap_func.inc</a> </li> <li class="even"> <a href="itg.html">itg.inc</a> </li> <li class="odd"> <a href="junos.html">junos.inc</a> </li> <li class="even"> <a href="kyocera_printers.html">kyocera_printers.inc</a> </li> <li class="odd"> <a href="ldap.html">ldap.inc</a> </li> <li class="even"> <a href="lexmark_printers.html">lexmark_printers.inc</a> </li> <li class="odd"> <a href="misc_func.html">misc_func.inc</a> </li> <li class="even"> <a href="netop.html">netop.inc</a> </li> <li class="odd"> <a href="network_func.html">network_func.inc</a> </li> <li class="even"> <a href="nfs_func.html">nfs_func.inc</a> </li> <li class="odd"> <a href="nmap.html">nmap.inc</a> </li> <li class="even"> <a href="nntp_func.html">nntp_func.inc</a> </li> <li class="odd"> <a href="os_eol.html">os_eol.inc</a> </li> <li class="even"> <a href="pingpong.html">pingpong.inc</a> </li> <li class="odd"> <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a> </li> <li class="even"> <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a> </li> <li class="odd"> <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a> </li> <li class="even"> <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a> </li> <li class="odd"> <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a> </li> <li class="even"> <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a> </li> <li class="odd"> <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a> </li> <li class="even"> <a href="pop3_func.html">pop3_func.inc</a> </li> <li class="odd"> <a href="revisions-lib.html">revisions-lib.inc</a> </li> <li class="even"> <a href="rsync_func.html">rsync_func.inc</a> </li> <li class="odd"> <a href="secpod_activex.html">secpod_activex.inc</a> </li> <li class="even"> <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a> </li> <li class="odd"> <a href="secpod_reg.html">secpod_reg.inc</a> </li> <li class="even"> <a href="secpod_smb_func.html">secpod_smb_func.inc</a> </li> <li class="odd"> <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a> </li> <li class="even"> <a href="sharp_printers.html">sharp_printers.inc</a> </li> <li class="odd"> <a href="sip.html">sip.inc</a> </li> <li class="even"> <a href="smb_default_credentials.html">smb_default_credentials.inc</a> </li> <li class="odd"> <a href="smb_nt.html">smb_nt.inc</a> </li> <li class="even"> <a href="smbcl_func.html">smbcl_func.inc</a> </li> <li class="odd"> <a href="smtp_func.html">smtp_func.inc</a> </li> <li class="even"> <a href="snmp_func.html">snmp_func.inc</a> </li> <li class="odd"> <a href="solaris.html">solaris.inc</a> </li> <li class="even"> <a href="ssh_func.html">ssh_func.inc</a> </li> <li class="odd"> <a href="ssl_funcs.html">ssl_funcs.inc</a> </li> <li class="even"> <a href="telnet_func.html">telnet_func.inc</a> </li> <li class="odd"> <a href="tftp.html">tftp.inc</a> </li> <li class="even"> <a href="uddi.html">uddi.inc</a> </li> <li class="odd"> <a href="url_func.html">url_func.inc</a> </li> <li class="even"> <a href="version_func.html">version_func.inc</a> </li> <li class="odd"> <a href="vmware_esx.html">vmware_esx.inc</a> </li> <li class="even"> <a href="wmi_file.html">wmi_file.inc</a> </li> <li class="odd"> <a href="wmi_hardware.html">wmi_hardware.inc</a> </li> <li class="even"> <a href="wmi_misc.html">wmi_misc.inc</a> </li> <li class="odd"> <a href="wmi_os.html">wmi_os.inc</a> </li> <li class="even"> <a href="wmi_proc.html">wmi_proc.inc</a> </li> <li class="odd"> <a href="wmi_rsop.html">wmi_rsop.inc</a> </li> <li class="even"> <a href="wmi_svc.html">wmi_svc.inc</a> </li> <li class="odd"> <a href="wmi_user.html">wmi_user.inc</a> </li> <li class="even"> <a href="wordlist.html">wordlist.inc</a> </li> <li class="odd"> <a href="xerox_printers.html">xerox_printers.inc</a> </li> <li class="even"> <a href="xml.html">xml.inc</a> </li> </ul> </div> </div> <div class="span9"> <a name="top"></a> <h1>Overview of sharp_printers.inc</h1> <h1>Automatic Includes</h1> <p>These files are automatically included by the library.</p> <ul> <li><a href="http_keepalive.html">http_keepalive.inc</a></li> <li><a href="misc_func.html">misc_func.inc</a></li> </ul> <h1>Public Variable Summary</h1> <p>Public variables are intended to be accessed by the code that imports this library.</p> <table class="nopad"> <tr class="TableHeadingColor"> <th>Name</th> <th>Summary</th> </tr> <tr> <td><a href="#cookie">cookie</a></td> <td></td> </tr> <tr> <td><a href="#cookie">cookie</a></td> <td></td> </tr> <tr> <td><a href="#cookie">cookie</a></td> <td></td> </tr> <tr> <td><a href="#last_pass">last_pass</a></td> <td></td> </tr> <tr> <td><a href="#last_user">last_user</a></td> <td></td> </tr> </table> <h1>Public Function Summary</h1> <p>Public functions are intended to be called by the code that imports this library.</p> <table class="nopad"> <tr class="TableHeadingColor"> <th>Name</th> <th>Summary</th> </tr> <tr> <td><a href="#build_sharp_cpe">build_sharp_cpe</a></td> <td></td> </tr> <tr> <td><a href="#check_sharp_default_login">check_sharp_default_login</a></td> <td></td> </tr> <tr> <td><a href="#error_exit">error_exit</a></td> <td></td> </tr> <tr> <td><a href="#set_cookie">set_cookie</a></td> <td></td> </tr> <tr> <td><a href="#sharp_default_logins">sharp_default_logins</a></td> <td></td> </tr> <tr> <td><a href="#sharp_login_details">sharp_login_details</a></td> <td></td> </tr> <tr> <td><a href="#update_cookie">update_cookie</a></td> <td></td> </tr> </table> <h1>Public Variable Details</h1> <h2 id="cookie">cookie</h2> <a href="#top">top</a> <hr> <h2 id="cookie">cookie</h2> <a href="#top">top</a> <hr> <h2 id="cookie">cookie</h2> <a href="#top">top</a> <hr> <h2 id="last_pass">last_pass</h2> <a href="#top">top</a> <hr> <h2 id="last_user">last_user</h2> <a href="#top">top</a> <hr> <h1>Public Function Details</h1> <h2 id="build_sharp_cpe">build_sharp_cpe</h2> <h3>Named Parameters</h3> <dl> <dt>model</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function build_sharp_cpe(model) {


  model = tolower(model);

  if(model == &quot;&quot;) return &#39;cpe:/h:sharp&#39;;

  return &#39;cpe:/h:sharp:&#39; + model;

}

function set_cookie(url) {

		</pre> <a href="#top">top</a> <hr> <h2 id="check_sharp_default_login">check_sharp_default_login</h2> <h3>Named Parameters</h3> <dl> <dt>model</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function check_sharp_default_login(model) {
 
  local_var userame, password, sharp;
  global_var last_user, last_pass;

  sharp = sharp_login_details(model:model);
  if(!sharp) return FALSE;

  logins = sharp_default_logins();

  foreach login (logins) {

    user_pass = split(login,sep:&quot;:&quot;, keep:FALSE);
    username = user_pass[0];
    password = user_pass[1];

    login_data = sharp[&#39;login_data&#39;];
    if(login_data) {
      login_data = str_replace(string:login_data, find:&quot;%%%USERNAME%%%&quot;, replace:username);
      login_data = str_replace(string:login_data, find:&quot;%%%PASSWORD%%%&quot;, replace:password);
    }

    len = strlen(login_data);

    if(sharp[&#39;req_type&#39;] == &quot;POST&quot;) {

      if(sharp[&#39;login_url_success&#39;]) {
        req = string(sharp[&#39;req_type_success&#39;], &quot; &quot;, sharp[&#39;login_url_success&#39;], &quot; HTTP/1.1\r\n&quot;,
                     &quot;Host: &quot;, get_host_name(),&quot;\r\n&quot;,
                     &quot;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/17.0 Firefox/17.0\r\n\r\n&quot;);
 
        buf = http_send_recv(port:port, data:req, bodyonly:FALSE);
        error_exit(buf:buf);

        if(eregmatch(pattern:sharp[&#39;login_success&#39;], string:buf)) {
          return 2; # setup without auth
        }
 
      }

      req = string(&quot;POST &quot; , sharp[&#39;login_url&#39;], &quot; HTTP/1.1\r\n&quot;,
                   &quot;Host: &quot;, get_host_name(),&quot;\r\n&quot;,
                   &quot;DNT: 1\r\n&quot;,
                   &quot;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/17.0 Firefox/17.0\r\n&quot;,
                   &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;,
                   &quot;Content-Length: &quot;,len,&quot;\r\n&quot;);

      if(cookie) req +=  string(&quot;Cookie: &quot;,cookie,&quot;\r\n&quot;);

      req += string(&quot;\r\n&quot;,login_data,&quot;\r\n&quot;);

    } 

    else if(sharp[&#39;req_type&#39;] == &quot;GET&quot;) {

      if(sharp[&#39;req_auth&#39;] == &quot;BASIC&quot;) {

        userpass = username + &#39;:&#39; + password;
        userpass64 = base64(str:userpass);

        req = string(&quot;GET &quot;, sharp[&#39;login_url&#39;],&quot; HTTP/1.1\r\n&quot;,
                     &quot;Host: &quot;, get_host_name(),&quot;\r\n&quot;);

        c_buf = http_send_recv(port:port, data:req + &#39;\r\n&#39;, bodyonly:FALSE);
        error_exit(buf:c_buf);

        if(c_buf !~ &quot;HTTP/1.. 401&quot; &amp;&amp; &quot;HTTP/1.1 302&quot; &gt;!&lt; c_buf) return 2; # setup without auth

        req += string(&quot;Authorization: Basic &quot;,userpass64,&quot;\r\n\r\n&quot;);

      }

    } else {
      return FALSE;
    }
 
    buf = http_send_recv(port:port, data:req, bodyonly:FALSE); # login

    if(ereg(pattern:sharp[&#39;http_status&#39;], string:buf)) {

      update_cookie(buf:buf);

      if(sharp[&#39;login_url_success&#39;]) {

        req = string(sharp[&#39;req_type_success&#39;], &quot; &quot;, sharp[&#39;login_url_success&#39;], &quot; HTTP/1.1\r\n&quot;,
                    &quot;Host: &quot;, get_host_name(),&quot;\r\n&quot;);

        if(cookie) req +=  string(&quot;Cookie: &quot;,cookie,&quot;\r\n&quot;);

        req += string(&quot;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:17.0) Gecko/17.0 OpenVAS\r\n\r\n&quot;);

        buf = http_send_recv(port:port, data:req, bodyonly:FALSE);
        error_exit(buf:buf);

      }

      if(eregmatch(pattern:sharp[&#39;login_success&#39;], string:buf)) { 
        last_user = username;
        last_pass = password;
        return 1;
      }

    }  
  }

  return FALSE;  

}  

function sharp_login_details(model) {

		</pre> <a href="#top">top</a> <hr> <h2 id="error_exit">error_exit</h2> <h3>Named Parameters</h3> <dl> <dt>buf</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function error_exit(buf) {

  if(!buf || ereg(pattern:&quot;HTTP/1.(0|1) (404|500)&quot;, string: buf))exit(0);

  return TRUE;

}


		</pre> <a href="#top">top</a> <hr> <h2 id="set_cookie">set_cookie</h2> <h3>Named Parameters</h3> <dl> <dt>url</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function set_cookie(url) {

  global_var cookie;

  req = http_get(item:url, port:port);
  buf = http_send_recv(port:port, data:req, bodyonly:FALSE);

  if(&quot;Set-Cookie:&quot; &gt;!&lt; buf) return FALSE;

  co = eregmatch(pattern:&quot;Set-Cookie: ([^; ]+)&quot;, string:buf);
  if(!isnull(co[1])) {
    cookie = co[1];
    return TRUE;
  }  

  return FALSE;

}  

function update_cookie(buf) {

		</pre> <a href="#top">top</a> <hr> <h2 id="sharp_default_logins">sharp_default_logins</h2> <h3>Named Parameters</h3> <dl> </dl> <h3>Code</h3> <pre class="brush: nasl">
function sharp_default_logins() {

  return make_list(&quot;admin:Sharp&quot;,&quot;admin:1234&quot;,&quot;Administrator:admin&quot;,&quot;administrator:admin&quot;,&quot;admin:admin&quot;,&quot;admin:00000&quot;);
}  

function check_sharp_default_login(model) {

		</pre> <a href="#top">top</a> <hr> <h2 id="sharp_login_details">sharp_login_details</h2> <h3>Named Parameters</h3> <dl> <dt>model</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function sharp_login_details(model) {

  global_var cookie;

  sharp = make_array();

  if(model == &quot;MX-4100N&quot;  ||
     model == &quot;MX-M453U&quot;  ||
     model == &quot;MX-5001N&quot;  ||
     model == &quot;MX-2700FG&quot; ||
     model == &quot;MX-2310U&quot;  ||
     model == &quot;MX-2301N&quot;  ||
     model == &quot;MX-M453N&quot;  ||
     model == &quot;MX-6200N&quot;  ||
     model == &quot;MX-4111N&quot;  ||
     model == &quot;MX-M452N&quot;  ||
     model == &quot;MX-M362N&quot;  ||
     model == &quot;MX-2614N&quot;  ||
     model == &quot;MX-M453U&quot;  ||
     model == &quot;MX-M453N&quot;  ||
     model == &quot;MX-M453&quot;   ||
     model == &quot;MX-7001N&quot;  ||
     model == &quot;MX-2010U&quot;  ||
     model == &quot;MX-M363N&quot;  ||
     model == &quot;MX-M363U&quot;  ||
     model == &quot;MX-M363&quot;   ||
     model == &quot;MX-M363N&quot;  ||
     model == &quot;MX-3110N&quot;  ||
     model == &quot;MX-2600N&quot;  ||
     model == &quot;MX-4501N&quot;  ||
     model == &quot;MX-6240N&quot;  ||
     model == &quot;MX-M283N&quot;  ||
     model == &quot;MX-M354N&quot;  ||
     model == &quot;MX-C311&quot;   ||
     model == &quot;MX-M502N&quot;  ||
     model == &quot;MX-2300N&quot;  ||
     model == &quot;MX-M503N&quot;  ||
     model == &quot;MX-B402SC&quot;) {

    if(!cookie) set_cookie(url:&#39;/main.html&#39;);

    sharp[&#39;req_type&#39;] = &quot;POST&quot;;
    sharp[&#39;login_url&#39;] = &#39;/login.html?/main.html&#39;;
    sharp[&#39;login_data&#39;] = &#39;ggt_select%2810009%29=3&amp;ggt_textbox%2810003%29=%%%PASSWORD%%%&amp;action=loginbtn&amp;ggt_hidden%2810008%29=4&#39;;

    sharp[&#39;req_type_success&#39;] = &quot;GET&quot;;
    sharp[&#39;login_url_success&#39;] = &#39;/main.html&#39;; 

    sharp[&#39;http_status&#39;] = &#39;HTTP/1.. 302&#39;;
    sharp[&#39;login_success&#39;] = &#39;&lt;!--Logoff \\(L\\)--&gt;&#39;; 

    return sharp;

  } 

  else if(model == &quot;MX-B201D&quot; ||
          model == &quot;AL-2051&quot;  ||
          model == &quot;AL-2061&quot;  ||
          model == &quot;AR-M160&quot;  ||
          model == &quot;AR-M236&quot;  ||
          model == &quot;MX-M450U&quot; ||
          model == &quot;AR-M237&quot;  ||
          model == &quot;MX-M620N&quot; ||
          model == &quot;MX-M350N&quot; ||
          model == &quot;MX-M550U&quot; ||
          model == &quot;MX-M310N&quot; ||
          model == &quot;MX-M700N&quot; ||
          model == &quot;AR-168D&quot;  ||
          model == &quot;AR-M700U&quot; ||
          model == &quot;MX-M550N&quot; ||
          model == &quot;AR-M451U&quot; ||
          model == &quot;AR-M351U&quot; ||
          model == &quot;AR-M550U&quot; ||
          model == &quot;AR-M450U&quot; ||
          model == &quot;AR-M155&quot;  ||
          model == &quot;MX-M260N&quot; ||
          model == &quot;AR-M350&quot;  ||
          model == &quot;im3511&quot;   ||
          model == &quot;im4512&quot;   ||
          model == &quot;AR-M276&quot;) {

    sharp[&#39;req_type&#39;] = &quot;GET&quot;;
    sharp[&#39;login_url&#39;] = &#39;/password.html&#39;;
    sharp[&#39;req_auth&#39;] = &quot;BASIC&quot;;

    sharp[&#39;http_status&#39;] = &#39;HTTP/1.. 200&#39;;
    sharp[&#39;login_success&#39;] = &#39;&lt;title&gt;Password Setup Page&#39;;

    return sharp;

  }

  exit(0); # we don&#39;t know this printer

}

function build_sharp_cpe(model) {

		</pre> <a href="#top">top</a> <hr> <h2 id="update_cookie">update_cookie</h2> <h3>Named Parameters</h3> <dl> <dt>buf</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function update_cookie(buf) {

  global_var cookie;

  if(&quot;Set-Cookie:&quot; &gt;!&lt; buf) return FALSE;

  co = eregmatch(pattern:&quot;Set-Cookie: ([^; ]+)&quot;, string:buf);
  if(!isnull(co[1])) {
    cookie = co[1];
    return TRUE;
  }

  return FALSE;

}

function error_exit(buf) {

		</pre> <a href="#top">top</a> <hr> </div> </div> <hr> <footer> <p>&copy; Tenable Network Security 2014</p> </footer> </div> <script type="text/javascript" src="js/jquery-1.8.2.js"></script> <script type="text/javascript" src="js/bootstrap.min.js"></script> <script type="text/javascript" src="js/shCore.js"></script> <script type="text/javascript" src="js/shBrushNasl.js"></script> <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script> </body> </html>