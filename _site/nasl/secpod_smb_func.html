<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title>nasldoc: nasl</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content=""> <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style> <link href="css/bootstrap.min.css" rel="stylesheet"> <link href="css/shCore.css" rel="stylesheet" type="text/css"/> <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css"/> <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <link rel="shortcut icon" href="ico/favicon.ico"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png"> </head> <body> <div class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container-fluid"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="index.html">nasldoc</a> <div class="nav-collapse collapse"> <ul class="nav"> <li class="active"><a href="index.html">Home</a></li> </ul> </div> </div> </div> </div> <div class="container-fluid"> <div class="row-fluid"> <div class="span3"> <div class="well sidebar-nav"> <ul class="nav nav-list"> <li class="even"> <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a> </li> <li class="odd"> <a href="GSHB_read_file.html">GSHB_read_file.inc</a> </li> <li class="even"> <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a> </li> <li class="odd"> <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a> </li> <li class="even"> <a href="bin.html">bin.inc</a> </li> <li class="odd"> <a href="byte_func.html">byte_func.inc</a> </li> <li class="even"> <a href="cisco_ios.html">cisco_ios.inc</a> </li> <li class="odd"> <a href="cpe.html">cpe.inc</a> </li> <li class="even"> <a href="default_account.html">default_account.inc</a> </li> <li class="odd"> <a href="default_credentials.html">default_credentials.inc</a> </li> <li class="even"> <a href="dump.html">dump.inc</a> </li> <li class="odd"> <a href="ftp_func.html">ftp_func.inc</a> </li> <li class="even"> <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a> </li> <li class="odd"> <a href="global_settings.html">global_settings.inc</a> </li> <li class="even"> <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a> </li> <li class="odd"> <a href="host_details.html">host_details.inc</a> </li> <li class="even"> <a href="hp_printers.html">hp_printers.inc</a> </li> <li class="odd"> <a href="http_func.html">http_func.inc</a> </li> <li class="even"> <a href="http_keepalive.html">http_keepalive.inc</a> </li> <li class="odd"> <a href="imap_func.html">imap_func.inc</a> </li> <li class="even"> <a href="itg.html">itg.inc</a> </li> <li class="odd"> <a href="junos.html">junos.inc</a> </li> <li class="even"> <a href="kyocera_printers.html">kyocera_printers.inc</a> </li> <li class="odd"> <a href="ldap.html">ldap.inc</a> </li> <li class="even"> <a href="lexmark_printers.html">lexmark_printers.inc</a> </li> <li class="odd"> <a href="misc_func.html">misc_func.inc</a> </li> <li class="even"> <a href="netop.html">netop.inc</a> </li> <li class="odd"> <a href="network_func.html">network_func.inc</a> </li> <li class="even"> <a href="nfs_func.html">nfs_func.inc</a> </li> <li class="odd"> <a href="nmap.html">nmap.inc</a> </li> <li class="even"> <a href="nntp_func.html">nntp_func.inc</a> </li> <li class="odd"> <a href="os_eol.html">os_eol.inc</a> </li> <li class="even"> <a href="pingpong.html">pingpong.inc</a> </li> <li class="odd"> <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a> </li> <li class="even"> <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a> </li> <li class="odd"> <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a> </li> <li class="even"> <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a> </li> <li class="odd"> <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a> </li> <li class="even"> <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a> </li> <li class="odd"> <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a> </li> <li class="even"> <a href="pop3_func.html">pop3_func.inc</a> </li> <li class="odd"> <a href="revisions-lib.html">revisions-lib.inc</a> </li> <li class="even"> <a href="rsync_func.html">rsync_func.inc</a> </li> <li class="odd"> <a href="secpod_activex.html">secpod_activex.inc</a> </li> <li class="even"> <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a> </li> <li class="odd"> <a href="secpod_reg.html">secpod_reg.inc</a> </li> <li class="even"> <a href="secpod_smb_func.html">secpod_smb_func.inc</a> </li> <li class="odd"> <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a> </li> <li class="even"> <a href="sharp_printers.html">sharp_printers.inc</a> </li> <li class="odd"> <a href="sip.html">sip.inc</a> </li> <li class="even"> <a href="smb_default_credentials.html">smb_default_credentials.inc</a> </li> <li class="odd"> <a href="smb_nt.html">smb_nt.inc</a> </li> <li class="even"> <a href="smbcl_func.html">smbcl_func.inc</a> </li> <li class="odd"> <a href="smtp_func.html">smtp_func.inc</a> </li> <li class="even"> <a href="snmp_func.html">snmp_func.inc</a> </li> <li class="odd"> <a href="solaris.html">solaris.inc</a> </li> <li class="even"> <a href="ssh_func.html">ssh_func.inc</a> </li> <li class="odd"> <a href="ssl_funcs.html">ssl_funcs.inc</a> </li> <li class="even"> <a href="telnet_func.html">telnet_func.inc</a> </li> <li class="odd"> <a href="tftp.html">tftp.inc</a> </li> <li class="even"> <a href="uddi.html">uddi.inc</a> </li> <li class="odd"> <a href="url_func.html">url_func.inc</a> </li> <li class="even"> <a href="version_func.html">version_func.inc</a> </li> <li class="odd"> <a href="vmware_esx.html">vmware_esx.inc</a> </li> <li class="even"> <a href="wmi_file.html">wmi_file.inc</a> </li> <li class="odd"> <a href="wmi_hardware.html">wmi_hardware.inc</a> </li> <li class="even"> <a href="wmi_misc.html">wmi_misc.inc</a> </li> <li class="odd"> <a href="wmi_os.html">wmi_os.inc</a> </li> <li class="even"> <a href="wmi_proc.html">wmi_proc.inc</a> </li> <li class="odd"> <a href="wmi_rsop.html">wmi_rsop.inc</a> </li> <li class="even"> <a href="wmi_svc.html">wmi_svc.inc</a> </li> <li class="odd"> <a href="wmi_user.html">wmi_user.inc</a> </li> <li class="even"> <a href="wordlist.html">wordlist.inc</a> </li> <li class="odd"> <a href="xerox_printers.html">xerox_printers.inc</a> </li> <li class="even"> <a href="xml.html">xml.inc</a> </li> </ul> </div> </div> <div class="span9"> <a name="top"></a> <h1>Overview of secpod_smb_func.inc</h1> <h1>Public Variable Summary</h1> <p>Public variables are intended to be accessed by the code that imports this library.</p> <table class="nopad"> <tr class="TableHeadingColor"> <th>Name</th> <th>Summary</th> </tr> <tr> <td><a href="#domain">domain</a></td> <td></td> </tr> <tr> <td><a href="#login">login</a></td> <td></td> </tr> <tr> <td><a href="#name">name</a></td> <td></td> </tr> <tr> <td><a href="#pass">pass</a></td> <td></td> </tr> <tr> <td><a href="#port">port</a></td> <td></td> </tr> </table> <h1>Public Function Summary</h1> <p>Public functions are intended to be called by the code that imports this library.</p> <table class="nopad"> <tr class="TableHeadingColor"> <th>Name</th> <th>Summary</th> </tr> <tr> <td><a href="#GetVer">GetVer</a></td> <td></td> </tr> <tr> <td><a href="#GetVersion">GetVersion</a></td> <td></td> </tr> <tr> <td><a href="#GetVersionFromFile">GetVersionFromFile</a></td> <td></td> </tr> <tr> <td><a href="#bin_dword">bin_dword</a></td> <td></td> </tr> <tr> <td><a href="#bin_word">bin_word</a></td> <td></td> </tr> <tr> <td><a href="#get_file_size">get_file_size</a></td> <td></td> </tr> <tr> <td><a href="#open_file">open_file</a></td> <td></td> </tr> <tr> <td><a href="#read_file">read_file</a></td> <td></td> </tr> <tr> <td><a href="#registry_enum_keys">registry_enum_keys</a></td> <td></td> </tr> <tr> <td><a href="#registry_enum_values">registry_enum_values</a></td> <td></td> </tr> </table> <h1>Public Variable Details</h1> <h2 id="domain">domain</h2> <a href="#top">top</a> <hr> <h2 id="login">login</h2> <a href="#top">top</a> <hr> <h2 id="name">name</h2> <a href="#top">top</a> <hr> <h2 id="pass">pass</h2> <a href="#top">top</a> <hr> <h2 id="port">port</h2> <a href="#top">top</a> <hr> <h1>Public Function Details</h1> <h2 id="GetVer">GetVer</h2> <h3>Named Parameters</h3> <dl> <dt>file</dt> <dt>prodvers</dt> <dt>share</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function GetVer(file, share, prodvers)
{
  local_var pe_offset, sections_cnt, sections_offset, sections_data, i, rsrc_start, rsrc_virtstart;
  local_var dir_data, dir_offset, dir_entries, sub_dir, dir_tmp, vs_data, vs_length, reply, recurs, max_recurs, vs_offset;
  local_var itr, it;

  if(isnull(prodvers)){
    prodvers = 0;
  }

  pe_offset = bin_word(data: read_file(share:share, file:file, offset:60, count:2));

  if(read_file(share:share, file:file, offset:pe_offset, count:2) != &quot;PE&quot;){
    return NULL;
  }

  sections_cnt = bin_word(data: read_file(share:share, file:file,
                          offset:pe_offset+6, count:2));
  section_offset = pe_offset + bin_word(data:read_file(share:share, file:file,
                                        offset:pe_offset+20, count:2)) + 24;
  rsrc_start = NULL;
  max_recurs = 20;

  for( itr=0; itr&lt;sections_cnt; itr++ )
  {
    sections_data = read_file(share:share, file:file, offset:section_offset + itr * 40,
                              count:40);
    if(substr(sections_data, 0, 4) == &quot;.rsrc&quot;)
    {
      rsrc_start = bin_dword(data:substr(sections_data, 20));
      rsrc_virtstart = bin_dword(data:substr(sections_data, 12));
      break;
    }
    if(itr &gt; max_recurs){
      break;
    }
  }
  if(isnull(rsrc_start)){
    return NULL;
  }

  dir_data = read_file(share:share, file:file, offset:rsrc_start, count:16);
  dir_entries = bin_word(data:substr(dir_data,12)) + bin_word(data:substr(dir_data,14));
  dir_offset = NULL;
  sub_dir = 0;
  max_recurs = 100;
  recurs = 0;
  for(it = 0; it &lt; dir_entries; it++)
  {
    dir_data = read_file(file:file, offset:rsrc_start+16+it*8, count:8);
    if(bin_dword(data:substr(dir_data,0)) == 0x10)
    {
      repeat
      {
        dir_tmp = bin_dword(data:substr(dir_data,4));
        if((dir_tmp &amp; 0x80000000) == 0x80000000)
        {
          dir_offset = dir_tmp - 0x80000000;
          sub_dir = 1;
        }
        else
        {
          dir_offset = dir_tmp;
          sub_dir = 0;
        }
        dir_data = read_file(share:share, file:file, offset:rsrc_start+dir_offset+16,
                             count:8);
        if(strlen(dir_data) != 8){
          return NULL;
        }
        if(++recurs &gt; max_recurs){
          return NULL;
        }
      }
      until sub_dir == 0;
      break;
    }
    if(it &gt; max_recurs){
      break;
    }
  }
  if(isnull(dir_offset)){
    return NULL;
  }

  dir_data = read_file(share:share, file:file, offset:rsrc_start+dir_offset,
                       count:4);
  dir_offset = bin_dword(data:substr(dir_data,0));
  rsrc_start = rsrc_start + (dir_offset - rsrc_virtstart);
  vs_data = read_file(share:share, file:file, offset:rsrc_start, count:2);
  if(!vs_data){
    return NULL;
  }

  vs_length = bin_word(data:substr(vs_data,0));
  vs_data = read_file(share:share, file:file, offset:rsrc_start, count:vs_length);

  if(bin_dword(data:substr(vs_data,40)) != 0xfeef04bd){
    return NULL;
  }

  if(prodvers == 0){
    vs_offset = 48;
  }
  else{
    vs_offset = 56;
  }

  reply = NULL;
  reply = string((bin_dword(data:substr(vs_data, vs_offset)) &gt;&gt;&gt; 16) + &quot;.&quot;);
  reply = reply + string((bin_dword(data:substr(vs_data, vs_offset)) &amp; 0xffff) + &quot;.&quot;);
  reply = reply + string((bin_dword(data:substr(vs_data, vs_offset+4)) &gt;&gt;&gt; 16) + &quot;.&quot;);
  reply = reply + string((bin_dword(data:substr(vs_data, vs_offset+4)) &amp; 0xffff));
  return reply;
}

function bin_word(data)

		</pre> <a href="#top">top</a> <hr> <h2 id="GetVersion">GetVersion</h2> <h3>Named Parameters</h3> <dl> <dt>debug</dt> <dt>fid</dt> <dt>offset</dt> <dt>socket</dt> <dt>tid</dt> <dt>uid</dt> <dt>verstr</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function GetVersion(socket, uid, tid, fid, offset, verstr, debug)
{

  local_var fsize, data, i, offset, tmp, version, ver, vers, len, retVal;

  pattern = &quot;F?i?l?e?V?e?r?s?i?o?n&quot;;
  if(verstr == &quot;prod&quot;){
    pattern = &quot;P?r?o?d?u?c?t?V?e?r?s?i?o?n&quot;;
  }

  else if(verstr){
   pattern = verstr;
  }

  patlen = strlen(pattern);

  fsize = smb_get_file_size(socket:socket, uid:uid, tid:tid, fid:fid);

  if(isnull(offset))
  {
    if(fsize &lt; 180224){
      offset = 0;
    }
    else{
      offset = fsize - 180224;
    }
  }

  if(offset &lt; 0){
     offset = fsize + offset;
  }

  start = offset;

  if(start &lt; 0 || start &gt; fsize){
    start = fsize/2;
  }

  offset = start;
  chunk = 16384;

  for(i = 0; offset &lt; fsize; i++)
  {
    tmp = ReadAndX(socket:socket, uid:uid, tid:tid, fid:fid, count:chunk, off:offset);
    if(tmp)
    {
      if(pattern == &quot;build&quot;){
        tmp = str_replace(find:raw_string(0), replace:&quot;&quot;, string:tmp);
      }
      else
        tmp = str_replace(find:raw_string(0), replace:&quot;?&quot;, string:tmp);

      data += tmp;
      version = strstr(data, pattern);
      if(version)
      {
        len = strlen(version);
        for(i = patlen; i &lt; len; i++)
        {
          if((ord(version[i]) &lt; ord(&quot;0&quot;) || ord(version[i]) &gt; ord(&quot;9&quot;)) &amp;&amp;
             (version[i] != &quot;.&quot; &amp;&amp; version[i] != &quot;,&quot; &amp;&amp; version[i] != &quot; &quot; &amp;&amp;
              version[i] != &quot;?&quot;))
          {
            if(ver[strlen(ver)-1] == &quot;.&quot;)
            {
              vers = split(ver, sep:&quot;.&quot;, keep:0);
              foreach item (vers){
                retVal += string(&quot;.&quot; + item);
              }
              retVal -= string(&quot;.&quot;);
                return(retVal);
            }
            return (ver);
          }
          else if(version[i] == &quot;,&quot; || version[i] == &quot;.&quot;){
            ver += &quot;.&quot;;
          }
          else if(ver &amp;&amp; version[i] == &quot;?&quot; &amp;&amp; version[i+1] == &quot;?&quot;){
            return (ver);
          }
          else if(version[i] == &quot; &quot;||version[i] == &quot;?&quot;){
          }
          else{
            ver += version[i];
          }
        }
      }
      offset += chunk;
    }
  }
  return NULL;
}


global_var name, login, pass, domain, port;

		</pre> <a href="#top">top</a> <hr> <h2 id="GetVersionFromFile">GetVersionFromFile</h2> <h3>Named Parameters</h3> <dl> <dt>file</dt> <dt>verstr</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function GetVersionFromFile(file, verstr) {

  local_var file, share, verstr, mshare, soc, r, prot, uid, tid, ver;

  mshare = ereg_replace(pattern:&quot;([A-Z]):.*&quot;, replace:&quot;\1$&quot;, string:file);
  file = ereg_replace(pattern:&quot;[A-Z]:(.*)&quot;, replace:&quot;\1&quot;, string:file);

  soc = open_sock_tcp(port);
  if(!soc){
    return NULL;
  }

  r = smb_session_request(soc:soc, remote:name);
  if(!r)
  {
    close(soc);
    return NULL;
  }

  prot = smb_neg_prot(soc:soc);
  if(!prot)
  {
    close(soc);
    return NULL;
  }

  r = smb_session_setup(soc:soc, login:login, password:pass,
                        domain:domain, prot:prot);
  if(!r)
  {
    close(soc);
    return NULL;
  }

  uid = session_extract_uid(reply:r);
  r = smb_tconx(soc:soc, name:name, uid:uid, share:mshare);

  tid = tconx_extract_tid(reply:r);
  if(!tid)
  {
    close(soc);
    return NULL;
  }
  fid = OpenAndX(socket:soc, uid:uid, tid:tid, file:file);
  if(!fid)
  {
    close(soc);
    return NULL;
  }
  if(isnull(verstr)) {
    ver = GetVersion(socket:soc, uid:uid, tid:tid, fid:fid);
  } else {
    ver = GetVersion(socket:soc, uid:uid, tid:tid, fid:fid,verstr:verstr);
  }
  close(soc);

  return ver;


}


		</pre> <a href="#top">top</a> <hr> <h2 id="bin_dword">bin_dword</h2> <h3>Named Parameters</h3> <dl> <dt>data</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function bin_dword(data)
{
  if(!data){
    return 0;
  }
  else {
    return(ord(data[0]) + (ord(data[1]) &lt;&lt; 8) +
         (ord(data[2]) &lt;&lt; 16) + (ord(data[3]) &lt;&lt; 24));
  }
}

function GetVersionFromFile(file, verstr) {

		</pre> <a href="#top">top</a> <hr> <h2 id="bin_word">bin_word</h2> <h3>Named Parameters</h3> <dl> <dt>data</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function bin_word(data)
{
  if(!data){
    return 0;
  }
  else return(ord(data[0]) + (ord(data[1]) &lt;&lt; 8));
}


function bin_dword(data)

		</pre> <a href="#top">top</a> <hr> <h2 id="get_file_size">get_file_size</h2> <h3>Named Parameters</h3> <dl> <dt>file</dt> <dt>share</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function get_file_size(share, file)
{
        if(!port){
                port = 445;
        }

        soc = open_sock_tcp(port);
        if(!soc){
                return FALSE;
        }

        r = smb_session_request(soc:soc, remote:name);
        if(!r){
                close(soc);
                return FALSE;
        }

        prot = smb_neg_prot(soc:soc);
        if(!prot){
                close(soc);
                return FALSE;
        }

        r = smb_session_setup(soc:soc, login:login, password:pass,
                              domain:domain, prot:prot);
        if(!r){
                close(soc);
                return FALSE;
        }

        uid = session_extract_uid(reply:r);
        if(!uid)
        {
                close(soc);
                return FALSE;
        }

        r = smb_tconx(soc:soc, name:name, uid:uid, share:share);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        tid = tconx_extract_tid(reply:r);
        if(!tid){
                close(soc);
                return FALSE;
        }

        fid = OpenAndX(socket:soc, uid:uid, tid:tid, file:file);
        if(!fid){
                close(soc);
                return FALSE;
        }
        fileSize = smb_get_file_size(socket:soc, uid:uid, tid:tid, fid:fid);
        smb_close_request(soc:soc, uid:uid, tid:tid, fid:fid);
        close(soc);

        if(fileSize){
                return fileSize;
        }
}




##########################################################################

		</pre> <a href="#top">top</a> <hr> <h2 id="open_file">open_file</h2> <h3>Named Parameters</h3> <dl> <dt>file</dt> <dt>share</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function open_file(share, file)
{
        if(!port){
                port = 445;
        }

        soc = open_sock_tcp(port);
        if(!soc){
                return FALSE;
        }

        r = smb_session_request(soc:soc, remote:name);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        prot = smb_neg_prot(soc:soc);
        if(!prot)
        {
                close(soc);
                return FALSE;
        }

        r = smb_session_setup(soc:soc, login:login, password:pass,
                              domain:domain, prot:prot);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        uid = session_extract_uid(reply:r);
        if(!uid)
        {
                close(soc);
                return FALSE;
        }

        r = smb_tconx(soc:soc, name:name, uid:uid, share:share);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        tid = tconx_extract_tid(reply:r);
        if(!tid)
        {
                close(soc);
                return FALSE;
        }

        r = OpenAndX(socket:soc, uid:uid, tid:tid, file:file);
        if(r)
          smb_close_request(soc:soc, uid:uid, tid:tid, fid:r);

        close(soc);
        return r;
}


##########################################################################

		</pre> <a href="#top">top</a> <hr> <h2 id="read_file">read_file</h2> <h3>Named Parameters</h3> <dl> <dt>count</dt> <dt>file</dt> <dt>offset</dt> <dt>share</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function read_file(share, file, offset, count)
{
        if(!port){
                port = 445;
        }

        soc = open_sock_tcp(port);
        if(!soc){
                return FALSE;
        }

        r = smb_session_request(soc:soc, remote:name);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        prot = smb_neg_prot(soc:soc);
        if(!prot)
        {
                close(soc);
                return FALSE;
        }

        r = smb_session_setup(soc:soc, login:login, password:pass,
                                 domain:domain, prot:prot);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        uid = session_extract_uid(reply:r);
        if(!uid)
        {
                close(soc);
                return FALSE;
        }

        r = smb_tconx(soc:soc, name:name, uid:uid, share:share);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        tid = tconx_extract_tid(reply:r);
        if(!tid)
        {
                close(soc);
                return FALSE;
        }

        fid = OpenAndX(socket:soc, uid:uid, tid:tid, file:file);
        if(!fid)
        {
                close(soc);
                return FALSE;
        }
        content = ReadAndX(socket:soc, uid:uid, tid:tid, fid:fid,
                           count:count, off:offset);
        result = smb_close_request(soc:soc, uid:uid, tid:tid, fid:fid);
        close(soc);
        return content;
}

function GetVer(file, share, prodvers)

		</pre> <a href="#top">top</a> <hr> <h2 id="registry_enum_keys">registry_enum_keys</h2> <h3>Named Parameters</h3> <dl> <dt>key</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function registry_enum_keys(key)
{
        if(!port){
                port = 445;
        }

        soc = open_sock_tcp(port);
        if(!soc) {
                return FALSE;
        }

        r = smb_session_request(soc:soc, remote:name);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        prot = smb_neg_prot(soc:soc);
        if(!prot)
        {
                close(soc);
                 return FALSE;
        }

        r = smb_session_setup(soc:soc, login:login, password:pass,
                                 domain:domain, prot:prot);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        uid = session_extract_uid(reply:r);
        if(!uid)
        {
                close(soc);
                return FALSE;
        }

        r = smb_tconx(soc:soc, name:name, uid:uid, share:&quot;IPC$&quot;);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        tid = tconx_extract_tid(reply:r);
        if(!tid)
        {
                close(soc);
                 return FALSE;
        }

        r = smbntcreatex(soc:soc, uid:uid, tid:tid, name:&quot;\winreg&quot;);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        pipe = smbntcreatex_extract_pipe(reply:r);
        if(!pipe)
        {
                close(soc);
                return FALSE;
        }

        r = pipe_accessible_registry(soc:soc, uid:uid, tid:tid, pipe:pipe);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        handle = registry_open_hklm(soc:soc, uid:uid, tid:tid, pipe:pipe);
        if(!handle)
        {
                close(soc);
                return FALSE;
        }

        r = registry_get_key(soc:soc, uid:uid, tid:tid, pipe:pipe, key:key,
                             reply:handle);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        list = registry_enum_key(soc:soc, uid:uid, tid:tid, pipe:pipe, reply:r);
        close(soc);
        return(list);
}


################################################################################

		</pre> <a href="#top">top</a> <hr> <h2 id="registry_enum_values">registry_enum_values</h2> <h3>Named Parameters</h3> <dl> <dt>key</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function registry_enum_values(key)
{
        if(!port){
                port = 445;
        }

        soc = open_sock_tcp(port);
        if(!soc){
                return FALSE;
        }

        r = smb_session_request(soc:soc, remote:name);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        prot = smb_neg_prot(soc:soc);
        if(!prot)
        {
                close(soc);
                return FALSE;
        }

        r = smb_session_setup(soc:soc, login:login, password:pass,
                              domain:domain, prot:prot);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        uid = session_extract_uid(reply:r);
        if(!uid)
        {
                close(soc);
                return FALSE;
        }

        r = smb_tconx(soc:soc, name:name, uid:uid, share:&quot;IPC$&quot;);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        tid = tconx_extract_tid(reply:r);
        if(!tid)
        {
                close(soc);
                return FALSE;
        }

        r = smbntcreatex(soc:soc, uid:uid, tid:tid, name:&quot;\winreg&quot;);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        pipe = smbntcreatex_extract_pipe(reply:r);
        if(!pipe)
        {
                close(soc);
                return FALSE;
        }

        r = pipe_accessible_registry(soc:soc, uid:uid, tid:tid, pipe:pipe);
        if(!r)
        {
                close(soc);
                return FALSE;
        }

        handle = registry_open_hklm(soc:soc, uid:uid, tid:tid, pipe:pipe);
        if(!handle)
        {
                close(soc);
                return FALSE;
        }

        r = registry_get_key(soc:soc, uid:uid, tid:tid, pipe:pipe, key:key,
                             reply:handle);

        if(!r)
        {
                close(soc);
                return FALSE;
        }

        list = registry_enum_value(soc:soc, uid:uid, tid:tid, pipe:pipe, reply:r);
        close(soc);
        return(list);
}


##############################################################################

		</pre> <a href="#top">top</a> <hr> </div> </div> <hr> <footer> <p>&copy; Tenable Network Security 2014</p> </footer> </div> <script type="text/javascript" src="js/jquery-1.8.2.js"></script> <script type="text/javascript" src="js/bootstrap.min.js"></script> <script type="text/javascript" src="js/shCore.js"></script> <script type="text/javascript" src="js/shBrushNasl.js"></script> <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script> </body> </html>