<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <title>nasldoc: nasl</title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content=""> <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style> <link href="css/bootstrap.min.css" rel="stylesheet"> <link href="css/shCore.css" rel="stylesheet" type="text/css"/> <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css"/> <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--> <link rel="shortcut icon" href="ico/favicon.ico"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png"> </head> <body> <div class="navbar navbar-inverse navbar-fixed-top"> <div class="navbar-inner"> <div class="container-fluid"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="index.html">nasldoc</a> <div class="nav-collapse collapse"> <ul class="nav"> <li class="active"><a href="index.html">Home</a></li> </ul> </div> </div> </div> </div> <div class="container-fluid"> <div class="row-fluid"> <div class="span3"> <div class="well sidebar-nav"> <ul class="nav nav-list"> <li class="even"> <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a> </li> <li class="odd"> <a href="GSHB_read_file.html">GSHB_read_file.inc</a> </li> <li class="even"> <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a> </li> <li class="odd"> <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a> </li> <li class="even"> <a href="bin.html">bin.inc</a> </li> <li class="odd"> <a href="byte_func.html">byte_func.inc</a> </li> <li class="even"> <a href="cisco_ios.html">cisco_ios.inc</a> </li> <li class="odd"> <a href="cpe.html">cpe.inc</a> </li> <li class="even"> <a href="default_account.html">default_account.inc</a> </li> <li class="odd"> <a href="default_credentials.html">default_credentials.inc</a> </li> <li class="even"> <a href="dump.html">dump.inc</a> </li> <li class="odd"> <a href="ftp_func.html">ftp_func.inc</a> </li> <li class="even"> <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a> </li> <li class="odd"> <a href="global_settings.html">global_settings.inc</a> </li> <li class="even"> <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a> </li> <li class="odd"> <a href="host_details.html">host_details.inc</a> </li> <li class="even"> <a href="hp_printers.html">hp_printers.inc</a> </li> <li class="odd"> <a href="http_func.html">http_func.inc</a> </li> <li class="even"> <a href="http_keepalive.html">http_keepalive.inc</a> </li> <li class="odd"> <a href="imap_func.html">imap_func.inc</a> </li> <li class="even"> <a href="itg.html">itg.inc</a> </li> <li class="odd"> <a href="junos.html">junos.inc</a> </li> <li class="even"> <a href="kyocera_printers.html">kyocera_printers.inc</a> </li> <li class="odd"> <a href="ldap.html">ldap.inc</a> </li> <li class="even"> <a href="lexmark_printers.html">lexmark_printers.inc</a> </li> <li class="odd"> <a href="misc_func.html">misc_func.inc</a> </li> <li class="even"> <a href="netop.html">netop.inc</a> </li> <li class="odd"> <a href="network_func.html">network_func.inc</a> </li> <li class="even"> <a href="nfs_func.html">nfs_func.inc</a> </li> <li class="odd"> <a href="nmap.html">nmap.inc</a> </li> <li class="even"> <a href="nntp_func.html">nntp_func.inc</a> </li> <li class="odd"> <a href="os_eol.html">os_eol.inc</a> </li> <li class="even"> <a href="pingpong.html">pingpong.inc</a> </li> <li class="odd"> <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a> </li> <li class="even"> <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a> </li> <li class="odd"> <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a> </li> <li class="even"> <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a> </li> <li class="odd"> <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a> </li> <li class="even"> <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a> </li> <li class="odd"> <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a> </li> <li class="even"> <a href="pop3_func.html">pop3_func.inc</a> </li> <li class="odd"> <a href="revisions-lib.html">revisions-lib.inc</a> </li> <li class="even"> <a href="rsync_func.html">rsync_func.inc</a> </li> <li class="odd"> <a href="secpod_activex.html">secpod_activex.inc</a> </li> <li class="even"> <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a> </li> <li class="odd"> <a href="secpod_reg.html">secpod_reg.inc</a> </li> <li class="even"> <a href="secpod_smb_func.html">secpod_smb_func.inc</a> </li> <li class="odd"> <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a> </li> <li class="even"> <a href="sharp_printers.html">sharp_printers.inc</a> </li> <li class="odd"> <a href="sip.html">sip.inc</a> </li> <li class="even"> <a href="smb_default_credentials.html">smb_default_credentials.inc</a> </li> <li class="odd"> <a href="smb_nt.html">smb_nt.inc</a> </li> <li class="even"> <a href="smbcl_func.html">smbcl_func.inc</a> </li> <li class="odd"> <a href="smtp_func.html">smtp_func.inc</a> </li> <li class="even"> <a href="snmp_func.html">snmp_func.inc</a> </li> <li class="odd"> <a href="solaris.html">solaris.inc</a> </li> <li class="even"> <a href="ssh_func.html">ssh_func.inc</a> </li> <li class="odd"> <a href="ssl_funcs.html">ssl_funcs.inc</a> </li> <li class="even"> <a href="telnet_func.html">telnet_func.inc</a> </li> <li class="odd"> <a href="tftp.html">tftp.inc</a> </li> <li class="even"> <a href="uddi.html">uddi.inc</a> </li> <li class="odd"> <a href="url_func.html">url_func.inc</a> </li> <li class="even"> <a href="version_func.html">version_func.inc</a> </li> <li class="odd"> <a href="vmware_esx.html">vmware_esx.inc</a> </li> <li class="even"> <a href="wmi_file.html">wmi_file.inc</a> </li> <li class="odd"> <a href="wmi_hardware.html">wmi_hardware.inc</a> </li> <li class="even"> <a href="wmi_misc.html">wmi_misc.inc</a> </li> <li class="odd"> <a href="wmi_os.html">wmi_os.inc</a> </li> <li class="even"> <a href="wmi_proc.html">wmi_proc.inc</a> </li> <li class="odd"> <a href="wmi_rsop.html">wmi_rsop.inc</a> </li> <li class="even"> <a href="wmi_svc.html">wmi_svc.inc</a> </li> <li class="odd"> <a href="wmi_user.html">wmi_user.inc</a> </li> <li class="even"> <a href="wordlist.html">wordlist.inc</a> </li> <li class="odd"> <a href="xerox_printers.html">xerox_printers.inc</a> </li> <li class="even"> <a href="xml.html">xml.inc</a> </li> </ul> </div> </div> <div class="span9"> <a name="top"></a> <h1>Overview of pkg-lib-rpm.inc</h1> <h1>Public Function Summary</h1> <p>Public functions are intended to be called by the code that imports this library.</p> <table class="nopad"> <tr class="TableHeadingColor"> <th>Name</th> <th>Summary</th> </tr> <tr> <td><a href="#isrpmvuln">isrpmvuln</a></td> <td></td> </tr> </table> <h1>Public Function Details</h1> <h2 id="isrpmvuln">isrpmvuln</h2> <h3>Named Parameters</h3> <dl> <dt>pkg</dt> <dt>rls</dt> <dt>rpm</dt> </dl> <h3>Code</h3> <pre class="brush: nasl">
function isrpmvuln(pkg, rpm, rls) {
    local_var a, b, kbrls, pat, matches, checkshorta, checkshortb, rc, norm_pkg, report;
    # Check that we have the data for this release.
    kbrls = get_kb_item(&quot;ssh/login/release&quot;);
    if(kbrls!=rls) {
	return NULL;
    }
    rpms = get_kb_item(&quot;ssh/login/rpms&quot;);
    if(!rpms) return NULL;

    # Must include in the package search leading \n or ; to prevent
    # overly permissive search (e.g. search for &#39;ash&#39; must not match &#39;bash&#39;)

    pat = string(&quot;[\n;](&quot;, pkg, &quot;~[^;]+);&quot;);
    matches = eregmatch(pattern:pat, string:rpms);
    if(isnull(matches)) {
	return NULL;
    }
#security_message(0, data: &quot;Comparing &quot; + matches[1] + &quot; against &quot; + rpm);

    # Ok...revcomp handles almost all situations intellligently. But,
    # it can get caught on the following two string example:
    #    a:a=&quot;kernel~2.6.9~89.EL&quot;; b=&quot;kernel~2.6.9~89.0.20.EL&quot;;
    # One would expect &#39;a&#39; to be &lt; (older than) &#39;b&#39;.  However, in this
    # case revcomp differentiates the &#39;E&#39; from the &#39;0&#39;, and thinks that
    # that b is as a result older (lexicographically less than) a.
    # This is the only situation we&#39;ve seen where this type of suffix
    # causes problems.  So, as a patch, we solve the problem locally 
    # BEFORE we call revcomp, by stripping from both strings the trailing
    # &#39;.EL[0-9]*&#39; suffix, but only if both strings have the identical suffix.
    # If we find other systems where this type of problem occurred, it may
    # make sense to consider if we should be stripping equal trailing strings
    # from the a/b parameters within revcomp. For now, though we&#39;ll do it here.

    a = matches[1];
    b = rpm;

    ## Spliting Package name and version
    ## Because the below replace _ with .(Dot) condition replaces
    ## _ in package name also
    asubstr = substr(a, strlen(pkg)+1, strlen(a));
    bsubstr = substr(b, strlen(pkg)+1, strlen(b));

    ## To replace _ with .(Dot)
    ## Because Version match fails in some case where version is having _(underscore)
    if(bsubstr =~ &#39;el[0-9]{1}_[0-9]{1}&#39; &amp;&amp; asubstr !~ &#39;el[0-9]{1}_[0-9]{1}&#39;)
      bsubstr = str_replace(string:bsubstr, find:&#39;_&#39;, replace:&#39;.&#39;);

    else if(asubstr =~ &#39;el[0-9]{1}_[0-9]{1}&#39; &amp;&amp; bsubstr !~ &#39;el[0-9]{1}_[0-9]{1}&#39;)
      asubstr = str_replace(string:asubstr, find:&#39;_&#39;, replace:&#39;.&#39;);

    ## Combining package name and version
    a = pkg + &#39;~&#39; + asubstr;
    b = pkg + &#39;~&#39; + bsubstr;

    checkshorta = eregmatch(pattern:&quot;^(.*)[.]([Ee][Ll][0-9]*)$&quot;, string:a);
    checkshortb = eregmatch(pattern:&quot;^(.*)[.]([Ee][Ll][0-9]*)$&quot;, string:b);
    if(!isnull(checkshorta) &amp;&amp; !isnull(checkshortb)) {
	if(checkshorta[2]==checkshortb[2]) {
	    a = checkshorta[1];
	    b = checkshortb[1];
	}
    }

    if( eregmatch( pattern:&quot;\.[0-9]{1}\.el[0-9]{1}&quot;, string:a ) &amp;&amp; ! eregmatch( pattern:&quot;\.[0-9]{1}\.el[0-9]{1}&quot;, string:b ) )
    {
      b = ereg_replace( pattern:&quot;(\.el[0-9]{1})&quot;, replace:&quot;.0\1&quot;, string:b );
    }

    __pkg_match = TRUE;

    # Now proceed with the normal revision comparison
    rc = revcomp(a:a, b:b);
    if(rc&lt;0) {
	norm_pkg = &quot;&quot;;
	foreach comp (split(matches[1], sep: &quot;~&quot;, keep:0)) {
	    norm_pkg = string(norm_pkg,&quot;-&quot;,comp);
	}
	norm_pkg = substr(norm_pkg, 1);
	report = &quot;Package &quot; + pkg + &quot; version &quot; +
		 norm_pkg + &#39; is installed which is known to be vulnerable.\n&#39;;
	return report;
    }
    return NULL;
}


		</pre> <a href="#top">top</a> <hr> </div> </div> <hr> <footer> <p>&copy; Tenable Network Security 2014</p> </footer> </div> <script type="text/javascript" src="js/jquery-1.8.2.js"></script> <script type="text/javascript" src="js/bootstrap.min.js"></script> <script type="text/javascript" src="js/shCore.js"></script> <script type="text/javascript" src="js/shBrushNasl.js"></script> <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script> </body> </html>