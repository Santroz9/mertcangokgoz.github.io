<!doctype html>
<html class="no-js" lang="tr-TR">
<head>
  <meta charset="UTF-8">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Wordpress Sitemap.xml Zafiyeti | Mertcan GÖKGÖZ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Jekyll">
  <link href="https://plus.google.com/103305118431759296457" rel="publisher" />
  <!-- Begin Jekyll SEO tag v2.0.0 -->
<meta property="og:title" content="Wordpress Sitemap.xml Zafiyeti" />
<meta name="description" content="Başlığın ilginç geldiğinin farkındayım.Bu günkü yılbaşı özel yazımızda sizlere wordpress sitelerde kullanılan ve statik olarak tutulmayan" />
<meta property="og:description" content="Başlığın ilginç geldiğinin farkındayım.Bu günkü yılbaşı özel yazımızda sizlere wordpress sitelerde kullanılan ve statik olarak tutulmayan" />
<link rel="canonical" href="https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/" />
<meta property="og:url" content="https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/" />
<meta property="og:site_name" content="Mertcan GÖKGÖZ - Özgür Yazılım, Sunucu Yönetimi ve Hizmetleri" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-12-31T19:21:12+02:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@mertcangokgoz" />
<meta name="twitter:creator" content="@http://twitter.com/mertcangokgoz" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Wordpress Sitemap.xml Zafiyeti",
    "datePublished": "2015-12-31T19:21:12+02:00",
    "description": "Başlığın ilginç geldiğinin farkındayım.Bu günkü yılbaşı özel yazımızda sizlere wordpress sitelerde kullanılan ve statik olarak tutulmayan",
    "url": "https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/"
  }
</script>
<!-- End Jekyll SEO tag -->
  
  <meta name="author" content="Mertcan GÖKGÖZ" />
  <meta name="distribution" content="global"/>
  <meta name="robots" content="follow, all"/>
  <meta name="google-site-verification" content="72uYg4UxAer0YwWdtkU93OGqjNq7ZThpqe0M4KxyvIg"/>
  <meta name='yandex-verification' content='410f2e33fe81ce80'/>
  <meta name="msvalidate.01" content="2183CAED5258723C183F825A20DF9C4A"/>
  <link rel="alternate" type="application/rss+xml" title="Mertcan GÖKGÖZ" href="https://mertcangokgoz.com/feed" />
  <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/all.css">
  <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css">
  <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.min.css">
  <script type="text/javascript" src="/assets/js/jquery-1.12.4.min.js"></script>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png">
</head>
<body>
<div class="container">
    <div class="three columns sidebar">
      <nav class="nav">
  <a href="/">
    <img src="/YeniResimBro.jpg" id="gravatar" alt="Mertcan GÖKGÖZ" width="200" height="200"/>
  </a>
  <h3><a href="/">Mertcan GÖKGÖZ</a></h3>
  <div id="bio">
    <p>
        Kategoriler:<br>

        <a href="/category/linux">Linux</a> &raquo; 216 Yazı<br><a href="/category/programlama">Programlama</a> &raquo; 76 Yazı<br><a href="/category/genel">Genel</a> &raquo; 67 Yazı<br><a href="/category/guvenlik">Guvenlik</a> &raquo; 52 Yazı<br><a href="/category/windows">Windows</a> &raquo; 35 Yazı<br><a href="/category/analiz">Analiz</a> &raquo; 21 Yazı<br><a href="/category/nginx">Nginx</a> &raquo; 13 Yazı<br><a href="/category/jekyll">Jekyll</a> &raquo; 11 Yazı<br><a href="/category/egitimler">Egitimler</a> &raquo; 3 Yazı<br>
        <br>
        Arkadaşlar:<br>
        <a href="https://oztaser.com/" target="_blank">Adil ÖZTAŞER</a><br>
        <a href="https://www.ceyhanmolla.com/" target="_blank">Ceyhan MOLLA</a><br>
        <a href="https://0x6.pw/" target="_blank">Enes ERGÜN</a><br>
        <a href="http://furkankalkan.com/" target="_blank">Furkan KALKAN</a><br>
        <a href="https://onur.im/" target="_blank">Onur ASLAN</a><br>
        <a href="http://www.omeripek.com.tr" target="_blank">Ömer IPEK</a><br>
        <a href="https://yapaygerizeka.github.io/" target="_blank">Yapay Geri Zekâ</a><br>
    </p>
  </div>
  <div id="social">
    Takip Edin:
<div id="stalker">
   

   
   <a title="MertcanGokgoz on Academia" href="https://baskent.academia.edu/MertcanGokgoz" target="_blank">
     <i class="fa fa-book"></i>
   </a>
   

  
  <a title="MertcanGokgoz on Github" href="https://github.com/MertcanGokgoz" target="_blank">
    <i class="fa fa-github-square"></i>
  </a>
  

  
  <a title="MertcanGokgoz on Gitlab" href="https://gitlab.com/u/MertcanGokgoz" target="_blank">
    <i class="fa fa-gitlab"></i>
  </a>
  

  

  
  <a title="mertcangokgoz on Hacker News" href="https://news.ycombinator.com/user?id=mertcangokgoz" target="_blank">
     <i class="fa fa-hacker-news"></i>
  </a>
  

  
  <a title="mertcangokgoz on Reddit" href="https://www.reddit.com/user/mertcangokgoz" target="_blank">
     <i class="fa fa-reddit-square"></i>
  </a>
  

  

  
  <a title="Mertcan GÖKGÖZ on Stack Overflow" href="http://stackoverflow.com/users/4723344" target="_blank">
    <i class="fa fa-stack-overflow"></i>
  </a>
  

  
  <a title="mertcangokgoz on Twitter" href="https://twitter.com/mertcangokgoz" target="_blank">
    <i class="fa fa-twitter-square"></i>
  </a>
  

  

  

  
  <a title="Mertcan GÖKGÖZ on LinkedIn" href="https://www.linkedin.com/in/mertcangokgoz" target="_blank">
    <i class="fa fa-linkedin-square"></i>
  </a>
  

  
  <a title="Mertcan GÖKGÖZ on Google Plus" href="https://plus.google.com/103305118431759296457" target="_blank">
    <i class="fa fa-google-plus-square"></i>
  </a>
  

  

  
  <a title="Mertcan GÖKGÖZ on Youtube" href="https://www.youtube.com/c/MertcanGokgoz" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  

  
  <a title="RSS feed" id="atom" href="/feed/">
    <i class="fa fa-rss-square"></i>
  </a>
  
</div>

  </div>
</nav>

    </div>
    <div class="nine columns content">
        <div class="menuM">
    <ul class="topnav">
        <li><a class="active" href="https://mertcangokgoz.com/">Anasayfa</a></li>
        <li><a href="https://mertcangokgoz.com/category/analiz/">Analiz</a></li>
        <li><a href="https://mertcangokgoz.com/category/genel/">Genel</a></li>
        <li><a href="https://mertcangokgoz.com/category/guvenlik/">Güvenlik</a></li>
        <li><a href="https://mertcangokgoz.com/category/linux/">Linux</a></li>
        <li><a href="https://mertcangokgoz.com/category/windows/">Windows</a></li>
        <li><a href="https://mertcangokgoz.com/category/nginx/">Nginx</a></li>
        <li><a href="https://mertcangokgoz.com/category/egitimler/">Egitimler</a></li>
        <li><a href="https://mertcangokgoz.com/category/programlama/">Programlama</a></li>
        <li class="icon">
            <a href="javascript:void(0);" style="font-size:15px;" onclick="myFunction()"><i class="fa fa-bars"></i></a>
        </li>
    </ul>
</div>

<script>
    function myFunction() {
        document.getElementsByClassName("topnav")[0].classList.toggle("responsive");
    }
</script>


<p class="meta">
  December 31, 2015
  <a href="/">
    <i class="home fa fa-home fa-2x"></i>
  </a>
  <a href="/search/">
    <i class="home fa fa-search fa-2x"></i>
  </a>
  <a href="javascript:" onclick="window.print();return false;">
    <i class="home fa fa-print fa-2x"></i>
  </a>
</p>

<h1 class="title">Wordpress Sitemap.xml Zafiyeti</h1>

<div id="post">
  <p>Başlığın ilginç geldiğinin farkındayım.Bu günkü yılbaşı özel yazımızda sizlere <strong>wordpress</strong> sitelerde kullanılan ve statik olarak tutulmayan sitemap eklentilerinin aslında sitelere nasıl zarar verebilecek birer saatli bombaya dönüştüğünü göstermek istiyorum.</p>

<p>İlk olarak kullanılacak ekipmanları ayarlamanız gerekiyor.</p>

<ul>
  <li>1 Adet linux tabanlı bilgisayar</li>
  <li>İnternet bağlantısı</li>
</ul>

<p>ilk olarak bilgisayarınızı güzelce açıyorsunuz herşeyi hazırlıyorsunuz koltuğunuzu falan ayarlamanız lazım internete bağlanıyorsunuz.Daha sonrasında sisteminizde aşağıdaki uygulamayı kurmanız gerekiyor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    sudo apt-get install parallel
</code></pre>
</div>

<p>bu uygulama size paralel olarak işlem yapma imkanı tanıyacak yani birden çok istek gönderebilmeye yarayacak kullanım amacınıza göre yapılacak işlemler tabikide değişiklik gösterecek ancak genel amacı paralel işlem yaptırma</p>

<p>Wordpress sitelerde genelde popüler olan üç adet sitemap eklentisi bulunmakta bunlar genellikle sitelerdeki içeriği <strong>PHP</strong> aracılığı ile sitemap oluştururlar yani bir bakıma sanal bir sitemap dosyanız olur. Bu 3 eklentinin de siteler üzerinde yükünün oldukça fazla olduğu ve ram kullanımını ciddi şekilde arttırdığı gözlemlenmiştir.Yapılacak olan işlemde bu dosyalar üzerinde yoğunlaştırılmıştır.</p>

<ul>
  <li>Yoast SEO</li>
  <li>Google XML Sitemap</li>
  <li>All in One SEO Pack</li>
</ul>

<p>Statik olarak oluşturulmayan sitemap her seferinde istek aldığında tekrar ve tekrar sistem tarafından <strong>PHP</strong> aracılığı ile oluşturulur.Bu her oluşturulma da 43 MB ram kullanımı demektir.</p>

<p>43*1000=43000 MB Ram kullanımı demektir.Parametre değiştirilerek daha fazla RAM kullanımı sağlanabilir.Ayrıca sayfaya atılan her isteğin boyutu test için kullandığım bir web sitesinde 1.1MB buluyordu yaptığımız 1000 istekde ise karşı tarafdan 1.1*1000= 1100 MB veri demektir.Hal böyle olunca sitedede ciddi şekilde bir trafik olduğu için isteklere cevap veremeyecek duruma gelmekte ve isteklere timed out vermektedir.</p>

<p>ilk olarak saldırı geldiği anda  <strong>CPU</strong> yavaş yavaş artmaya gelen isteklere cevap verememeye başlıyor. <strong>Ddos</strong> koruması olan sunucularda bu şekilde sistemi kapatabilirsiniz.Çünkü bu basit bir HTTP saldırısıdır.Ancak engellenmesi kolaydır.</p>

<p>Saldırıya başladığımız ilk anda sistemden bir görüntü (Sisteme zarar vermemesi amacıyla 30 sn den sonra devam edilmemiştir.)</p>

<p><img src="/assets/sitemapzafiyetgorsel1.png" alt="sitemapzafiyetgorsel1" /></p>

<p>Saldırıya devam ettiğimizde <strong>CPU</strong> kullanımı <strong>%100</strong> RAM kullanımı da <strong>%98</strong> lere fırlıyor.Tabi sitede kullanılan eklentiye göre durum değişiyor misal all in seo kullanılıyor ise sadece <strong>CPU</strong> fırlıyor. <strong>Google XML Sitemap</strong> eklentisi ve <strong>Yoast SEO</strong> eklentisinde ki sitemap özelliği kullanılırsa hem <strong>CPU</strong> hemde <strong>RAM</strong> de ciddi derecede bir yükselme oluyor.</p>

<p>Saldırı anında ise web server tarafından tutulan loglara göz atabilirsiniz.Şu şekilde bir takım loglar ile karşılaşacaksınız.</p>

<p><img src="/assets/saldirianiloglar.png" alt="saldirianiloglar" /></p>

<p>Direk olarak <strong>HTTP GET</strong> saldırısını simule eden ilginç bir yapıya sahip olduk normalde pek çok site bu denli bir isteğe alışkındır ancak cache sistemi ile tutulmayan ve gelen her istek için yeniden sayfa oluşturan sistemlerde bu zafiyet oldukça etkili olacaktır. Tabi ki kullanılmasını önermiyoruz.</p>

<p>Parametremiz ise şu şekilde</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    seq 100000 | parallel -j0 --joblog log curl -s siteadresi/sitemap.xml{} "&gt;" {}.txt
</code></pre>
</div>

<p>bu komutu kullanırken mümkün olduğunca dizini rastgele seçmeyin oluşacak olan <strong>txt</strong> dosyalarını kontrol edemeyeceğiniz için sıkıntı çıkartabilir herhangi bir klasör oluşturup bu komutu da o klasör içerisinde vermenizi öneririm.</p>

<p>Peki bu sıkıntıdan nasıl kurtulursunuz.Herhangi birisinin <strong>sitemap</strong> üzerinden yaptığı bu saldırıyı durdurmanız için gelen istekleri limitlemeniz oldukça işinize yarayacak.</p>

<p><strong>nginx.conf</strong> dosyanızın içerisine http{ } bloğu içerisine aşağıdaki 2 adet komutu ekliyorsunuz ilki gelen istekleri limitler ikinciside bağlantıyı limitler</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;
    limit_conn_zone $binary_remote_addr zone=addr:10m;
</code></pre>
</div>

<p>bu iki komut sonrasında <strong>sitenizde kullandığınız conf</strong> dosyasına aşağıdaki gibi bir satırı eklemeniz yeterli olacak.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    location = .xml{
            limit_req zone=one burst=10;
    }
</code></pre>
</div>

<p>aynı şekilde PHP uzantılı dosyalarada şöyle bir ekleme yapabilirsiniz.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    location ~ .php$ {
            limit_req zone=one burst=10;
            limit_conn addr 1;
    }
</code></pre>
</div>

<p>bu sayede sistemdeki dosyalarınıza gelen istekler sizin belirlemiş olduğunuz sınırı geçerse otomatik olarak yasaklanacak ve gereksiz yere sistem tüketmesi yaşanmayacak.Kesin bir çözüm olmasa da işinize oldukça yarayacağını düşünüyorum.</p>

<p>Yardımlarından dolayı <strong><a href="http://furkankalkan.me/">Furkan Kalkan</a></strong> a Teşekkür ederim.</p>

<p>NOT:Yukarıdaki bahsettiklerim sistem yöneticileri tarafından unutulan ve yapılması gereken mutlak ayarlamaları içermekte ve bu ayarların yapılmaması dahilinde oluşabilecek basit ama zararlı zafiyeti göstermek amacı ile yazılmıştır.Site içerisinde bulunan ve uzantısı farklı olan dosyaların ve dinamik olarak oluşturulan tüm sayfaların korumaya alınması mecburidir.</p>

</div>

<div id="paylasim">
<h3>Bu yazıyı paylaş:</h3>
<a href="https://www.facebook.com/sharer/sharer.php?u=https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" >
    <i class="fa fa-facebook-square fa share-button"> Facebook</i>
</a>
<a href="https://twitter.com/intent/tweet?text=Wordpress Sitemap.xml Zafiyeti&url=https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/&via=mertcangokgoz&related=mertcangokgoz" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;">
    <i class="fa fa-twitter-square fa share-button"> Twitter</i>
</a>
<a href="https://plus.google.com/share?url=https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" >
    <i class="fa fa-google-plus-square fa share-button"> Google</i>
</a>
<a href="http://www.reddit.com/submit?url=https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/&title=Wordpress Sitemap.xml Zafiyeti" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" >
    <i class="fa fa-reddit-square fa share-button"> Reddit</i>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/&title=Wordpress Sitemap.xml Zafiyeti&summary=&source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" >
    <i class="fa fa-linkedin-square fa share-button"> Linkedin</i>
</a>
<a href="mailto:?subject=Wordpress Sitemap.xml Zafiyeti&amp;body=Check out this site https://mertcangokgoz.com/wordpress-sitemap-xml-zafiyeti/">
    <i class="fa fa-envelope-square fa share-button"> Email</i>
</a>
</div>


<div class="ajaxloadcomment"><button class="show-comments">Yorumları yükle</button></div>
<div itemprop="comment" id="disqus_thread"></div>
<script>
$(document).ready(function() {
    $('.show-comments').on('click', function(){
          var disqus_shortname = 'mertcanofficial';

          $.ajax({
                  type: "GET",
                  url: "//" + disqus_shortname + ".disqus.com/embed.js",
                  dataType: "script",
                  cache: true
          });
          $(this).fadeOut();
    });
});
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



      <div class="footer">
        <div class="disclaimer">
  
  <p>
    Bu sitedeki gönderiler bana aittir ve iş verenime ait pozisyonlar,
    stratejiler veya görüşler temsil edilmemektedir.<br>
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Atıf-Paylaşım Lisansı</a> altındadır.<br>
        <a href="/ders-notlari/">Ders Notları</a>
        <span> | </span><a href="/gizlilik-politikasi/">Gizlilik Politikası</a>
        <span> | </span><a href="/kullanim-kosullari/">Kullanım Koşulları</a>
        <span> | </span><a href="/hakkimda/">Hakkımda</a>
        <span> | </span><a href="/iletisim/">İletişim</a><br>
        <b>BTC:</b> 36DFx4anTdsx3AnBiA1oqR3oHkMV3RJME1<br>
        <a href="/hosted/">Hosted By </a> © Mertcan GÖKGÖZ, 2016 - Linux Hacısı
  </p>
  
</div>

      </div>
    </div>
  </div>
  <div id="up">
    <a href="javascript:"><i class="fa fa-arrow-up fa-2x"></i></a>
  </div>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-41967916-5', 'auto');
    ga('send', 'pageview');
  </script>







</body>
</html>
