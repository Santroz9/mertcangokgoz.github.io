



<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>nasldoc: nasl</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le styles -->
  <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/shCore.css" rel="stylesheet" type="text/css" />
  <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="shortcut icon" href="ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

	<div class="navbar navbar-inverse navbar-fixed-top">
	  <div class="navbar-inner">
		<div class="container-fluid">
		  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </a>
		  <a class="brand" href="index.html">nasldoc</a>
		  <div class="nav-collapse collapse">
			<ul class="nav">
			  <li class="active"><a href="index.html">Home</a></li>
			</ul>
		  </div><!--/.nav-collapse -->
		</div>
	  </div>
	</div>

  <div class="container-fluid">
	<div class="row-fluid">
	<div class="span3">
	  <div class="well sidebar-nav">
	  <ul class="nav nav-list">
		
			
			
			<li class="even">
			  <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="GSHB_read_file.html">GSHB_read_file.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="bin.html">bin.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="byte_func.html">byte_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="cisco_ios.html">cisco_ios.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="cpe.html">cpe.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="default_account.html">default_account.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="default_credentials.html">default_credentials.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="dump.html">dump.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ftp_func.html">ftp_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="global_settings.html">global_settings.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="host_details.html">host_details.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="hp_printers.html">hp_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="http_func.html">http_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="http_keepalive.html">http_keepalive.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="imap_func.html">imap_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="itg.html">itg.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="junos.html">junos.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="kyocera_printers.html">kyocera_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ldap.html">ldap.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="lexmark_printers.html">lexmark_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="misc_func.html">misc_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="netop.html">netop.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="network_func.html">network_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="nfs_func.html">nfs_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="nmap.html">nmap.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="nntp_func.html">nntp_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="os_eol.html">os_eol.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pingpong.html">pingpong.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pop3_func.html">pop3_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="revisions-lib.html">revisions-lib.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="rsync_func.html">rsync_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_activex.html">secpod_activex.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_reg.html">secpod_reg.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="secpod_smb_func.html">secpod_smb_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="sharp_printers.html">sharp_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="sip.html">sip.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="smb_default_credentials.html">smb_default_credentials.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="smb_nt.html">smb_nt.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="smbcl_func.html">smbcl_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="smtp_func.html">smtp_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="snmp_func.html">snmp_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="solaris.html">solaris.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="ssh_func.html">ssh_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ssl_funcs.html">ssl_funcs.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="telnet_func.html">telnet_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="tftp.html">tftp.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="uddi.html">uddi.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="url_func.html">url_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="version_func.html">version_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="vmware_esx.html">vmware_esx.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_file.html">wmi_file.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_hardware.html">wmi_hardware.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_misc.html">wmi_misc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_os.html">wmi_os.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_proc.html">wmi_proc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_rsop.html">wmi_rsop.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_svc.html">wmi_svc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_user.html">wmi_user.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wordlist.html">wordlist.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="xerox_printers.html">xerox_printers.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="xml.html">xml.inc</a>
			</li>
		
	  </ul>
	  </div><!--/.well -->
	</div><!--/span-->
	<div class="span9">

		<a name="top"></a>
		<h1>Overview of ftp_func.inc</h1>
		

		

		
		
		
		
		

		
		
		<h1>Public Function Summary</h1>

		
		<p>Public functions are intended to be called by the code that imports
		this library.</p>
		

		<table class="nopad">
		  <tr class="TableHeadingColor">
			<th>Name</th>
			<th>Summary</th>
		  </tr>
		  
		  <tr>
			<td><a href="#ftp_authenticate">ftp_authenticate</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ftp_close">ftp_close</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ftp_pasv">ftp_pasv</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ftp_recv_data">ftp_recv_data</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ftp_recv_line">ftp_recv_line</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ftp_recv_listing">ftp_recv_listing</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ftp_send_cmd">ftp_send_cmd</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#get_ftp_banner">get_ftp_banner</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#get_ftp_port">get_ftp_port</a></td>
			<td></td>
		  </tr>
		  
		</table>
		
		
		
		

		
		
		
		
		

		
		
		<h1>Public Function Details</h1>
		
		<h2 id="ftp_authenticate">ftp_authenticate</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>pass</dt>
			
		
			<dt>socket</dt>
			
		
			<dt>user</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ftp_authenticate( socket, user, pass ) {

  local_var r;

  if( ! socket ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#socket#-#ftp_authenticate&quot; );
  if( ! user ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#user#-#ftp_authenticate&quot; );
  if( ! pass ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#pass#-#ftp_authenticate&quot; );
 
  r = ftp_recv_line( socket:socket ); # Receive the banner
  send( socket:socket, data:&#39;USER &#39; + user + &#39;\r\n&#39; );
  r = ftp_recv_line( socket:soc );
  if( r[0] != &#39;3&#39; &amp;&amp; 
      r[0] != &#39;2&#39; ) return 0;

  send( socket:socket, data:&#39;PASS &#39; + pass + &#39;\r\n&#39; );
  r = ftp_recv_line( socket:socket );
  if( r[0] != &#39;2&#39; ) return 0;
  else return 1;
}

#

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ftp_close">ftp_close</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>socket</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ftp_close( socket ) {

  if( ! socket ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#socket#-#ftp_close&quot; );

  send( socket:socket, data:&#39;QUIT\r\n&#39; );
  close( socket );
}

function get_ftp_banner( port ) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ftp_pasv">ftp_pasv</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>socket</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ftp_pasv( socket ) {

  local_var r, port, array;

  if( ! socket ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#socket#-#ftp_pasv&quot; );
 
  send( socket:socket, data:&#39;PASV\r\n&#39; );
  r = ftp_recv_line( socket:soc );
  if( r[0] != &#39;2&#39; ) return 0;
  port = egrep( pattern:&quot;^227 .* \([0-9]+,[0-9]+,[0-9]+,[0-9]+,[0-9]+,[0-9]+\)&quot;,
	        string:r );
  if( ! port ) return 0;
  array = eregmatch( pattern:&quot;^227 .* \([0-9]+,[0-9]+,[0-9]+,[0-9]+,([0-9]+),([0-9]+)\)&quot;, string:port );
  if( isnull( array ) ) return 0;
  port = int( array[1] ) * 256 + int( array[2] );
  return port;
}

function get_ftp_port( default ) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ftp_recv_data">ftp_recv_data</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>line</dt>
			
		
			<dt>socket</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ftp_recv_data( socket, line ) {

  local_var buf, bytes, min;

  if( ! socket ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#socket#-#ftp_recv_data&quot; );

  if( line != NULL ) {
    bytes = ereg_replace( pattern:&quot;^150.*\(([0-9]*) .*\)&quot;, string:line, replace:&quot;\1&quot; );
  }
 
  if( ! bytes ) { bytes = 8192; min = 1; }
  else { min = int( bytes ); bytes = int( bytes) ; }
 
  return recv( socket:socket, min:bytes, length:bytes );
}

#

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ftp_recv_line">ftp_recv_line</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>retry</dt>
			
		
			<dt>socket</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ftp_recv_line( socket, retry ) {

  local_var n, r, res, t1, t2;

  if( ! socket ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#socket#-#ftp_recv_line&quot; );

  r = recv_line( socket:socket, length:65535 );
  n = 0;
  if( log_verbosity &gt; 1 ) t1 = unixtime();
  while( strlen( r ) == 0 &amp;&amp; n ++ &lt; retry )
    r = recv_line( socket:socket, length:65535 );
    if (log_verbosity &gt; 0) {
      t2 = unixtime();
      if( n &gt; 0 &amp;&amp; t2 - t1 &gt; 1 ) log_print( &#39;ftp_recv_line: retried &#39;, n, &#39; time( s ) = &#39;, t2-t1, &#39;s. Increase read timeout!\n&#39; );
    }
    if( strlen( r ) &lt; 4 ) 
      return( r );

  n = 0;
  res = r;
  # Some FTP servers have a broken banner on several lines with a leading space
  while( ( strlen( r ) &gt; 3 &amp;&amp; r[3] == &quot;-&quot; ) || ( strlen( r ) &gt;= 3 &amp;&amp; r[0] == &#39; &#39; ) ) {
    n ++;
    r = recv_line( socket:socket, length:65535 );
    if( n &gt; 255 )
      return( NULL );
    res = res + r;
  }
  return( res );
}

function ftp_recv_listing( socket ) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ftp_recv_listing">ftp_recv_listing</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>socket</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ftp_recv_listing( socket ) {

  local_var n, r, buf;

  if( ! socket ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#socket#-#ftp_recv_listing&quot; );
 
  n = 0;
  r = recv_line( socket:socket, length:65535 );
  buf = r;
  while( strlen( r ) ) {
    n ++;
    if( n &gt; 4096 )
      return( NULL );
    r = recv_line( socket:socket, length:65535 );
    buf += r; 
  }
  return buf;
}

function ftp_recv_data( socket, line ) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ftp_send_cmd">ftp_send_cmd</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>cmd</dt>
			
		
			<dt>socket</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ftp_send_cmd( socket, cmd ) {

 if( ! socket ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#socket#-#ftp_send_cmd&quot; );
 if( ! cmd ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#cmd#-#ftp_send_cmd&quot; );

 send( socket:socket, data:cmd + &#39;\r\n&#39; );
 return ftp_recv_line( socket:socket );
}

function ftp_recv_line( socket, retry ) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="get_ftp_banner">get_ftp_banner</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>port</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function get_ftp_banner( port ) {

  local_var lines, sb, banner, soc, str;

  if( ! port ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#port#-#get_ftp_banner&quot; );

  lines = 0;
  sb = &quot;ftp/banner/&quot; + port;
  banner = get_kb_item( sb );
  if( banner ) return( banner );
  if( get_kb_item( &quot;ftp/&quot; + port + &quot;/broken&quot; ) ) exit( 0 );

  if( ! get_port_state( port ) ) return (0);
  soc = open_sock_tcp( port );
  if( ! soc ) {
    set_kb_item( name:&quot;ftp/&quot; + port + &quot;/broken&quot;, value:TRUE );
    return NULL;
  }
  banner = ftp_recv_line( socket:soc );
  ftp_close( socket:soc );
  if( ! banner ) {
    set_kb_item( name:&quot;ftp/&quot; + port + &quot;/broken&quot;, value:TRUE );
    return NULL;
  }
  replace_kb_item( name:sb, value:banner );
  return( banner );
}

function ftp_send_cmd( socket, cmd ) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="get_ftp_port">get_ftp_port</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>default</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function get_ftp_port( default ) {

  local_var default, port, p;

  if( ! default ) set_kb_item( name: &quot;nvt_debug_empty/&quot; + get_script_oid(), value:get_script_oid() + &quot;#-#default#-#get_ftp_port&quot; );

  port = get_kb_item( &quot;Services/ftp&quot; );
  if( port ) default = port;

  p = get_kb_item( &quot;ftp/&quot; + default + &quot;/broken&quot; );
  if( p ) exit( 0 );

  if( ! get_port_state( default ) ) exit( 0 );

  return default;
}

		</pre>
		<a href="#top">top</a>
		<hr>
		
		
		
		
		

	</div><!--/span-->
	</div><!--/row-->

	<hr>

	<footer>
		<p>&copy; Tenable Network Security 2014</p>
	</footer>

  </div><!--/.fluid-container-->

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="js/jquery-1.8.2.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/shCore.js"></script>
  <script type="text/javascript" src="js/shBrushNasl.js"></script>

  <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script>

  </body>
</html>
