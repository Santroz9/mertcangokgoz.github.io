



<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>nasldoc: nasl</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le styles -->
  <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/shCore.css" rel="stylesheet" type="text/css" />
  <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="shortcut icon" href="ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

	<div class="navbar navbar-inverse navbar-fixed-top">
	  <div class="navbar-inner">
		<div class="container-fluid">
		  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </a>
		  <a class="brand" href="index.html">nasldoc</a>
		  <div class="nav-collapse collapse">
			<ul class="nav">
			  <li class="active"><a href="index.html">Home</a></li>
			</ul>
		  </div><!--/.nav-collapse -->
		</div>
	  </div>
	</div>

  <div class="container-fluid">
	<div class="row-fluid">
	<div class="span3">
	  <div class="well sidebar-nav">
	  <ul class="nav nav-list">
		
			
			
			<li class="even">
			  <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="GSHB_read_file.html">GSHB_read_file.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="bin.html">bin.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="byte_func.html">byte_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="cisco_ios.html">cisco_ios.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="cpe.html">cpe.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="default_account.html">default_account.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="default_credentials.html">default_credentials.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="dump.html">dump.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ftp_func.html">ftp_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="global_settings.html">global_settings.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="host_details.html">host_details.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="hp_printers.html">hp_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="http_func.html">http_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="http_keepalive.html">http_keepalive.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="imap_func.html">imap_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="itg.html">itg.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="junos.html">junos.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="kyocera_printers.html">kyocera_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ldap.html">ldap.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="lexmark_printers.html">lexmark_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="misc_func.html">misc_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="netop.html">netop.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="network_func.html">network_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="nfs_func.html">nfs_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="nmap.html">nmap.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="nntp_func.html">nntp_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="os_eol.html">os_eol.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pingpong.html">pingpong.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pop3_func.html">pop3_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="revisions-lib.html">revisions-lib.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="rsync_func.html">rsync_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_activex.html">secpod_activex.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_reg.html">secpod_reg.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="secpod_smb_func.html">secpod_smb_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="sharp_printers.html">sharp_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="sip.html">sip.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="smb_default_credentials.html">smb_default_credentials.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="smb_nt.html">smb_nt.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="smbcl_func.html">smbcl_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="smtp_func.html">smtp_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="snmp_func.html">snmp_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="solaris.html">solaris.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="ssh_func.html">ssh_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ssl_funcs.html">ssl_funcs.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="telnet_func.html">telnet_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="tftp.html">tftp.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="uddi.html">uddi.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="url_func.html">url_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="version_func.html">version_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="vmware_esx.html">vmware_esx.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_file.html">wmi_file.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_hardware.html">wmi_hardware.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_misc.html">wmi_misc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_os.html">wmi_os.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_proc.html">wmi_proc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_rsop.html">wmi_rsop.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_svc.html">wmi_svc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_user.html">wmi_user.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wordlist.html">wordlist.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="xerox_printers.html">xerox_printers.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="xml.html">xml.inc</a>
			</li>
		
	  </ul>
	  </div><!--/.well -->
	</div><!--/span-->
	<div class="span9">

		<a name="top"></a>
		<h1>Overview of vmware_esx.inc</h1>
		

		

		
		

		<h1>Public Variable Summary</h1>

		
		<p>Public variables are intended to be accessed by the code that imports
		this library.</p>
		

		<table class="nopad">
		  <tr class="TableHeadingColor">
			<th>Name</th>
			<th>Summary</th>
		  </tr>
		  
		  <tr>
			<td><a href="#esxi_error">esxi_error</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#esxi_version">esxi_version</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#installed_bulletins">installed_bulletins</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#port">port</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#response">response</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#sess">sess</a></td>
			<td></td>
		  </tr>
		  
		</table>
		
		
		
		

		
		
		<h1>Public Function Summary</h1>

		
		<p>Public functions are intended to be called by the code that imports
		this library.</p>
		

		<table class="nopad">
		  <tr class="TableHeadingColor">
			<th>Name</th>
			<th>Summary</th>
		  </tr>
		  
		  <tr>
			<td><a href="#esxi_remote_report">esxi_remote_report</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#get_esxi4_x_vibs">get_esxi4_x_vibs</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#get_esxi5_0_vibs">get_esxi5_0_vibs</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#get_installed_esxi_4_x_bulletins">get_installed_esxi_4_x_bulletins</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#parse_esxi_4_x_response">parse_esxi_4_x_response</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#parse_esxi_5_0_response">parse_esxi_5_0_response</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#start_esxi_session">start_esxi_session</a></td>
			<td></td>
		  </tr>
		  
		</table>
		
		
		
		<h1>Private Function Summary</h1>

		
		<p>Private functions are not intended to be called by the code that
		imports this library. There is no functional difference between private
		and public functions, only convention, and they may be called as
		normal. </p>
		

		<table class="nopad">
		  <tr class="TableHeadingColor">
			<th>Name</th>
			<th>Summary</th>
		  </tr>
		  
		  <tr>
			<td><a href="#_esx_error">_esx_error</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#_esxi_build_soap">_esxi_build_soap</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#_esxi_patch_missing">_esxi_patch_missing</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#_esxi_soap_request">_esxi_soap_request</a></td>
			<td></td>
		  </tr>
		  
		</table>
		
		

		
		
		<h1>Public Variable Details</h1>
		
		<h2 id="esxi_error">esxi_error</h2>
		

		

		<a href="#top">top</a>
		<hr>
		
		<h2 id="esxi_version">esxi_version</h2>
		

		

		<a href="#top">top</a>
		<hr>
		
		<h2 id="installed_bulletins">installed_bulletins</h2>
		

		

		<a href="#top">top</a>
		<hr>
		
		<h2 id="port">port</h2>
		

		

		<a href="#top">top</a>
		<hr>
		
		<h2 id="response">response</h2>
		

		

		<a href="#top">top</a>
		<hr>
		
		<h2 id="sess">sess</h2>
		

		

		<a href="#top">top</a>
		<hr>
		
		
		
		
		

		
		
		<h1>Public Function Details</h1>
		
		<h2 id="esxi_remote_report">esxi_remote_report</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>build</dt>
			
		
			<dt>fixed_build</dt>
			
		
			<dt>typ</dt>
			
		
			<dt>ver</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function esxi_remote_report(ver, build, fixed_build, typ) {

  if(isnull(ver) || isnull(build) || isnull(fixed_build))return;

  space = &#39; &#39;;
  if(!typ)
  {
    typ = &#39;ESXi&#39;;
    space = &#39;    &#39;;
  }  

  report = typ + &#39; Version:&#39; + space  + ver + &#39;\n&#39; +
           &#39;Detected Build:  &#39; + build + &#39;\n&#39; +
           &#39;Fixed Build:     &#39; + fixed_build + &#39;\n&#39;;

  return report;

}



		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="get_esxi4_x_vibs">get_esxi4_x_vibs</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>pass</dt>
			
		
			<dt>port</dt>
			
		
			<dt>user</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function get_esxi4_x_vibs(port,user,pass) {

  local_var user, pass, c, t, task, recv, resp;

  if(esxi_version !~ &quot;^4\.&quot;) {
    _esx_error(data:&#39;ESXi 4.x: Wrong ESXi version. Expected: 4.x. Received: &#39; + esxi_version  + &#39;\n&#39;);
    return FALSE;
  }


  if(!user || !pass) {
    _esx_error(data:&#39;ESXi 4.x: Could not find user or password\n&#39;);
    return FALSE;
  }  

  if(!start_esxi_session(user:user,pass:pass)) {
    return FALSE;
  }

  recv = _esxi_soap_request(data:&#39;
                                &lt;RetrieveProperties xmlns=&quot;urn:vim25&quot;&gt;
                                &lt;_this type=&quot;PropertyCollector&quot;&gt;ha-property-collector&lt;/_this&gt;
                                &lt;specSet&gt;
                                  &lt;propSet&gt;
                                    &lt;type&gt;HostSystem&lt;/type&gt;
                                    &lt;all&gt;0&lt;/all&gt;
                                  &lt;/propSet&gt;
                                  &lt;objectSet&gt;
                                    &lt;obj type=&quot;Folder&quot;&gt;ha-folder-root&lt;/obj&gt;
                                    &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;folderTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;Folder&lt;/type&gt;
                                      &lt;path&gt;childEntity&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;folderTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;datacenterHostTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;datacenterVmTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;datacenterDatastoreTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;datacenterNetworkTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;computeResourceRpTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;computeResourceHostTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;hostVmTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;resourcePoolVmTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;datacenterDatastoreTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;Datacenter&lt;/type&gt;
                                      &lt;path&gt;datastoreFolder&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;folderTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;datacenterNetworkTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;Datacenter&lt;/type&gt;
                                      &lt;path&gt;networkFolder&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;folderTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;datacenterVmTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;Datacenter&lt;/type&gt;
                                      &lt;path&gt;vmFolder&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;folderTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;datacenterHostTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;Datacenter&lt;/type&gt;
                                      &lt;path&gt;hostFolder&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;folderTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;computeResourceHostTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;ComputeResource&lt;/type&gt;
                                      &lt;path&gt;host&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;computeResourceRpTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;ComputeResource&lt;/type&gt;
                                      &lt;path&gt;resourcePool&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;resourcePoolTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;resourcePoolVmTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;resourcePoolTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;ResourcePool&lt;/type&gt;
                                      &lt;path&gt;resourcePool&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;resourcePoolTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;resourcePoolVmTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;hostVmTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;HostSystem&lt;/type&gt;
                                      &lt;path&gt;vm&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;selectSet&gt;
                                      &lt;name&gt;folderTraversalSpec&lt;/name&gt;
                                    &lt;/selectSet&gt;
                                    &lt;/selectSet&gt;
                                    &lt;selectSet xsi:type=&quot;TraversalSpec&quot;&gt;
                                      &lt;name&gt;resourcePoolVmTraversalSpec&lt;/name&gt;
                                      &lt;type&gt;ResourcePool&lt;/type&gt;
                                      &lt;path&gt;vm&lt;/path&gt;
                                      &lt;skip&gt;0&lt;/skip&gt;
                                    &lt;/selectSet&gt;
                                &lt;/objectSet&gt;
                            &lt;/specSet&gt;
                        &lt;/RetrieveProperties&gt;&#39;,
                        search:&quot;HostSystem&quot;);

  if(!recv) {
    _esx_error(data:&#39;ESXi 4.x: Preparing failed\n&#39;);
    return FALSE;
  }  

  hs = eregmatch(pattern:&#39;&lt;obj type=&quot;HostSystem&quot;&gt;(.*)&lt;/obj&gt;&#39;, string:recv);

  if(!isnull(hs[1])) {
    HostSystem = hs[1];
  } else {
    HostSystem = &quot;ha-host&quot;;
  }  

  recv = _esxi_soap_request(data:&#39;
                                &lt;RetrieveProperties xmlns=&quot;urn:vim25&quot;&gt;
                                &lt;_this type=&quot;PropertyCollector&quot;&gt;ha-property-collector&lt;/_this&gt;
                                &lt;specSet&gt;
                                  &lt;propSet&gt;
                                    &lt;type&gt;HostSystem&lt;/type&gt;
                                    &lt;all&gt;0&lt;/all&gt;
                                    &lt;pathSet&gt;configManager.patchManager&lt;/pathSet&gt;
                                  &lt;/propSet&gt;
                                  &lt;objectSet&gt;
                                    &lt;obj type=&quot;HostSystem&quot;&gt;&#39; + HostSystem + &#39;&lt;/obj&gt;
                                  &lt;/objectSet&gt;
                                &lt;/specSet&gt;
                                &lt;/RetrieveProperties&gt;&#39;,
                                search:&quot;PatchManager&quot;);

  if(!recv) {
    _esx_error(data:&#39;ESXi 4.x: Initiating patch Manager failed\n&#39;);
    return FALSE;
  }  
 
  hpm = eregmatch(pattern:&#39;&lt;val type=&quot;HostPatchManager&quot; xsi:type=&quot;ManagedObjectReference&quot;&gt;(.*)&lt;/val&gt;&#39;, string: recv);

  if(!isnull(hpm[1])) {
    HostPatchManager = hpm[1];
  }  else {
    _esx_error(data:&#39;ESXi 4.x: Patch manager not found on this system.\n\n&#39;);
    return FALSE;
  }  

  recv = _esxi_soap_request(data:&#39;
                                &lt;QueryHostPatch_Task xmlns=&quot;urn:vim25&quot;&gt;
                                  &lt;_this type=&quot;HostPatchManager&quot;&gt;&#39; + HostPatchManager + &#39;&lt;/_this&gt;
                                &lt;/QueryHostPatch_Task&gt;&#39;,
                                search:&quot;Query-&quot;);

  if(!recv) {
    _esx_error(data:&#39;ESXi 4.x: Getting Task ID failed\n&#39;);
    return FALSE;
  }  

  t = eregmatch(pattern:&#39;&lt;returnval type=&quot;Task&quot;&gt;(.*Query-[0-9]+)&lt;/returnval&gt;&#39;,string:recv);
  if(isnull(t[1])) {
    _esx_error(data:&#39;ESXi 4.x: Could not extract Task ID\n&#39;);
    return FALSE;
  }  

  task = t[1];

  recv = get_installed_esxi_4_x_bulletins(task);

  if(!recv) {
    _esx_error(data:&#39;ESXi 4.x: Could not get installed bulletins/patches.\n&#39;);
    return FALSE;
  }

  if(resp = parse_esxi_4_x_response(recv:recv)) return TRUE;

  return FALSE;

}

function get_installed_esxi_4_x_bulletins(task) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="get_esxi5_0_vibs">get_esxi5_0_vibs</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>pass</dt>
			
		
			<dt>port</dt>
			
		
			<dt>user</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function get_esxi5_0_vibs(port,user,pass) {

  local_var user, pass, recv;

  if(esxi_version !~ &quot;^(5|6)\.&quot;) {
    _esx_error(data:&#39;ESXi 5.x: Wrong ESXi version. Expected: 5.x/6.x. Received: &#39; + esxi_version  + &#39;\n&#39;);
    return FALSE;
  }

  if(!user || !pass) {
    _esx_error(data:&#39;ESXi 5.x: Could not find user or password\n&#39;);
    return FALSE;
  }

  if(!start_esxi_session(user:user,pass:pass)) {
    return FALSE;
  }

  recv = _esxi_soap_request(data:&#39;
                            &lt;VimEsxCLIsoftwareviblist xmlns=&quot;urn:vim25&quot;&gt;
                              &lt;_this type=&quot;VimEsxCLIsoftwarevib&quot;&gt;ha-cli-handler-software-vib&lt;/_this&gt;
                            &lt;/VimEsxCLIsoftwareviblist&gt;&#39;,
                            search:&quot;&lt;VimEsxCLIsoftwareviblistResponse&quot;);


  if(!recv) {
    _esx_error(data:&#39;ESXi 5.x: Could not get installed bulletins/patches\n&#39;);
    return FALSE;
  }  

  if(resp = parse_esxi_5_0_response(recv:recv)) return TRUE;

  return FALSE;

}

function get_esxi4_x_vibs(port,user,pass) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="get_installed_esxi_4_x_bulletins">get_installed_esxi_4_x_bulletins</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>task</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function get_installed_esxi_4_x_bulletins(task) {

  local_var i, max_retries, recv;

  max_retries = 15;
  i = 0;

  while (TRUE) {

    i++;

    if( i &gt; max_retries )  {
      response = &#39;Failed to get the installed bulletins/patches after &#39; + max_retries + &#39; retries\nLast recv was: &#39; + recv + &#39;\n&#39;;
      return FALSE;
    }

    recv = _esxi_soap_request(data:&#39;
                &lt;RetrieveProperties xmlns=&quot;urn:vim25&quot;&gt;
                &lt;_this type=&quot;PropertyCollector&quot;&gt;ha-property-collector&lt;/_this&gt;
                &lt;specSet&gt;
                  &lt;propSet&gt;
                    &lt;type&gt;Task&lt;/type&gt;
                    &lt;all&gt;1&lt;/all&gt;
                  &lt;/propSet&gt;
                  &lt;objectSet&gt;
                    &lt;obj type=&quot;Task&quot;&gt;&#39; +  task   +&#39;&lt;/obj&gt;
                  &lt;/objectSet&gt;
                &lt;/specSet&gt;
              &lt;/RetrieveProperties&gt;&#39;);

    if(!recv) {
      return FALSE;
    }  

    recv = str_replace(string:recv,find:&quot;&amp;gt;&quot;,replace:&quot;&gt;&quot;);
    recv = str_replace(string:recv,find:&quot;&amp;lt;&quot;,replace:&quot;&lt;&quot;);
    recv = str_replace(string:recv,find:&quot;&amp;quot;&quot;,replace:&#39;&quot;&#39;);

    if(&#39;&lt;state&gt;error&lt;/state&gt;&#39; &gt;&lt; recv) {
      return FALSE;
    }  

    if(&#39;&lt;state&gt;success&lt;/state&gt;&#39; &gt;&lt; recv) {

      if(&#39;&lt;error&#39; &gt;&lt; recv &amp;&amp; &#39;&lt;/error&gt;&#39; &gt;&lt; recv) { # even if we got a success on the _query_, the PatchManager could fail...

        ec = eregmatch(pattern:&#39;&lt;errorCode&gt;([0-9]+)&lt;/errorCode&gt;&#39;, string: recv);
        if(!isnull(ec[1])) {
          response = &#39;Code: &#39; + ec[1] + &#39;\n&#39;;
        }

        ed = eregmatch(pattern:&#39;&lt;errorDesc&gt;(.*)&lt;/errorDesc&gt;&#39;, string:recv);
        if(!isnull(ed[1])) {
           response = response + &#39;Message: &#39; + ed[1] + &#39;\n\n&#39;;
        }

        return FALSE;

      }  

      return recv;
    }

    sleep (3);

  }

  return FALSE;

}  

function parse_esxi_4_x_response(recv) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="parse_esxi_4_x_response">parse_esxi_4_x_response</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>recv</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function parse_esxi_4_x_response(recv) {

  local_var last, date, datematch, bl, recv, bulletins, line;

  if(strlen(recv) &lt; 1) {
    _esx_error(data:&#39;ESXi 4.x: Unexpected response from ESXi server\n&#39;);
    return FALSE;
  } 

  bl = split(recv);

  recv = str_replace(string:recv, find:string(&quot;\n&quot;),replace:&quot;&quot;);
  recv = str_replace(string:recv, find:string(&quot;\r&quot;),replace:&quot;&quot;);
  recv = str_replace(string:recv, find:string(&quot;\t&quot;),replace:&quot;&quot;);
  recv = ereg_replace(string:recv, pattern:&quot;&gt;[ ]+&lt;&quot;, replace:&quot;&gt;&lt;&quot;);

  bulletins = eregmatch(pattern:&quot;(&lt;bulletin&gt;.*&lt;/bulletin&gt;)&quot;, string:recv);

  if(isnull(bulletins[1])) {
     set_kb_item(name:&#39;VMware/ESXi/&#39; + esxi_version  + &#39;/unpatched&#39;, value:TRUE);
     log_message(data:&#39;Could not found a single bulletin installed on this host. Assuming this\nis a completly unpatched system. \nRECV:\n&#39; + recv + &#39;\n&#39;);
     return TRUE;
  }   

  last = NULL;

  foreach line (bl) {

    if(&quot;&lt;releaseDate&gt;&quot; &gt;&lt; line) {

      datematch = eregmatch(pattern:&quot;(20[0-9][0-9]-[012][0-9]-[0-3][0-9])&quot;,string:line);
      date = datematch[1];

      if (!isnull(date) &amp;&amp; (isnull(last) || date &gt; last)) last = date;
    }

    if(ib = eregmatch(pattern:&quot;&lt;id&gt;(ESXi?[0-9]+-.*)&lt;/id&gt;&quot;, string: line)) {
      if(!isnull(ib[1])) {
        installed_bulletins += ib[1] + &#39;\n&#39;;
      }  
    }  

  }

  if(installed_bulletins) {
    set_kb_item(name:&#39;VMware/esxi/&#39; + esxi_version  + &#39;/bulletins&#39;, value:chomp(str_replace(string:installed_bulletins, find:&#39;\n&#39;, replace:&quot; &quot;)));
  }

  if(!isnull(last)) {
    set_kb_item(name:&#39;VMware/esxi/&#39; + esxi_version  + &#39;/last_bulletin&#39;, value:last);
    return TRUE;
  } else {
    _esx_error(data:&#39;ESXi 4.x: Could not extract date of last bulletin\n&#39;);
    return FALSE;
  }  

}

function parse_esxi_5_0_response(recv) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="parse_esxi_5_0_response">parse_esxi_5_0_response</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>recv</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function parse_esxi_5_0_response(recv) {

  local_var last, date, datematch, bl, recv, line, bulletins;

  if(strlen(recv) &lt; 1) {
    _esx_error(data:&#39;ESXi 5.x: Unexpected response from ESXi server\n&#39;);
    return FALSE;
  }

  bl = split(recv,sep:&quot;&gt;&lt;&quot;,keep:FALSE);

  bulletins = eregmatch(pattern:&quot;(&lt;returnval&gt;.*&lt;/returnval&gt;)&quot;, string:recv);

  recv = str_replace(string:recv, find:string(&quot;\n&quot;),replace:&quot;&quot;);
  recv = str_replace(string:recv, find:string(&quot;\r&quot;),replace:&quot;&quot;);
  recv = str_replace(string:recv, find:string(&quot;\t&quot;),replace:&quot;&quot;);
  recv = ereg_replace(string:recv, pattern:&quot;&gt;[ ]+&lt;&quot;, replace:&quot;&gt;&lt;&quot;);

   foreach line (bl) {

      if(&quot;releasedate&quot; &gt;&lt; tolower(line) || &quot;creationdate&quot; &gt;&lt; tolower(line)) {

        datematch = eregmatch(pattern:&quot;(20[0-9][0-9]-[012][0-9]-[0-3][0-9])&quot;,string:line);
        date = datematch[1];

        if (!isnull(date) &amp;&amp; (isnull(last) || date &gt; last)) last =  date;

      }

      if(ib = eregmatch(pattern:&quot;ID&gt;([^&lt;]+)&lt;/ID&quot;, string: line)) {
        if(!isnull(ib[1])) {
          installed_bulletins += ib[1] + &#39;\n&#39;;
        }  
      }  
   }

  if(installed_bulletins) {
    ibs = chomp(str_replace(string:installed_bulletins,find:&#39;\n&#39;, replace:&quot; &quot;));
    if(last) {
      installed_bulletins += &#39;\n\nLast ReleaseDate: &#39; + last + &#39;\n&#39;;
    }  
    set_kb_item(name:&quot;VMware/esxi/&quot; + esxi_version  + &quot;/bulletins&quot;, value:ibs);
  }

  if(!isnull(last)) {
    set_kb_item(name:&#39;VMware/esxi/&#39; + esxi_version  + &#39;/last_bulletin&#39;, value:last);
    return TRUE;
  } else {
    _esx_error(data:&#39;ESXi 5.x: Could not extract date of last bulletin\n&#39;);
    return FALSE;
  }


}  

function _esxi_build_soap(data) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="start_esxi_session">start_esxi_session</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>pass</dt>
			
		
			<dt>user</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function start_esxi_session(user,pass) {

 local_var user, pass, c, recv;

  recv = _esxi_soap_request(data:&#39;
                                &lt;RetrieveServiceContent xmlns=&quot;urn:vim25&quot;&gt;
                                  &lt;_this type=&quot;ServiceInstance&quot;&gt;ServiceInstance&lt;/_this&gt;
                                &lt;/RetrieveServiceContent&gt;&#39;,
                                search:&quot;VMware ESX&quot;); 

  if(!recv) { 
    _esx_error(data:&#39;ESXi: Initial connect failed\n&#39;);
    return FALSE;
  } 

  sM = eregmatch(pattern:&#39;&lt;sessionManager type=&quot;SessionManager&quot;&gt;(.*)&lt;/sessionManager&gt;&#39;, string:recv);
  
  if(!isnull(sM[1])) { 
    SessionManager = sM[1];
  } else {
    SessionManager = &quot;ha-sessionmgr&quot;;
  }  

  recv = _esxi_soap_request(data:&#39;
                                &lt;Login xmlns=&quot;urn:vim25&quot;&gt;
                                  &lt;_this type=&quot;SessionManager&quot;&gt;&#39; + SessionManager  + &#39;&lt;/_this&gt;
                                  &lt;userName&gt;&#39; + user + &#39;&lt;/userName&gt;
                                  &lt;password&gt;&#39; + pass  + &#39;&lt;/password&gt;
                                &lt;/Login&gt;&#39;,
                                search:&quot;&lt;key&gt;&quot;);

  c = eregmatch(pattern:&#39;Set-Cookie: vmware_soap_session=&quot;([^&quot;]+)&quot;&#39;,string:recv);

  if(isnull(c[1])) {
    _esx_error(data:&#39;ESXi: Could not extract session\n&#39;);
    return FALSE;
  }  

  sess = c[1];

  if(!recv) {
    _esx_error(data:&#39;ESXi: Login failed\n&#39;);
    return FALSE;
  } 

  return TRUE;

}  

function get_esxi5_0_vibs(port,user,pass) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		
		
		
		<h1>Private Function Details</h1>
		
		<h2 id="_esx_error">_esx_error</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>data</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function _esx_error(data) {

  esxi_error = data + &#39;\nResponse:\n &#39; + response + &#39;\n&#39;;

}  

function _esxi_patch_missing(esxi_version, patch) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="_esxi_build_soap">_esxi_build_soap</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>data</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function _esxi_build_soap(data) {

  soap_header = &#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
   &lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;
                     xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;
                     xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
   &lt;soapenv:Body&gt;&#39;;

  soap_footer = &#39;&lt;/soapenv:Body&gt;
               &lt;/soapenv:Envelope&gt;&#39;;

  
  return soap_header + data + soap_footer;

}

function _esxi_soap_request(data,search) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="_esxi_patch_missing">_esxi_patch_missing</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>esxi_version</dt>
			
		
			<dt>patch</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function _esxi_patch_missing(esxi_version, patch) {

  local_var esxi_version, patch, bulletins, last_bulletin, pd, pdate, pa, pa_version, ip, iv;

  if(!esxi_version || !patch) return FALSE;

  esxi_kb_version = get_kb_item(&quot;VMware/ESX/version&quot;);

  if(!esxi_kb_version) return FALSE;

  if(esxi_version != esxi_kb_version) {
    return FALSE;
  }  

  if(get_kb_item(&#39;VMware/ESXi/&#39; + esxi_kb_version  + &#39;/unpatched&#39;)) return TRUE;

  bulletins = get_kb_item(&#39;VMware/esxi/&#39; + esxi_kb_version  + &#39;/bulletins&#39;);

  if(&quot;VIB:&quot; &gt;&lt; patch) {

    p = split(patch,sep:&quot;:&quot;,keep:FALSE);

    if(isnull(p[1]) || isnull(p[2])) return FALSE;

    pa = p[1];
    pa_version = p[2];

    bulletins = split(bulletins, sep:&quot; &quot;, keep:FALSE);

    foreach bulletin (bulletins) {
 
      if(&#39;_&#39; + pa + &#39;_&#39; &gt;&lt; bulletin) {

        installed = split(bulletin, sep:&quot;_&quot;, keep:FALSE);

        ip = installed[max_index(installed)-2];
        iv = installed[max_index(installed)-1];

        if(ip &gt;!&lt; pa) return FALSE;

        if((&quot;vmw&quot; &gt;&lt; pa_version &amp;&amp; &quot;vmw&quot; &gt;!&lt; iv) || (&quot;vmw&quot; &gt;&lt; iv &amp;&amp; &quot;vmw&quot; &gt;!&lt; pa_version)) return FALSE;

        if(&quot;vmw&quot; &gt;&lt; pa_version &amp;&amp; &quot;vmw&quot; &gt;&lt; iv) {
          pa_version = str_replace(string:pa_version, find:&quot;vmw&quot;, replace:&quot;&quot;);
          iv = str_replace(string:iv, find:&quot;vmw&quot;, replace:&quot;&quot;);
        }

        if(version_is_less(version:iv, test_version:pa_version)) {
          return TRUE;
        }  

        return FALSE;

      }  
    }  

  } else { 

    if(bulletins) {

      if(patch =~ &quot;-Update[0-9]+:&quot;) {
        check_patch = split(patch, sep:&quot;:&quot;, keep:FALSE);
        if(isnull(check_patch[0])) return FALSE;
        check_patch = check_patch[0];
      } else {
        check_patch = patch;
      }  

      if(egrep(pattern:check_patch, string:bulletins)) {
        return FALSE;
      }
    } 

    last_bulletin = get_kb_item(&#39;VMware/esxi/&#39; + esxi_kb_version  + &#39;/last_bulletin&#39;);

    if(last_bulletin) {

      if(patch !~ &quot;-Update[0-9]+&quot;) {
        pd = eregmatch(string: patch, pattern: &quot;^ESXi?[0-9]+-(20[0-9][0-9])([0-9][0-9])[0-9]+-[A-Z]+$&quot;);

        if(isnull(pd[1]) || isnull(pd[2]))return FALSE;
        pdate = pd[1] + &#39;-&#39; + pd[2] + &#39;-01&#39;;
      }

      if(patch =~ &quot;-Update[0-9]+:&quot;) {
        patch_date = split(patch,sep:&quot;:&quot;, keep:FALSE);
        if(isnull(patch_date[1])) return FALSE;
        pdate = patch_date[1];
      }  

      if (pdate &lt;= last_bulletin) return FALSE;

    }  
  }  

  return TRUE;

} 

function esxi_remote_report(ver, build, fixed_build, typ) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="_esxi_soap_request">_esxi_soap_request</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>data</dt>
			
		
			<dt>search</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function _esxi_soap_request(data,search) {

  local_var soc, soap, len, req, buf, recv;

  response = NULL;

  soc = open_sock_tcp(port,transport:get_port_transport(port));
  if(!soc) {
    _esx_error(data:&#39;ESXi: Could not create socket\n&#39;);
    return FALSE;
  }  

  soap = _esxi_build_soap(data:data);

  len = strlen(soap);
  host = get_host_name();

  req = string(&quot;POST /sdk/webService HTTP/1.1\r\n&quot;,
               &quot;Connection: Close\r\n&quot;,
               &quot;User-Agent: VI Perl\r\n&quot;,
               &quot;Host: &quot;,host,&quot;\r\n&quot;,
               &quot;Content-Length: &quot;,len,&quot;\r\n&quot;,
               &#39;SOAPAction: &quot;urn:vim25/5.0&quot;&#39;,&quot;\r\n&quot;);

  if(strlen(sess)) {
    req += string(&#39;Cookie: vmware_soap_session=&quot;&#39;,sess,&#39;&quot;&#39;,&quot;\r\n&quot;);
  }    

  req += string(&quot;Content-Type: text/xml\r\n&quot;,
                 &quot;\r\n&quot;);

  req += soap;
  req += string(&quot;\r\n&quot;);
 
  send(socket:soc,data:req);

  while(buf = recv(socket:soc,length:1024)) {
    recv += buf;
  }

  if(!recv)return FALSE;

  response = recv;

  if(recv !~ &quot;HTTP/1.[0|1] 200&quot;) {

    if(&quot;&lt;faultstring&gt;&quot; &gt;&lt; response) {

      fault = eregmatch(pattern:&quot;&lt;faultstring&gt;(.*)&lt;/faultstring&gt;&quot;, string: response);
      if(!isnull(fault[1])) {
        response = fault[1];
        detail = eregmatch(pattern:&quot;&lt;detail&gt;(.*)&lt;/detail&gt;&quot;, string: response);
        if(!isnull(detail[1])) {
          response = response + &#39;\n\nDetail:\n&#39; + detail[1] + &#39;\n&#39;;
        }  
        return FALSE;
      }  

    }  

  return FALSE; 

  }

  close(soc);

  if(search) {
    if(search &gt;!&lt; recv)return FALSE;
  }  

  return recv;

}  

function _esx_error(data) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		
		

	</div><!--/span-->
	</div><!--/row-->

	<hr>

	<footer>
		<p>&copy; Tenable Network Security 2014</p>
	</footer>

  </div><!--/.fluid-container-->

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="js/jquery-1.8.2.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/shCore.js"></script>
  <script type="text/javascript" src="js/shBrushNasl.js"></script>

  <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script>

  </body>
</html>
