



<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>nasldoc: nasl</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le styles -->
  <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/shCore.css" rel="stylesheet" type="text/css" />
  <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="shortcut icon" href="ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

	<div class="navbar navbar-inverse navbar-fixed-top">
	  <div class="navbar-inner">
		<div class="container-fluid">
		  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </a>
		  <a class="brand" href="index.html">nasldoc</a>
		  <div class="nav-collapse collapse">
			<ul class="nav">
			  <li class="active"><a href="index.html">Home</a></li>
			</ul>
		  </div><!--/.nav-collapse -->
		</div>
	  </div>
	</div>

  <div class="container-fluid">
	<div class="row-fluid">
	<div class="span3">
	  <div class="well sidebar-nav">
	  <ul class="nav nav-list">
		
			
			
			<li class="even">
			  <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="GSHB_read_file.html">GSHB_read_file.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="bin.html">bin.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="byte_func.html">byte_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="cisco_ios.html">cisco_ios.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="cpe.html">cpe.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="default_account.html">default_account.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="default_credentials.html">default_credentials.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="dump.html">dump.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ftp_func.html">ftp_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="global_settings.html">global_settings.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="host_details.html">host_details.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="hp_printers.html">hp_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="http_func.html">http_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="http_keepalive.html">http_keepalive.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="imap_func.html">imap_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="itg.html">itg.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="junos.html">junos.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="kyocera_printers.html">kyocera_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ldap.html">ldap.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="lexmark_printers.html">lexmark_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="misc_func.html">misc_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="netop.html">netop.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="network_func.html">network_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="nfs_func.html">nfs_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="nmap.html">nmap.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="nntp_func.html">nntp_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="os_eol.html">os_eol.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pingpong.html">pingpong.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pop3_func.html">pop3_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="revisions-lib.html">revisions-lib.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="rsync_func.html">rsync_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_activex.html">secpod_activex.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_reg.html">secpod_reg.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="secpod_smb_func.html">secpod_smb_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="sharp_printers.html">sharp_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="sip.html">sip.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="smb_default_credentials.html">smb_default_credentials.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="smb_nt.html">smb_nt.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="smbcl_func.html">smbcl_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="smtp_func.html">smtp_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="snmp_func.html">snmp_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="solaris.html">solaris.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="ssh_func.html">ssh_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ssl_funcs.html">ssl_funcs.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="telnet_func.html">telnet_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="tftp.html">tftp.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="uddi.html">uddi.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="url_func.html">url_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="version_func.html">version_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="vmware_esx.html">vmware_esx.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_file.html">wmi_file.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_hardware.html">wmi_hardware.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_misc.html">wmi_misc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_os.html">wmi_os.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_proc.html">wmi_proc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_rsop.html">wmi_rsop.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_svc.html">wmi_svc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_user.html">wmi_user.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wordlist.html">wordlist.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="xerox_printers.html">xerox_printers.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="xml.html">xml.inc</a>
			</li>
		
	  </ul>
	  </div><!--/.well -->
	</div><!--/span-->
	<div class="span9">

		<a name="top"></a>
		<h1>Overview of smbcl_func.inc</h1>
		

		

		<h1>Automatic Includes</h1>
		<p>These files are automatically included by the library.</p>
		<ul>
		  
		  <li><a href="misc_func.html">misc_func.inc</a></li>
		  
		</ul>
		

		
		
		
		
		

		
		
		<h1>Public Function Summary</h1>

		
		<p>Public functions are intended to be called by the code that imports
		this library.</p>
		

		<table class="nopad">
		  <tr class="TableHeadingColor">
			<th>Name</th>
			<th>Summary</th>
		  </tr>
		  
		  <tr>
			<td><a href="#GetPEFileVersion">GetPEFileVersion</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#GetPEProductVersion">GetPEProductVersion</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#PEVersion">PEVersion</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#bin_dword">bin_dword</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#bin_word">bin_word</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#check_smbcl">check_smbcl</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#fileread">fileread</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#get_windir">get_windir</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#is_domain">is_domain</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#smbclientavail">smbclientavail</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#smbgetdir">smbgetdir</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#smbgetfile">smbgetfile</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#smbversion">smbversion</a></td>
			<td></td>
		  </tr>
		  
		</table>
		
		
		
		

		
		
		
		
		

		
		
		<h1>Public Function Details</h1>
		
		<h2 id="GetPEFileVersion">GetPEFileVersion</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>orig_filename</dt>
			
		
			<dt>tmp_filename</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function GetPEFileVersion (tmp_filename, orig_filename) {
  local_var r;

  r = NULL;
  fp = file_open(mode: &quot;r&quot;, name:tmp_filename);
  if( ! isnull(fp) ) {
    r = PEVersion (fp:fp);
    file_close(fp);
  }
  if( isnull(r) ) {
    return NULL;
  }
  replace_kb_item(name: &quot;SMB/FILEVERSION/&quot;+orig_filename, value: r );
  return r;
}

function GetPEProductVersion (tmp_filename, orig_filename) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="GetPEProductVersion">GetPEProductVersion</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>orig_filename</dt>
			
		
			<dt>tmp_filename</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function GetPEProductVersion (tmp_filename, orig_filename) {
  local_var r;

  r = NULL;
  fp = file_open(mode: &quot;r&quot;, name:tmp_filename);
  if( ! isnull(fp) ) {
    r = PEVersion (fp:fp, prodvers:1);
    file_close(fp);
  }
  if( isnull(r) ) {
    return NULL;
  }
  replace_kb_item(name: &quot;SMB/PRODUCTVERSION/&quot;+orig_filename, value: r );
  return r;
}

# PEVersion fp = file to check, prodvers = 0/NULL give fileversion, prodvers &lt;&gt; 0/NULL give Productversion

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="PEVersion">PEVersion</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>fp</dt>
			
		
			<dt>prodvers</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function PEVersion(fp, prodvers) {
  local_var pe_offset, sections_cnt, sections_offset, sections_data, i, rsrc_start, rsrc_virtstart;
  local_var dir_data, dir_offset, dir_entries, sub_dir, dir_tmp, vs_data, vs_length, r, recurs, max_recurs, vs_offset;

  if( isnull(prodvers) ) {
    prodvers = 0;
  }
  pe_offset = bin_word(data: fileread(fp:fp, offset:60, length:2));

  if( fileread(fp:fp, offset:pe_offset, length:2) != &quot;PE&quot; ) {
    return NULL;
  }

  sections_cnt = bin_word(data: fileread(fp:fp, offset:pe_offset+6, length:2));
  section_offset = pe_offset + bin_word(data: fileread(fp:fp, offset:pe_offset+20, length:2)) + 24;
  rsrc_start = NULL;
  max_recurs = 20;            
  for( i=0; i&lt;sections_cnt; i++ ) {
    sections_data = fileread(fp:fp, offset:section_offset + i * 40, length:40);
    if( substr(sections_data, 0, 4) == &quot;.rsrc&quot; ) {
      rsrc_start = bin_dword(data:substr(sections_data, 20));
      rsrc_virtstart = bin_dword(data:substr(sections_data, 12));
      break;
    }
    if( i &gt; max_recurs ) {
      break;
    }
  }
  if( isnull(rsrc_start) ) {
    return NULL;
  }

  dir_data = fileread(fp:fp, offset:rsrc_start, length:16);
  dir_entries = bin_word(data:substr(dir_data,12)) + bin_word(data:substr(dir_data,14));
  dir_offset = NULL;
  sub_dir = 0;
  max_recurs = 100;
  recurs = 0;
  for( i = 0; i &lt; dir_entries; i++ ) {
    dir_data = fileread(fp:fp, offset:rsrc_start+16+i*8, length:8);
    if( bin_dword(data:substr(dir_data,0)) == 0x10 ) {
      repeat {
        dir_tmp = bin_dword(data:substr(dir_data,4));
        if( (dir_tmp &amp; 0x80000000) == 0x80000000 ) {
          dir_offset = dir_tmp - 0x80000000;
          sub_dir = 1;
        } else {
          dir_offset = dir_tmp;
          sub_dir = 0;
        }
        dir_data = fileread(fp:fp, offset:rsrc_start+dir_offset+16, length:8);
        if( strlen(dir_data) != 8 ) {
          return NULL;
        }
        if( ++recurs &gt; max_recurs ) {
          return NULL;
        }
      }
      until sub_dir == 0;
      break;
    }
    if( i &gt; max_recurs ) {
      break;
    }
  }
  if( isnull(dir_offset) ) {
    return NULL;
  }

  dir_data = fileread (fp:fp, offset:rsrc_start+dir_offset, length:4);
  dir_offset = bin_dword(data:substr(dir_data,0));
  rsrc_start = rsrc_start + (dir_offset - rsrc_virtstart);
  vs_data = fileread (fp:fp, offset:rsrc_start, length:2);
  vs_length = bin_word(data:substr(vs_data,0));
  vs_data = fileread (fp:fp, offset:rsrc_start, length:vs_length);
  if( bin_dword(data:substr(vs_data,40)) != 0xfeef04bd ) {
    return NULL;
  }
  if( prodvers == 0 ) {
    vs_offset = 48;
  } else {
    vs_offset = 56;
  }
  r = NULL;
  r = string((bin_dword(data:substr(vs_data, vs_offset)) &gt;&gt;&gt; 16)+&quot;.&quot;);
  r = r + string((bin_dword(data:substr(vs_data, vs_offset)) &amp; 0xffff)+&quot;.&quot;);
  r = r + string((bin_dword(data:substr(vs_data, vs_offset+4)) &gt;&gt;&gt; 16)+&quot;.&quot;);
  r = r + string((bin_dword(data:substr(vs_data, vs_offset+4)) &amp; 0xffff)+&quot;.&quot;);
  return r;
}


function fileread(fp, offset, length) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="bin_dword">bin_dword</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>data</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function bin_dword(data) {
  return( ord(data[0]) +
         (ord(data[1]) &lt;&lt; 8) +
         (ord(data[2]) &lt;&lt; 16) +
         (ord(data[3]) &lt;&lt; 24) );
}

function get_windir() {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="bin_word">bin_word</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>data</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function bin_word(data) {
  return( ord(data[0]) + (ord(data[1]) &lt;&lt; 8) );
}


function bin_dword(data) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="check_smbcl">check_smbcl</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function check_smbcl() {
  if( !get_kb_item(&quot;SMB/smbclient&quot;) )
    smbclientavail();

  if(get_kb_item(&quot;SMB/smbclient&quot;) ) {
    if( smbversion() == 0){
      if(error = get_kb_item(&quot;SMB/ERROR&quot;)) {
        log_message(port:0, proto:&quot;SMBClient&quot;, data: &quot;Error getting SMB-Data -&gt; &quot;+error);
      }	
    } else {
      return(1); # smblcient is found and seems to work
    }
  } else {
    log_message(port:0, proto:&quot;SMBClient&quot;, data: &#39;The tool &quot;smbclient&quot; is not available for openvasd.\n&#39; +
      &#39;Therefore none of the tests using smbclient are executed.&#39;);
  }
  return(0);
}

function smbclientavail() {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="fileread">fileread</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>fp</dt>
			
		
			<dt>length</dt>
			
		
			<dt>offset</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function fileread(fp, offset, length) {
  local_var r, data;

  file_seek(fp:fp, offset:offset);
  data = file_read(fp:fp, length:length);
  if( isnull(data) ){
    return(NULL);
  } else {
   return(data);
  }
}


function bin_word(data) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="get_windir">get_windir</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function get_windir() {
  local_var os;

  os = get_kb_item(&quot;SMB/OS&quot;);
  if( (os == &quot;WINDOWS 5.0&quot;) || (os == &quot;WINDOWS NT 4.0&quot;) ) {
    return(&quot;WINNT\&quot;);
  } else {
    if( ereg(pattern: &quot;WINDOWS&quot;, string: os) ) {
      return(&quot;WINDOWS\&quot;);
    } else {
      return(NULL);
    }
  }
}


		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="is_domain">is_domain</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function is_domain() {
  if( !isnull(get_kb_item (&quot;SMB/domain_filled/0&quot;)) ) {
    return(&quot;-W&quot;+get_kb_item (&quot;SMB/domain_filled/0&quot;));
  } else {
    return(NULL);
  }
}

function smbgetfile(share, filename, tmp_filename) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="smbclientavail">smbclientavail</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function smbclientavail() {
  if( find_in_path(&quot;smbclient&quot;) ){
    replace_kb_item(name: &quot;SMB/smbclient&quot;, value: 1);
    return (1);
  } else {
    replace_kb_item(name: &quot;SMB/smbclient&quot;, value: 0);
    return (0);
  }
}


function smbversion() {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="smbgetdir">smbgetdir</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>dir</dt>
			
		
			<dt>share</dt>
			
		
			<dt>typ</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function smbgetdir(share, dir, typ) {
  local_var r, arg, i, ret, dir_att;

  if( !get_kb_item(&quot;SMB/smbclient&quot;) ) {
    replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: &quot;SMBClient not available for openvasd !&quot; );
    return(NULL);
  }
  replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: &quot;&quot; );
  arg[0] = &quot;smbclient&quot;;
  arg[1] = &quot;-d1&quot;;
  arg[2] = string(&quot;-U&quot;+get_kb_item (&quot;SMB/login_filled/0&quot;)+&quot;%&quot;+get_kb_item (&quot;SMB/password_filled/0&quot;));
  arg[3] = &quot;//&quot;+get_host_ip()+&quot;/&quot;+share;
  arg[4] = &quot;-cdir \&quot;+raw_string(0x22)+dir+&quot;\&quot;+raw_string(0x22);
  arg[5] = is_domain;
  if( (typ &lt; 0) || (typ &gt; 2) || isnull(typ) ) {
    typ = 0;
  }
  ret = NULL;
  r = pread(cmd:&quot;smbclient&quot;, argv:arg );
  if( !egrep(pattern: &quot;NT_STATUS&quot;, string: r) ) {
    r = split(r, keep:0);
    replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: &quot;&quot; );
    for( i=0; i &lt; (max_index(r)-2); i++ ) {
      if( (substr(r[i],0,4) == &quot;  .. &quot;) || (substr(r[i],0,3) == &quot;  . &quot;) || (!ereg(pattern: &quot; [0-9]{4}$&quot;, string: r[i])) ) {
        continue;
      }
      r[i] = ereg_replace(pattern: &quot;[ ]*[0-9]*.{26}$&quot;, string: r[i], replace: &quot;&quot;);
      dir_att = ereg(pattern: &quot;D[A-Z]*$&quot;, string: r[i]);
      r[i] = ereg_replace(pattern: &quot; [A-Za-z]*$&quot;, string: r[i], replace: &quot;&quot;);
      r[i] = ereg_replace(pattern: &quot; *$&quot;, string: r[i], replace: &quot;&quot;);
      r[i] = ereg_replace(pattern: &quot;^ *&quot;, string: r[i], replace: &quot;&quot;);
      if( ((typ == 0) || (typ == 1)) &amp;&amp; (dir_att == 0) ) {
        ret[max_index(ret)] = r[i];
        continue;
      }
      if( ((typ == 0) || (typ == 2)) &amp;&amp; (dir_att == 1) ) {
        ret[max_index(ret)] = r[i];
      }
    }
    return(ret);
  } else {
    replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: chomp(r) );
    return(ret);
  }
}


function GetPEFileVersion (tmp_filename, orig_filename) {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="smbgetfile">smbgetfile</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>filename</dt>
			
		
			<dt>share</dt>
			
		
			<dt>tmp_filename</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function smbgetfile(share, filename, tmp_filename) {
  local_var r, arg;

  if( !get_kb_item(&quot;SMB/smbclient&quot;) ) {
    replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: &quot;SMBClient not available for openvasd !&quot; );
    return(0);
  }
  replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: &quot;&quot; );
  arg[0] = &quot;smbclient&quot;;
  arg[1] = &quot;-d1&quot;;
  arg[2] = string(&quot;-U&quot;+get_kb_item (&quot;SMB/login_filled/0&quot;)+&quot;%&quot;+get_kb_item (&quot;SMB/password_filled/0&quot;));
  arg[3] = &quot;//&quot;+get_host_ip()+&quot;/&quot;+share;
  arg[4] = &quot;-cget \&quot;+raw_string(0x22)+filename+&quot;\&quot;+raw_string(0x22)+&quot; &quot;+raw_string(0x22)+tmp_filename+raw_string(0x22);
  arg[5] = is_domain;
  r = pread(cmd:&quot;smbclient&quot;, argv:arg );
  if( egrep(pattern: &quot;getting file&quot;, string: r) ) {
    replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: &quot;&quot; );
    return(1);
  } else {
    replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: chomp(r) );
    return(0);
  }
}


# Get Direntries from SMB Source. typ 0 = all entries. typ 1 = only file entries. typ 2 = only directory entries.

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="smbversion">smbversion</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function smbversion() {
  local_var r, arg, domain, os, server;

  if( !get_kb_item(&quot;SMB/smbclient&quot;) ) {
    replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: &quot;SMBClient not available for openvasd !&quot; );
    return(0);
  }
  replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: &quot;&quot; );
  arg[0] = &quot;smbclient&quot;;
  arg[1] = &quot;-d0&quot;;
  arg[2] = &quot;-N&quot;;
  arg[3] = &quot;-cq&quot;;
  arg[4] = &quot;//&quot;+get_host_ip()+&quot;/IPC$&quot;;
  arg[5] = is_domain;
  r = toupper(pread(cmd:&quot;smbclient&quot;, argv:arg ));
  if( ! ereg(pattern: &quot;NT_STATUS&quot;, string: r) ) {
    domain = ereg_replace(pattern:&quot;(.*DOMAIN=\[)*(\].*)*&quot;, string: r, replace:&quot;&quot;);
    os = ereg_replace(pattern:&quot;(.*OS=\[)*(\].*)*&quot;, string: r, replace:&quot;&quot;);
    server = ereg_replace(pattern:&quot;(.*SERVER=\[)*(\].*)*&quot;, string: r, replace:&quot;&quot;); 
    replace_kb_item(name: string(&quot;SMB/OS&quot;), value: os);
    replace_kb_item(name: string(&quot;SMB/DOMAIN&quot;), value: domain);
    replace_kb_item(name: string(&quot;SMB/SERVER&quot;), value: server);
    return(1);
  } else {
    replace_kb_item(name: string(&quot;SMB/ERROR&quot;), value: chomp(r) );
    return(0);
  }
}

function is_domain() {

		</pre>
		<a href="#top">top</a>
		<hr>
		
		
		
		
		

	</div><!--/span-->
	</div><!--/row-->

	<hr>

	<footer>
		<p>&copy; Tenable Network Security 2014</p>
	</footer>

  </div><!--/.fluid-container-->

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="js/jquery-1.8.2.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/shCore.js"></script>
  <script type="text/javascript" src="js/shBrushNasl.js"></script>

  <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script>

  </body>
</html>
