



<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <title>nasldoc: nasl</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le styles -->
  <style type="text/css">
	body {
	padding-top: 60px;
	padding-bottom: 40px;
	}
	.sidebar-nav {
	padding: 9px 0;
	}
  </style>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/shCore.css" rel="stylesheet" type="text/css" />
  <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="shortcut icon" href="ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

	<div class="navbar navbar-inverse navbar-fixed-top">
	  <div class="navbar-inner">
		<div class="container-fluid">
		  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </a>
		  <a class="brand" href="index.html">nasldoc</a>
		  <div class="nav-collapse collapse">
			<ul class="nav">
			  <li class="active"><a href="index.html">Home</a></li>
			</ul>
		  </div><!--/.nav-collapse -->
		</div>
	  </div>
	</div>

  <div class="container-fluid">
	<div class="row-fluid">
	<div class="span3">
	  <div class="well sidebar-nav">
	  <ul class="nav nav-list">
		
			
			
			<li class="even">
			  <a href="GSHB_BruteForce.html">GSHB_BruteForce.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="GSHB_read_file.html">GSHB_read_file.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="bad_ssh_host_keys.html">bad_ssh_host_keys.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="bad_ssh_keys.html">bad_ssh_keys.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="bin.html">bin.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="byte_func.html">byte_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="cisco_ios.html">cisco_ios.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="cpe.html">cpe.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="default_account.html">default_account.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="default_credentials.html">default_credentials.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="dump.html">dump.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ftp_func.html">ftp_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="gb_openssl_heartbeat.html">gb_openssl_heartbeat.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="global_settings.html">global_settings.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="gvr_apps_auth_func.html">gvr_apps_auth_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="host_details.html">host_details.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="hp_printers.html">hp_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="http_func.html">http_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="http_keepalive.html">http_keepalive.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="imap_func.html">imap_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="itg.html">itg.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="junos.html">junos.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="kyocera_printers.html">kyocera_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ldap.html">ldap.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="lexmark_printers.html">lexmark_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="misc_func.html">misc_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="netop.html">netop.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="network_func.html">network_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="nfs_func.html">nfs_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="nmap.html">nmap.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="nntp_func.html">nntp_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="os_eol.html">os_eol.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pingpong.html">pingpong.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-bsd.html">pkg-lib-bsd.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-deb.html">pkg-lib-deb.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-gentoo.html">pkg-lib-gentoo.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-hpux.html">pkg-lib-hpux.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-macosx.html">pkg-lib-macosx.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pkg-lib-rpm.html">pkg-lib-rpm.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="pkg-lib-slack.html">pkg-lib-slack.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="pop3_func.html">pop3_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="revisions-lib.html">revisions-lib.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="rsync_func.html">rsync_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_activex.html">secpod_activex.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="secpod_ie_supersede.html">secpod_ie_supersede.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_reg.html">secpod_reg.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="secpod_smb_func.html">secpod_smb_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="secpod_ssl_ciphers.html">secpod_ssl_ciphers.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="sharp_printers.html">sharp_printers.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="sip.html">sip.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="smb_default_credentials.html">smb_default_credentials.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="smb_nt.html">smb_nt.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="smbcl_func.html">smbcl_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="smtp_func.html">smtp_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="snmp_func.html">snmp_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="solaris.html">solaris.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="ssh_func.html">ssh_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="ssl_funcs.html">ssl_funcs.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="telnet_func.html">telnet_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="tftp.html">tftp.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="uddi.html">uddi.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="url_func.html">url_func.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="version_func.html">version_func.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="vmware_esx.html">vmware_esx.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_file.html">wmi_file.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_hardware.html">wmi_hardware.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_misc.html">wmi_misc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_os.html">wmi_os.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_proc.html">wmi_proc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_rsop.html">wmi_rsop.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wmi_svc.html">wmi_svc.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="wmi_user.html">wmi_user.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="wordlist.html">wordlist.inc</a>
			</li>
		
			
			
			<li class="odd">
			  <a href="xerox_printers.html">xerox_printers.inc</a>
			</li>
		
			
			
			<li class="even">
			  <a href="xml.html">xml.inc</a>
			</li>
		
	  </ul>
	  </div><!--/.well -->
	</div><!--/span-->
	<div class="span9">

		<a name="top"></a>
		<h1>Overview of network_func.inc</h1>
		

		

		
		
		
		
		

		
		
		<h1>Public Function Summary</h1>

		
		<p>Public functions are intended to be called by the code that imports
		this library.</p>
		

		<table class="nopad">
		  <tr class="TableHeadingColor">
			<th>Name</th>
			<th>Summary</th>
		  </tr>
		  
		  <tr>
			<td><a href="#check_udp_port_status">check_udp_port_status</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#htonl">htonl</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#htons">htons</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ip_checksum">ip_checksum</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#is_private_addr">is_private_addr</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#is_radius_alive">is_radius_alive</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ms_since_midnight">ms_since_midnight</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#ntohl">ntohl</a></td>
			<td></td>
		  </tr>
		  
		  <tr>
			<td><a href="#test_udp_port">test_udp_port</a></td>
			<td></td>
		  </tr>
		  
		</table>
		
		
		
		

		
		
		
		
		

		
		
		<h1>Public Function Details</h1>
		
		<h2 id="check_udp_port_status">check_udp_port_status</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>dport</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function check_udp_port_status(dport)
{
  sport = rand() % 65000 + 1024;
  ip_pkt = forge_ip_packet(
            ip_hl   :5,
            ip_v    :4,
            ip_tos  :0,
            ip_len  :20,
            ip_id   :31337,
            ip_off  :0,
            ip_ttl  :64,
            ip_p    :IPPROTO_UDP,
            ip_src  :this_host()
          );

  udp_pkt = forge_udp_packet(
                ip      :ip_pkt,
                uh_sport:sport,
                uh_dport:dport,
                uh_ulen :8
              );

  ## Filter to check source host address and port and destination host address and port
  ## Also checking Destination host unreachable and Destination port unreachable
  filter = string(&quot;src host &quot;, get_host_ip(), &quot; and dst host &quot;, this_host(),
           &quot; and icmp and (icmp[0] == 3 and icmp[1] == 3 and icmp[28:2]==&quot;,
            sport, &quot; and icmp[30:2]==&quot;, dport, &quot;)&quot;);

  ## If UDP port is not reachable then it will return ICMP packet back
  ## i.e which will be having status code for Destination host unreachable
  ## and Destination port unreachable
  res = send_packet(udp_pkt, pcap_active:TRUE, pcap_filter:filter);

  ## Return 1 if udp port is alive and return 0 if udp port is not reachable
  if(res != NULL){
    return(0);
  } else {
    return(1);
  }
}

## This function will return 1 if Radius Server is running,

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="htonl">htonl</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>n</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function htonl(n)
{
  local_var	i, j, s;

  j = n;	# We do not want to modify a global variable, just in case.
  for (i = 0; i &lt; 4; i ++)
  {
    s[i] = j &amp; 0xFF;
    j &gt;&gt;&gt;= 8;
  }
  return raw_string(s[3], s[2], s[1], s[0]);
}

function htons(n)

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="htons">htons</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>n</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function htons(n)
{
  return raw_string((n &gt;&gt;&gt; 8) &amp; 0xFF, n &amp; 0xFF);
}

function ntohl(n)

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ip_checksum">ip_checksum</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>data</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ip_checksum(data)
{
  local_var	sum, i, n;
  n = strlen(data);
  sum = 0;
  for (i = 0; i &lt; n - 1; i += 2)
  {
    sum = sum + ord(data[i]) + 256 * ord(data[i+1]);
  }
  if (i &lt; n)
    sum += ord(data[i]);
  sum = (sum &gt;&gt;&gt; 16) + (sum &amp; 0xffff);
  sum += (sum &gt;&gt;&gt; 16);
  sum = (~sum) &amp; 0xFFFF;
  return raw_string(sum % 256, sum / 256);
}

function ms_since_midnight()

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="is_private_addr">is_private_addr</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>addr</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function is_private_addr(addr)
{
  if (all_addr_private) return 1;
  if (all_addr_public) return 1;

  local_var	a;
  if (! addr)
    a = get_host_ip();
  else
    a = addr;
  # Localhost + RFC1918
  if (a =~ &quot;^0*(127|10)\.[0-9]+\.[0-9]+\.[0-9]+&quot;) return 1;
  # RFC 1918 + Link local (RFC 3330)
  if (a =~ &quot;^0*(192\.0*168|169\.0*254)\.[0-9]+\.[0-9]+&quot;) return 1;
  # RFC 1918
  if (a =~ &quot;^0*172\.0*(1[6-9]|2[0-9]|3[01])\.[0-9]+\.[0-9]+&quot;) return 1;
  # TEST-NET - RFC 3330
  if (a =~ &quot;^0*192\.0*0\.0*2\.[0-9]+&quot;) return 1;
  # RFC 2544
  if (a =~ &quot;^0*192\.0*1[89]\.[0-9]+\.[0-9]+&quot;) return 1;
  return 0;
}

#

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="is_radius_alive">is_radius_alive</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>port</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function is_radius_alive(port)
{
  username = string(&quot;OpenVAS&quot;);
  data = raw_string(0x40,0xfa,0xb3,0x17,0x23,0xfd,0xe5,0x7f,0x4a,0x02,
                    0x74,0x55,0x15,0x0c,0x45,0xeb) +
                    raw_string(0x01,(strlen(username)+2)) + username +
                    raw_string(0x02,0x12,0xfa,0x4d,0xb1,0x43,0x69,0xd5,
                    0x69,0x8b,0x1f,0x30, 0xea,0xf4,0x54,0x45,0x1e,0x70,
                    0x04,0x06,0x05,0x06,0x00,0x00,0x15,0x38);
  data = raw_string(0x01,0xbe,0x00,(strlen(data)+4)) + data;

  soc = open_sock_udp(port);
  if(soc)
  {
    send(socket:soc, data:data);
    buf = recv(socket:soc, length:4096);

    close(soc);
    # Radius-Code: Access-Rejected (3)
    if(buf &amp;&amp; ord(buf[0]) == 3){
      return 1;
    }
  }
  return 0;
}


		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ms_since_midnight">ms_since_midnight</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ms_since_midnight()
{
  local_var	v, s, u;

  v = gettimeofday();
  s = v[0]; u = v[1];
  s %= 1000;
  u /= 1000;
  return u + 1000 * s;
}


function htonl(n)

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="ntohl">ntohl</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>n</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function ntohl(n)
{
 if (strlen(n) != 4)
 {
  display(&#39;ntohl: invalid parameter\n&#39;);
  return;
 }
 return (ord(n[0]) &lt;&lt; 24) | (ord(n[1]) &lt;&lt; 16) | (ord(n[2]) &lt;&lt; 8) | ord(n[3]);
}


## This function will return 1 UDP port is alive and

		</pre>
		<a href="#top">top</a>
		<hr>
		
		<h2 id="test_udp_port">test_udp_port</h2>
		

		

		
		<h3>Named Parameters</h3>
		<dl>

		
			<dt>data</dt>
			
		
			<dt>port</dt>
			
		
			<dt>retries</dt>
			
		
		</dl>
		

		

		<h3>Code</h3>
                <!-- The contents must not have indentation, else formatting is off. -->
		<pre class="brush: nasl">
function test_udp_port(port, data, retries)
{
  local_var	ip, udp, srcaddr, dstaddr, r, f, i, n;

  if (retries &lt;= 0) n = 6; else n = retries;
  if (isnull(data)) data = &quot;&quot;;
  for (i = 0; i &lt; n; i ++)
  {
    srcaddr = this_host();
    dstaddr = get_host_ip();
    srcport = 1024 + rand() % 64512;

    ip = forge_ip_packet(ip_v : 4, ip_hl : 5, ip_tos : 0,
                       ip_len : 20, ip_id : 0,
                       ip_p : IPPROTO_UDP, ip_ttl : 255, ip_off : 0,
                       ip_src : srcaddr, ip_dst : dstaddr);

    udp = forge_udp_packet(ip: ip, uh_sport : srcport, uh_dport : port,
			uh_ulen: 8 + strlen(data), data : data);

    f = strcat(&quot;src host &quot;, dstaddr, &quot; and dst host &quot;, srcaddr,
	&quot; and ( (udp and src port &quot;, port, &quot; and dst port &quot;, srcport, &quot;) or (&quot;,
	&quot; icmp and icmp[0] = 3 and icmp[1] = 3))&quot;);
    r = send_packet(udp, pcap_timeout:1, pcap_active: TRUE, pcap_filter: f);
    if (r)
      if (ord(r[9]) == 17)	# udp
        return 2;
      else
      {
        ##dump(ddata: r, dtitle: &quot;sniffed&quot;);
	len = (ord(r[0]) &amp; 0xF); len *= 4;
	icmp = substr(r, len);
        ##dump(ddata: icmp, dtitle: &quot;icmp&quot;);
        ip = substr(icmp, 8);	# Original datagram
        ##dump(ddata: ip, dtitle: &quot;ip&quot;);
        len = (ord(ip[0]) &amp; 0xF); len *= 4;
        udp = substr(ip, len);
        sp = ord(udp[0])*256 + ord(udp[1]);
	dp = ord(udp[2])*256 + ord(udp[3]);
        if (srcport == sp &amp;&amp; port == dp)
          return 0;
      }
  }
  return 1;
}


function ip_checksum(data)

		</pre>
		<a href="#top">top</a>
		<hr>
		
		
		
		
		

	</div><!--/span-->
	</div><!--/row-->

	<hr>

	<footer>
		<p>&copy; Tenable Network Security 2014</p>
	</footer>

  </div><!--/.fluid-container-->

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="js/jquery-1.8.2.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/shCore.js"></script>
  <script type="text/javascript" src="js/shBrushNasl.js"></script>

  <script type="text/javascript">
    SyntaxHighlighter.defaults['collapse'] = true;
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.all();
  </script>

  </body>
</html>
