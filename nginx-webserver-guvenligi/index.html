<!doctype html>
<html class="no-js" lang="tr-TR">
<head>
  <meta charset="UTF-8">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Nginx WebServer Güvenliği | Mertcan GÖKGÖZ</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Jekyll">
  <link href="https://plus.google.com/103305118431759296457" rel="publisher" />
  <!-- Begin Jekyll SEO tag v2.1.0 -->
<meta property="og:title" content="Nginx WebServer Güvenliği" />
<meta name="description" content="Sistemi az kasan ve yüksek performans veren çoğu yüksek trafiği olan sitenin kullandığı bir altyapıdır.peki nginx ne yapar da bu kadar sistem" />
<meta property="og:description" content="Sistemi az kasan ve yüksek performans veren çoğu yüksek trafiği olan sitenin kullandığı bir altyapıdır.peki nginx ne yapar da bu kadar sistem" />
<link rel="canonical" href="https://mertcangokgoz.com/nginx-webserver-guvenligi/" />
<meta property="og:url" content="https://mertcangokgoz.com/nginx-webserver-guvenligi/" />
<meta property="og:site_name" content="Mertcan GÖKGÖZ - Özgür Yazılım, Sunucu Yönetimi ve Hizmetleri" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-26T20:42:43+03:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@mertcangokgoz" />
<meta name="twitter:creator" content="@http://twitter.com/mertcangokgoz" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Nginx WebServer Güvenliği",
"datePublished": "2014-08-26T20:42:43+03:00",
"description": "Sistemi az kasan ve yüksek performans veren çoğu yüksek trafiği olan sitenin kullandığı bir altyapıdır.peki nginx ne yapar da bu kadar sistem",
"url": "https://mertcangokgoz.com/nginx-webserver-guvenligi/"}</script>
<!-- End Jekyll SEO tag -->

  
  <meta name="author" content="Mertcan GÖKGÖZ" />
  <meta name="distribution" content="global"/>
  <meta name="robots" content="follow, all"/>
  <meta name="google-site-verification" content="72uYg4UxAer0YwWdtkU93OGqjNq7ZThpqe0M4KxyvIg"/>
  <meta name='yandex-verification' content='410f2e33fe81ce80'/>
  <meta name="msvalidate.01" content="2183CAED5258723C183F825A20DF9C4A"/>
  <link rel="alternate" type="application/rss+xml" title="Mertcan GÖKGÖZ" href="https://mertcangokgoz.com/feed" />
  <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/all.css">
  <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css">
  <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.min.css">
  <script type="text/javascript" src="/assets/js/jquery-1.12.4.min.js"></script>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png">
</head>
<body>
<div class="container">
    <div class="three columns sidebar">
      <nav class="nav">
  <a href="/">
    <img src="/YeniResimBro.jpg" id="gravatar" alt="Mertcan GÖKGÖZ" width="200" height="200"/>
  </a>
  <h3><a href="/">Mertcan GÖKGÖZ</a></h3>
  <div id="bio">
    <p>
        Kategoriler:<br>

        <a href="/category/linux">Linux</a> &raquo; 232 Yazı<br><a href="/category/programlama">Programlama</a> &raquo; 79 Yazı<br><a href="/category/genel">Genel</a> &raquo; 69 Yazı<br><a href="/category/guvenlik">Guvenlik</a> &raquo; 54 Yazı<br><a href="/category/windows">Windows</a> &raquo; 36 Yazı<br><a href="/category/analiz">Analiz</a> &raquo; 21 Yazı<br><a href="/category/jekyll">Jekyll</a> &raquo; 16 Yazı<br><a href="/category/nginx">Nginx</a> &raquo; 15 Yazı<br><a href="/category/egitimler">Egitimler</a> &raquo; 6 Yazı<br>
        <br>
        Arkadaşlar:<br>
        <a href="https://oztaser.com/" target="_blank" rel="nofollow">Adil ÖZTAŞER</a><br>
        <a href="https://aligoren.com/" target="_blank" rel="nofollow">Ali GÖREN</a><br>
        <a href="https://www.ceyhanmolla.com/" target="_blank" rel="nofollow">Ceyhan MOLLA</a><br>
        <a href="https://0x6.pw/" target="_blank" rel="nofollow">Enes ERGÜN</a><br>
        <a href="http://furkankalkan.com/" target="_blank" rel="nofollow">Furkan KALKAN</a><br>
        <a href="http://www.hamdicatal.com/" target="_blank" rel="nofollow">Hamdi ÇATAL</a><br>
        <a href="https://onur.im/" target="_blank" rel="nofollow">Onur ASLAN</a><br>
        <a href="http://www.omeripek.com.tr" target="_blank" rel="nofollow">Ömer IPEK</a><br>
        <a href="https://yapaygerizeka.github.io/" target="_blank" rel="nofollow">Yapay Geri Zekâ</a><br>
    </p>
  </div>
  <div id="social">
    Takip Edin:
<div id="stalker">
   

   
   <a title="MertcanGokgoz on Academia" href="https://baskent.academia.edu/MertcanGokgoz" target="_blank" rel="nofollow">
     <i class="fa fa-book"></i>
   </a>
   

  
  <a title="MertcanGokgoz on Github" href="https://github.com/MertcanGokgoz" target="_blank" rel="nofollow">
    <i class="fa fa-github-square"></i>
  </a>
  

  
  <a title="MertcanGokgoz on Gitlab" href="https://gitlab.com/u/MertcanGokgoz" target="_blank" rel="nofollow">
    <i class="fa fa-gitlab"></i>
  </a>
  

  

  

  

  

  

  
  <a title="mertcangokgoz on Twitter" href="https://twitter.com/mertcangokgoz" target="_blank" rel="nofollow">
    <i class="fa fa-twitter-square"></i>
  </a>
  

  

  

  
  <a title="Mertcan GÖKGÖZ on LinkedIn" href="https://www.linkedin.com/in/mertcangokgoz" target="_blank" rel="nofollow">
    <i class="fa fa-linkedin-square"></i>
  </a>
  

  
  <a title="Mertcan GÖKGÖZ on Google Plus" href="https://plus.google.com/103305118431759296457" target="_blank" rel="nofollow">
    <i class="fa fa-google-plus-square"></i>
  </a>
  

  

  
  <a title="Mertcan GÖKGÖZ on Youtube" href="https://www.youtube.com/c/MertcanGokgoz" target="_blank" rel="nofollow">
    <i class="fa fa-youtube"></i>
  </a>
  

  
  <a title="RSS feed" id="atom" href="/feed/">
    <i class="fa fa-rss-square"></i>
  </a>
  
</div>

  </div>
</nav>

    </div>
    <div class="nine columns content">
        <div class="menuM">
    <ul class="topnav">
        <li><a class="active" href="https://mertcangokgoz.com/">Anasayfa</a></li>
        <li><a href="https://mertcangokgoz.com/category/analiz/">Analiz</a></li>
        <li><a href="https://mertcangokgoz.com/category/genel/">Genel</a></li>
        <li><a href="https://mertcangokgoz.com/category/guvenlik/">Güvenlik</a></li>
        <li><a href="https://mertcangokgoz.com/category/linux/">Linux</a></li>
        <li><a href="https://mertcangokgoz.com/category/windows/">Windows</a></li>
        <li><a href="https://mertcangokgoz.com/category/jekyll/">Jekyll</a></li>
        <li><a href="https://mertcangokgoz.com/category/nginx/">Nginx</a></li>
        <li><a href="https://mertcangokgoz.com/category/egitimler/">Egitimler</a></li>
        <li><a href="https://mertcangokgoz.com/category/programlama/">Programlama</a></li>
        <li class="icon">
            <a href="javascript:void(0);" style="font-size:15px;" onclick="myFunction()"><i class="fa fa-bars"></i></a>
        </li>
    </ul>
</div>

<script>
    function myFunction() {
        document.getElementsByClassName("topnav")[0].classList.toggle("responsive");
    }
</script>


<p class="meta">
  August 26, 2014
  <a href="/">
    <i class="home fa fa-home fa-2x"></i>
  </a>
  <a href="/search/">
    <i class="home fa fa-search fa-2x"></i>
  </a>
  <a href="javascript:" onclick="window.print();return false;">
    <i class="home fa fa-print fa-2x"></i>
  </a>
</p>

<h1 class="title">Nginx WebServer Güvenliği</h1>

<div id="post">
  <p>Sistemi az kasan ve yüksek performans veren çoğu yüksek trafiği olan sitenin kullandığı bir altyapıdır.peki <strong>nginx</strong> ne yapar da bu kadar sistem kaynaklarını iyi kullanır.Nginx geleneksek sunucu sistemlerinin aksine iş parçacıklarını farklı bir şekilde değerlendirir kategorize eder ve ona göre çalışır yani tamamını ele alıpda işlem yapmaz parça parça işlem yapar daha ölçeklenebilirdir.Nginx i hali hazırda wordpress,github,hulu gibi aşırı yüksek trafikli siteler kullanıyor bi bildikleri var illaki aynı anda milyonlarca adam girdimi apache gibi kitlenmesin diye engin abimize başvurmuşlar misler gibi şimdi bu engin abimiz arada açık verebiliyor vermese bile biz totomuzu koruyalım sonra sıkıntı çıkmasın diye popüler olan güvenlik yöntemlerinden 20 sini sizin için toparladım.Burada anlatacaklarım genel olarak tüm linux sistemlerinde sorunsuz çalışır ama söylememde fayda var anlatımlarımı her zaman ki gibi <strong>Centos/RHEL</strong> için yaptım.</p>

<p>Varsayılan Nginx yolu ve port</p>

<ul>
  <li><strong>/usr/local/nginx/conf/</strong> nginx in tüm configlerinin bulunduğu klasör yoludur.burada bulunan <strong>“nginx.conf”</strong> ana config dosyamızdır.</li>
  <li><strong>/usr/local/nginx/html/</strong> Ön tanımlı dosya ve klasör yolu web sitenizde gösterilecek dosyalar burada olacak</li>
  <li><strong>/usr/local/nginx/logs/</strong> Ön tanımlı nginx sistem log klasörü</li>
  <li>Ön tanımlı <strong>HTTP</strong> port <strong>80</strong></li>
  <li>Ön tanımlı <strong>HTTPS</strong> port <strong>443</strong></li>
</ul>

<p>Şimdi yaptınız ayarlamaları o kadar yaptınız çalışacakmı diye bi bakmanız lazım boşu boşuna nginx resetleyip siteyi çökertmeye luzum yok nginx işte bu konuda çok iyi nginx ayarlamalarını test ettirebilirsiniz.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/local/nginx/sbin/nginx -t
</code></pre>
</div>

<p>Alttaki gibi bir yazı çıkarsa şanslısınız nginx resetleyerek devam edebilirsiniz ama hata verirse hiç reset atmayın sorunu bulup çözün sonra reset atarsınız bu ne acele yahu</p>

<div class="highlighter-rouge"><pre class="highlight"><code>the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
configuration file /usr/local/nginx/conf/nginx.conf test is successful
</code></pre>
</div>

<h2 id="selinux-sisteminizde-aktif-olsun"><strong>1.SELinux Sisteminizde aktif olsun</strong></h2>

<p>Şimdi yum komutumuz ile 2 paket kurmamız lazım ama baştan söyleyim enforcing şeklinde açmayacağız yoksa başımızı ağrıtır bunun yerine permissive yapacaz ki uyarı verse bile sorun olmayacak</p>

<div class="highlighter-rouge"><pre class="highlight"><code>yum install policycoreutils setroubleshoot
nano /etc/selinux/config
</code></pre>
</div>

<p>Şu şekilde değiştiriyoruz.selinux tiğini targeted yapıyoruz çünkü sadece DNS,Apache,Nginx için kullanacağız.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SELINUX=permissive
SELINUXTYPE=targeted
</code></pre>
</div>

<p>yaptığımız işlemlerin geçerli olabilmesi için sistemi resetlememiz gerekiyor</p>

<div class="highlighter-rouge"><pre class="highlight"><code>reboot &amp;nbsp; Dikkat edin yapacağınız hata sunucuyu uçuracaktır SSH bağlanamayabilirsiniz yapacağınız en kötü sorun bu olur.
</code></pre>
</div>

<h2 id="disk-yetkilerini-kstlayn"><strong>2.Disk yetkilerini Kısıtlayın</strong></h2>

<p>Nasıl disk oluşturacağınızı anlatmak isterdim ama herşeyi devletden beklemeyin oluşturun /etc/fstab da benim zamanında yapmış olduğum satırı sizlerle paylaşacağım önemli olan satır sonlarında bulunan komutlar zaten</p>

<div class="highlighter-rouge"><pre class="highlight"><code>LABEL=/nginx /nginx ext3 defaults,nosuid,noexec,nodev 1 2
</code></pre>
</div>

<p>kısıtlamalarımızı yaptık bi tık daha güvenliğimizi arttırdık.</p>

<h2 id="ufak-apl-ddoslardan-korunun"><strong>3.Ufak çaplı DDOSlardan korunun</strong></h2>

<p>Ben bu ayarları internetden bulup kullandım nedir ne değildir yazıyor.Ancak teker teker açıklamayacağım ufak çaplı ddoslardan koruduğunu bilin yeter.Büyük çapta saldırı alıyorsanız ama işinize asla yaramaz</p>

<div class="highlighter-rouge"><pre class="highlight"><code>nano /etc/sysctl.conf
</code></pre>
</div>

<p>Dosyayı aşağıdaki gibi düzenliyip kayıt ediyoruz.</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Avoid a smurf attack
net.ipv4.icmp_echo_ignore_broadcasts = 1

# Turn on protection for bad icmp error messages
net.ipv4.icmp_ignore_bogus_error_responses = 1

# Turn on syncookies for SYN flood attack protection
net.ipv4.tcp_syncookies = 1

# Turn on and log spoofed, source routed, and redirect packets
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1

# No source routed packets here
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0

# Turn on reverse path filtering
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# Make sure no one can alter the routing tables
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.ip_forward = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0


# Turn on execshild
kernel.exec-shield = 1
kernel.randomize_va_space = 1

# Tuen IPv6
net.ipv6.conf.default.router_solicitations = 0
net.ipv6.conf.default.accept_ra_rtr_pref = 0
net.ipv6.conf.default.accept_ra_pinfo = 0
net.ipv6.conf.default.accept_ra_defrtr = 0
net.ipv6.conf.default.autoconf = 0
net.ipv6.conf.default.dad_transmits = 0
net.ipv6.conf.default.max_addresses = 1

# Optimization for port usefor LBs
# Increase system file descriptor limit
fs.file-max = 65535

# Allow for more PIDs (to reduce rollover problems); may break some programs 32768
kernel.pid_max = 65536

# Increase system IP port limits
net.ipv4.ip_local_port_range = 2000 65000

# Increase TCP max buffer size setable using setsockopt()
net.ipv4.tcp_rmem = 4096 87380 8388608
net.ipv4.tcp_wmem = 4096 87380 8388608

# Increase Linux auto tuning TCP buffer limits
# min, default, and max number of bytes to use
# set max to at least 4MB, or higher if you use very high BDP paths
# Tcp Windows etc
net.core.rmem_max = 8388608
net.core.wmem_max = 8388608
net.core.netdev_max_backlog = 5000
net.ipv4.tcp_window_scaling = 1
</code></pre>
</div>

<h2 id="kullanlmayan-modlleri-kaldrn"><strong>4.Kullanılmayan Modülleri Kaldırın</strong></h2>

<p>Nginx hafif ve yüksek performanslı bir webserver olabilir ancak kullanmadığımız modülleri tutmanın ne anlamı var bu yüzden kullanmadıklarınızı kaldırın gitsin.ben mesela autoindex ve ssı kullanmıyorum durmasının ne anlamı var.dikkat edin nginx tekrar derliyor olacağız hatalı bir işlem yapmayın derleyemezsiniz mazallah.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>./configure --without-http_autoindex_module --without-http_ssi_module
make
make install
</code></pre>
</div>

<p>tekrar söylüyorum işinize yaramayan <strong>Nginx modüllerini kaldırın.</strong></p>

<h2 id="modsecurity-kullannbackend-apache-ise"><strong>5.Mod_Security Kullanın(backend Apache ise)</strong></h2>

<div class="highlighter-rouge"><pre class="highlight"><code>yum install mod_security
</code></pre>
</div>

<p>Kuruluma he dedikten sonra kurulum bitince</p>

<div class="highlighter-rouge"><pre class="highlight"><code>nano /etc/httpd/modsecurity.d/modsecurity_crs_10_config.conf
</code></pre>
</div>

<p>aşağıdaki gibi değiştirip kayıt edin</p>

<div class="highlighter-rouge"><pre class="highlight"><code>SecRuleEngine On
</code></pre>
</div>

<p>sonra apacheye restart atın işleminiz tamamdır.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>service httpd restart
</code></pre>
</div>

<p>Çalıştığını anlamak istiyorum kardeşim ben bune böyle kuru kuru anlatıyorsun diyenlere</p>

<div class="highlighter-rouge"><pre class="highlight"><code>tail -f /var/log/httpd/error_log
</code></pre>
</div>

<p>Komutunu öneriyorum sonrasında aşağıdaki gibi başlayan bi satır gözlemlemeleri gerekecek</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ModSecurity for Apache/....
</code></pre>
</div>

<h2 id="selinux-nginx-in-zorlayn"><strong>6.SELinux Nginx İçin Zorlayın</strong></h2>

<p>şimdi yukarıda ne dedik targeted olarak ayarladık dedik heh işte orda dns apache gibi tanımlı servislerde çalışıyor ama bu şey nginx için özel ayar istiyor illa yapacan yoksa çalışmıyor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>yum -y install selinux-policy-targeted selinux-policy-devel
</code></pre>
</div>

<p>sistem için gerekli şeyleri yukarda kurmadıysanız şimdi kurdunuz varsayıyorum. ve nginx için kullanılacak olan dosyamızı indiriyoruz.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /root
wget http://sourceforge.net/projects/selinuxnginx/files/se-ngix_1_0_10.tar.gz/download?use_mirror=softlayer-ams
tar -zxvf se-ngix_1_0_10.tar.gz
</code></pre>
</div>

<p>Sonrasında dosyayı derlememiz falan gerekiyor aşağıdaki komut ile halledebilirsiniz.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd se-ngix*/nginx
make
</code></pre>
</div>

<p>Gene Çalışmıyor ise dökümanlarda şöyle bi komut gördüm işinize yarayacaktır baya bi adamın derdine derman olmuş sonuçta</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/sbin/semodule -i nginx.pp
</code></pre>
</div>

<h2 id="gvenlik-duvar-kurallarn-belirleyin"><strong>7.Güvenlik Duvarı Kurallarını belirleyin</strong></h2>

<p>Gene internetten bulduğum bir güvenlik duvarı shını atmak istiyorum tek tek yapacaklarımızı yapıyor diye arşivime ekledim şimdi kim uğraşacak bunları tek tek el ile yazmaya direk olarak bunu bi .sh olarak kayıt edip sistemde çalıştırın.yada kendinize göre düzenleyip çalıştırabilirsiniz.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nv">IPT</span><span class="o">=</span><span class="s2">"/sbin/iptables"</span>

<span class="c">#### IPS ######</span>
<span class="c"># Get server public ip</span>
<span class="nv">SERVER_IP</span><span class="o">=</span><span class="k">$(</span>ifconfig eth0 | grep <span class="s1">'inet addr:'</span> | awk -F<span class="s1">'inet addr:'</span> <span class="s1">'{ print $2}'</span> | awk <span class="s1">'{ print $1}'</span><span class="k">)</span>
<span class="nv">LB1_IP</span><span class="o">=</span><span class="s2">"204.54.1.1"</span>
<span class="nv">LB2_IP</span><span class="o">=</span><span class="s2">"204.54.1.2"</span>

<span class="c"># Do some smart logic so that we can use damm script on LB2 too</span>
<span class="nv">OTHER_LB</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">SERVER_IP</span><span class="o">=</span><span class="s2">""</span>
<span class="o">[[</span><span class="s2">"</span><span class="nv">$SERVER_IP</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$LB1_IP</span><span class="s2">"</span><span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">OTHER_LB</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LB2_IP</span><span class="s2">"</span> <span class="o">||</span> <span class="nv">OTHER_LB</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LB1_IP</span><span class="s2">"</span>
<span class="o">[[</span><span class="s2">"</span><span class="nv">$OTHER_LB</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$LB2_IP</span><span class="s2">"</span><span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">OPP_LB</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LB1_IP</span><span class="s2">"</span> <span class="o">||</span> <span class="nv">OPP_LB</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LB2_IP</span><span class="s2">"</span>

<span class="c">### IPs ###</span>
<span class="nv">PUB_SSH_ONLY</span><span class="o">=</span><span class="s2">"122.xx.yy.zz/29"</span>

<span class="c">#### FILES #####</span>
<span class="nv">BLOCKED_IP_TDB</span><span class="o">=</span>/root/.fw/blocked.ip.txt
<span class="nv">SPOOFIP</span><span class="o">=</span><span class="s2">"127.0.0.0/8 192.168.0.0/16 172.16.0.0/12 10.0.0.0/8 169.254.0.0/16 0.0.0.0/8 240.0.0.0/4 255.255.255.255/32 168.254.0.0/16 224.0.0.0/4 240.0.0.0/5 248.0.0.0/5 192.0.2.0/24"</span>
<span class="nv">BADIPS</span><span class="o">=</span><span class="k">$(</span> <span class="o">[[</span>-f <span class="k">${</span><span class="nv">BLOCKED_IP_TDB</span><span class="k">}</span><span class="o">]]</span> <span class="o">&amp;&amp;</span> egrep -v <span class="s2">"^#|^$"</span> <span class="k">${</span><span class="nv">BLOCKED_IP_TDB</span><span class="k">})</span>

<span class="c">### Interfaces ###</span>
<span class="nv">PUB_IF</span><span class="o">=</span><span class="s2">"eth0"</span> <span class="c"># public interface</span>
<span class="nv">LO_IF</span><span class="o">=</span><span class="s2">"lo"</span> <span class="c"># loopback</span>
<span class="nv">VPN_IF</span><span class="o">=</span><span class="s2">"eth1"</span> <span class="c"># vpn / private net</span>

<span class="c">### start firewall ###</span>
<span class="nb">echo</span> <span class="s2">"Setting LB1 </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2"> Firewall..."</span>

<span class="c"># DROP and close everything</span>
<span class="nv">$IPT</span> -P INPUT DROP
<span class="nv">$IPT</span> -P OUTPUT DROP
<span class="nv">$IPT</span> -P FORWARD DROP

<span class="c"># Unlimited lo access</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">LO_IF</span><span class="k">}</span> -j ACCEPT
<span class="nv">$IPT</span> -A OUTPUT -o <span class="k">${</span><span class="nv">LO_IF</span><span class="k">}</span> -j ACCEPT

<span class="c"># Unlimited vpn / pnet access</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">VPN_IF</span><span class="k">}</span> -j ACCEPT
<span class="nv">$IPT</span> -A OUTPUT -o <span class="k">${</span><span class="nv">VPN_IF</span><span class="k">}</span> -j ACCEPT

<span class="c"># Drop sync</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp ! --syn -m state --state NEW -j DROP

<span class="c"># Drop Fragments</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -f -j DROP

<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags ALL ALL -j DROP

<span class="c"># Drop NULL packets</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags ALL NONE -m limit --limit 5/m --limit-burst 7 -j LOG --log-prefix <span class="s2">" NULL Packets "</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags ALL NONE -j DROP

<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags SYN,RST SYN,RST -j DROP

<span class="c"># Drop XMAS</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags SYN,FIN SYN,FIN -m limit --limit 5/m --limit-burst 7 -j LOG --log-prefix <span class="s2">" XMAS Packets "</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP

<span class="c"># Drop FIN packet scans</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags FIN,ACK FIN -m limit --limit 5/m --limit-burst 7 -j LOG --log-prefix <span class="s2">" Fin Packets Scan "</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags FIN,ACK FIN -j DROP

<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -j DROP

<span class="c"># Log and get rid of broadcast / multicast and invalid</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -m pkttype --pkt-type broadcast -j LOG --log-prefix <span class="s2">" Broadcast "</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -m pkttype --pkt-type broadcast -j DROP

<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -m pkttype --pkt-type multicast -j LOG --log-prefix <span class="s2">" Multicast "</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -m pkttype --pkt-type multicast -j DROP

<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -m state --state INVALID -j LOG --log-prefix <span class="s2">" Invalid "</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -m state --state INVALID -j DROP

<span class="c"># Log and block spoofed ips</span>
<span class="nv">$IPT</span> -N spooflist
<span class="k">for </span>ipblock <span class="k">in</span> <span class="nv">$SPOOFIP</span>
<span class="k">do</span>
         <span class="nv">$IPT</span> -A spooflist -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -s <span class="nv">$ipblock</span> -j LOG --log-prefix <span class="s2">" SPOOF List Block "</span>
         <span class="nv">$IPT</span> -A spooflist -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -s <span class="nv">$ipblock</span> -j DROP
<span class="k">done</span>
<span class="nv">$IPT</span> -I INPUT -j spooflist
<span class="nv">$IPT</span> -I OUTPUT -j spooflist
<span class="nv">$IPT</span> -I FORWARD -j spooflist

<span class="c"># Allow ssh only from selected public ips</span>
<span class="k">for </span>ip <span class="k">in</span> <span class="k">${</span><span class="nv">PUB_SSH_ONLY</span><span class="k">}</span>
<span class="k">do</span>
        <span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -s <span class="k">${</span><span class="nv">ip</span><span class="k">}</span> -p tcp -d <span class="k">${</span><span class="nv">SERVER_IP</span><span class="k">}</span> --destination-port 22 -j ACCEPT
        <span class="nv">$IPT</span> -A OUTPUT -o <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -d <span class="k">${</span><span class="nv">ip</span><span class="k">}</span> -p tcp -s <span class="k">${</span><span class="nv">SERVER_IP</span><span class="k">}</span> --sport 22 -j ACCEPT
<span class="k">done</span>

<span class="c"># allow incoming ICMP ping pong stuff</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p icmp --icmp-type 8 -s 0/0 -m state --state NEW,ESTABLISHED,RELATED -m limit --limit 30/sec -j ACCEPT
<span class="nv">$IPT</span> -A OUTPUT -o <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p icmp --icmp-type 0 -d 0/0 -m state --state ESTABLISHED,RELATED -j ACCEPT

<span class="c"># allow incoming HTTP port 80</span>
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp -s 0/0 --sport 1024:65535 --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
<span class="nv">$IPT</span> -A OUTPUT -o <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --sport 80 -d 0/0 --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT


<span class="c"># allow outgoing ntp</span>
<span class="nv">$IPT</span> -A OUTPUT -o <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p udp --dport 123 -m state --state NEW,ESTABLISHED -j ACCEPT
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p udp --sport 123 -m state --state ESTABLISHED -j ACCEPT

<span class="c"># allow outgoing smtp</span>
<span class="nv">$IPT</span> -A OUTPUT -o <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --dport 25 -m state --state NEW,ESTABLISHED -j ACCEPT
<span class="nv">$IPT</span> -A INPUT -i <span class="k">${</span><span class="nv">PUB_IF</span><span class="k">}</span> -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT

<span class="c">### add your other rules here ####</span>

<span class="c">#######################</span>
<span class="c"># drop and log everything else</span>
<span class="nv">$IPT</span> -A INPUT -m limit --limit 5/m --limit-burst 7 -j LOG --log-prefix <span class="s2">" DEFAULT DROP "</span>
<span class="nv">$IPT</span> -A INPUT -j DROP

<span class="nb">exit </span>0
</code></pre>
</div>

<h2 id="ssl-kullanmna-zen-gsterin"><strong>8.SSL Kullanımına özen gösterin</strong></h2>

<p>SSL kullanmanız güvenliğinizi bir tık daha yukarıya çıkartıcaktır aynı zamanda son zamanlarda googlenin söylediği gibi SEO da önemli bir noktada bulunuyor SSL.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>server {
    server_name example.com;
    listen 443;
    ssl on;
    ssl_certificate /usr/local/nginx/conf/server.crt;
    ssl_certificate_key /usr/local/nginx/conf/server.key;
    access_log /usr/local/nginx/logs/ssl.access.log;
    error_log /usr/local/nginx/logs/ssl.error.log;
}
</code></pre>
</div>

<p>Haliyle sistemi yeniden başlatmamız gerekiyor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/usr/local/nginx/sbin/nginx -s reload
</code></pre>
</div>

<h2 id="php-de-gvenliinizi-arttrn"><strong>9. PHP de Güvenliğinizi arttırın</strong></h2>

<p>php.ini içerisindeki ayarları aşağıdaki yönergelere göre mutlaka değiştirin.</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Disallow dangerous functions
disable_functions = phpinfo, system, mail, exec

## Try to limit resources ##

# Maximum execution time of each script, in seconds
max_execution_time = 30

# Maximum amount of time each script may spend parsing request data
max_input_time = 60

# Maximum amount of memory a script may consume (8MB)
memory_limit = 8M

# Maximum size of POST data that PHP will accept.
post_max_size = 8M

# Whether to allow HTTP file uploads.
file_uploads = Off

# Maximum allowed size for uploaded files.
upload_max_filesize = 2M

# Do not expose PHP error messages to external users
display_errors = Off

# Turn on safe mode
safe_mode = On

# Only allow access to executables in isolated directory
safe_mode_exec_dir = php-required-executables-path

# Limit external access to PHP environment
safe_mode_allowed_env_vars = PHP_

# Restrict PHP information leakage
expose_php = Off

# Log all errors
log_errors = On

# Do not register globals for input data
register_globals = Off

# Minimize allowable PHP post size
post_max_size = 1K

# Ensure PHP redirects appropriately
cgi.force_redirect = 0

# Disallow uploading unless necessary
file_uploads = Off

# Enable SQL safe mode
sql.safe_mode = On

# Avoid Opening remote files
allow_url_fopen = Off
</code></pre>
</div>

<h2 id="eriiniz-ve-dosyalarnz-kolay-kolay-indirilemesin"><strong>10.İçeriğiniz ve Dosyalarınız kolay kolay indirilemesin</strong></h2>

<p>adam wget ile çatır çutur sitenizdeki içeriklerden tutam tutam alıyor ise aşağıdaki komutumuz size çok iyi gelicek User-Agentleri yakalıyorsunuz.Sonrasında aşağıdaki gibi düzenliyorsunuz sonrasını onlar düşünsün</p>

<div class="highlighter-rouge"><pre class="highlight"><code>if ($http_user_agent ~* LWP::Simple|BBBike|wget) {
            return 403;
     }
</code></pre>
</div>

<p>Yapacağınız tüm bu işlemler sizin sistemlerinizin tamamen güvenli yapacağı anlamına gelmez.Sadece sisteminize saldıran kişileri bir nebze zorlamak bazı kişileride engellemek için kullanılmaktadır.Daha iyi güvenlik yapılandırmaları için <a href="https://mertcangokgoz.com/iletisim-2">Lütfen bizimle iletişime geçin</a></p>

</div>

<div id="paylasim">
<h3>Bu yazıyı paylaş:</h3>
<a href="https://www.facebook.com/sharer/sharer.php?u=https://mertcangokgoz.com/nginx-webserver-guvenligi/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" >
    <i class="fa fa-facebook-square fa share-button"> Facebook</i>
</a>
<a href="https://twitter.com/intent/tweet?text=Nginx WebServer Güvenliği&url=https://mertcangokgoz.com/nginx-webserver-guvenligi/&via=mertcangokgoz&related=mertcangokgoz" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;">
    <i class="fa fa-twitter-square fa share-button"> Twitter</i>
</a>
<a href="https://plus.google.com/share?url=https://mertcangokgoz.com/nginx-webserver-guvenligi/" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" >
    <i class="fa fa-google-plus-square fa share-button"> Google</i>
</a>
<a href="http://www.reddit.com/submit?url=https://mertcangokgoz.com/nginx-webserver-guvenligi/&title=Nginx WebServer Güvenliği" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" >
    <i class="fa fa-reddit-square fa share-button"> Reddit</i>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://mertcangokgoz.com/nginx-webserver-guvenligi/&title=Nginx WebServer Güvenliği&summary=&source=webjeda" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" >
    <i class="fa fa-linkedin-square fa share-button"> Linkedin</i>
</a>
<a href="mailto:?subject=Nginx WebServer Güvenliği&amp;body=Check out this site https://mertcangokgoz.com/nginx-webserver-guvenligi/">
    <i class="fa fa-envelope-square fa share-button"> Email</i>
</a>
</div>


<div class="ajaxloadcomment"><button class="show-comments">Yorumları yükle</button></div>
<div itemprop="comment" id="disqus_thread"></div>
<script>
$(document).ready(function() {
    $('.show-comments').on('click', function(){
          var disqus_shortname = 'mertcanofficial';

          $.ajax({
                  type: "GET",
                  url: "//" + disqus_shortname + ".disqus.com/embed.js",
                  dataType: "script",
                  cache: true
          });
          $(this).fadeOut();
    });
});
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



      <div class="footer">
        <div class="disclaimer">
  
  <p>
    Bu sitedeki gönderiler bana aittir ve iş verenime ait pozisyonlar,
    stratejiler veya görüşler temsil edilmemektedir.<br>
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Atıf-Paylaşım Lisansı</a> altındadır.<br>
        <a href="/ders-notlari/">Ders Notları</a>
        <span> | </span><a href="/gizlilik-politikasi/">Gizlilik Politikası</a>
        <span> | </span><a href="/kullanim-kosullari/">Kullanım Koşulları</a>
        <span> | </span><a href="/hakkimda/">Hakkımda</a>
        <span> | </span><a href="/iletisim/">İletişim</a><br>
        <b>BTC:</b> 36DFx4anTdsx3AnBiA1oqR3oHkMV3RJME1<br>
        <a href="/hosted/">Hosted By </a> © Mertcan GÖKGÖZ, 2016 - Linux Hacısı
  </p>
  
</div>

      </div>
    </div>
  </div>
  <div id="up">
    <a href="javascript:"><i class="fa fa-arrow-up fa-2x"></i></a>
  </div>







</body>
</html>
